<!DOCTYPE html>
<html lang="ja">
<head>
<head>
 <meta name="robots" content="noindex">
 <meta charset="UTF-8" />
 <title>âœ½.ï½¡.:*ãƒ»ï¾Ÿ âœ½ã€æ°´æ™¶å®®ã€ãƒ†ã‚­ã‚¹ãƒˆã‚¯ãƒªãƒ¼ãƒ³ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼âœ½.ï½¡.:*ãƒ»ï¾Ÿ âœ½</title>
 <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
#output {
 font-size: 16px !important;
 font-family:
   "Arial Unicode MS",
   "Noto Sans",
   "Segoe UI Symbol",
   "Yu Gothic",
   "Hiragino Sans",
   sans-serif !important;
}

#output[data-zakran-comment="true"] {
 font-size: 16px !important;
 font-family: "Hiragino Mincho ProN", "Yu Mincho", serif !important;
}

/* ã‚¸ã‚§ãƒã¡ã‚ƒã‚“ã®ã‚¿ã‚¤ãƒˆãƒ«è§£æ”¾ã‚³ãƒ¼ãƒ‰ */
#mainTitle, .titleBar {
 white-space: nowrap;
 overflow: hidden;
 text-overflow: ellipsis;
 max-width: 100%;
 display: block;
 font-size: 18px;
}

.zakran-welcome-line {
 color: #7daaff;
 text-shadow:
   0 0 4px #ffffffaa,
   0 0 8px #7daaff,
   0 0 12px #aaccff,
   0 0 16px #6bb6ff;
 font-weight: normal;
 font-size: 12px;
 animation: zakranGlow 2s ease-in-out infinite alternate;
}

@keyframes zakranGlow {
 0% { 
   text-shadow: 
     0 0 4px #ffffffaa,
     0 0 8px #7daaff,
     0 0 12px #aaccff;
 }
 100% { 
   text-shadow: 
     0 0 8px #ffffff,
     0 0 16px #7daaff,
     0 0 24px #aaccff,
     0 0 32px #6bb6ff;
 }
}

theme-scherite .scherite-welcome-line,
.theme-scherite #returnComment.scherite-welcome-line {
 color: #ff2e2e !important;
 text-shadow:
   0 0 4px #ff4444,
   0 0 8px #ff4444,
   0 0 12px #aa0000,
   0 0 16px #aa0000 !important;
 font-weight: normal;
 font-size: 12px;
}

body:not(.theme-scherite) .zakran-welcome-line,
body:not(.theme-scherite) #returnComment.zakran-welcome-line {
 color: #7daaff !important;
 text-shadow:
   0 0 4px #ffffffaa,
   0 0 8px #7daaff,
   0 0 12px #aaccff,
   0 0 16px #6bb6ff !important;
 font-weight: normal;
 font-size: 12px;
 animation: zakranGlow 2s ease-in-out infinite alternate;
}

/* æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆãƒ»ãƒ†ãƒ¼ãƒåˆ‡æ›¿ã‚’ã‚°ãƒ¬ãƒ¼ */
#inputOutputInfo, #themeSwitchInfo {
 color: #999 !important;
}

.theme-scherite #inputOutputInfo,
.theme-scherite #themeSwitchInfo {
 color: #777 !important;
}

/* æ•°å­—éƒ¨åˆ†ã‚‚ã‚°ãƒ¬ãƒ¼ */
#inputCount, #outputCount, #themeSwitchCount {
 color: #999 !important;
}

.theme-scherite #inputCount,
.theme-scherite #outputCount,
.theme-scherite #themeSwitchCount {
 color: #777 !important;
}

/* â–¼ ã‚¶ã‚¯ãƒ©ãƒ³ãƒ†ãƒ¼ãƒä¸­ï¼ˆã‚·ã‚§ãƒ©ã‚¤ãƒˆéš ã™ã€ã‚¶ã‚¯ãƒ©ãƒ³è¡¨ç¤ºï¼‰ */
body:not(.theme-scherite) #scheriteFullSection {
 display: none !important;
}

body:not(.theme-scherite) #zakranFullSection {
 display: block !important;
 visibility: visible !important;
 opacity: 1 !important;
}

/* â–¼ ã‚·ã‚§ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒä¸­ï¼ˆã‚·ã‚§ãƒ©ã‚¤ãƒˆè¡¨ç¤ºã€ã‚¶ã‚¯ãƒ©ãƒ³éš ã™ï¼‰ */
body.theme-scherite #scheriteFullSection {
 display: block !important;
 visibility: visible !important;
 opacity: 1 !important;
 margin-top: 12px;
}

body.theme-scherite #zakranFullSection {
 display: none !important;
}

/* æ™‚è¨ˆã®å¯è¦–åŒ–ã‚’ç¢ºå®Ÿã« */
#scheriteTime, #zakranTime {
 display: inline-block !important;
 visibility: visible !important;
 color: inherit !important;
}

@keyframes fadeInOut {
 0% { opacity: 0; transform: translateX(100%); }
 10% { opacity: 1; transform: translateX(0); }
 90% { opacity: 1; transform: translateX(0); }
 100% { opacity: 0; transform: translateX(100%); }
}

/* å…¨ãƒœã‚¿ãƒ³å…±é€šã®ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ */
button {
 transition: all 0.2s ease;
}

/* â–¼â”â”â” ã‚·ã‚§ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒã®ãƒœã‚¿ãƒ³ â”â”â”â–¼ */
.theme-scherite button:not([onclick*="triggerZakranFestival"]):not([onclick*="cancelZakranFestival"]):not([onclick*="triggerScheriteFestival"]):not([onclick*="closeScheriteFinalPopup"]):not(#effectButtons button) {
background: #000000;
color: #800000;
border: 1px solid #800000;
font-weight: bold;
border-radius: 10px;
padding: 6px 14px;
min-width: 110px !important;
cursor: pointer;
transition: all 0.3s ease;
}

.theme-scherite button:not([onclick*="triggerZakranFestival"]):not([onclick*="cancelZakranFestival"]):not([onclick*="triggerScheriteFestival"]):not([onclick*="closeScheriteFinalPopup"]):hover {
background-color: #330000;
color: #cc0000;
box-shadow: 0 0 8px #cc0000, 0 0 16px #cc0000;
transform: translateY(-1px);
}

.theme-scherite button:not([onclick*="triggerZakranFestival"]):not([onclick*="cancelZakranFestival"]):not([onclick*="triggerScheriteFestival"]):not([onclick*="closeScheriteFinalPopup"]):active {
background-color: #440000 !important;
color: #cc0000 !important;
box-shadow: 0 0 10px 3px #cc0000, inset 0 0 6px #cc0000;
transform: translateY(0);
}

/* ãƒ•ã‚§ã‚¹ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒœã‚¿ãƒ³ã¯è‡ªç„¶ãªã‚µã‚¤ã‚ºã« */
.theme-scherite [onclick*="triggerZakranFestival"],
.theme-scherite [onclick*="cancelZakranFestival"],
.theme-scherite [onclick*="triggerScheriteFestival"],
.theme-scherite [onclick*="closeScheriteFinalPopup"] {
min-width: auto !important;
width: auto !important;
padding: 6px 14px !important;
}

/* ãƒ•ã‚§ã‚¹ãƒœã‚¿ãƒ³ã‚µã‚¤ã‚ºçµ±ä¸€ */
.theme-scherite #effectButtons button {
min-width: 70px !important;
width: 70px !important;
max-width: 70px !important;
padding: 4px 6px !important;
}

/* â–¼â”â”â” ã‚¶ã‚¯ãƒ©ãƒ³ãƒ†ãƒ¼ãƒã®ãƒœã‚¿ãƒ³ â”â”â”â–¼ */
.theme-zakran button:hover {
 box-shadow: 0 0 6px 2px #6bb6ff, inset 0 0 4px #6bb6ff;
 transform: translateY(-1px);
}

.theme-zakran button:active {
 box-shadow: 0 0 10px 3px #6bb6ff, inset 0 0 6px #6bb6ff;
 transform: translateY(0);
}

/* ã‚¶ã‚¯ãƒ©ãƒ³å ã„ãƒœã‚¿ãƒ³ã®ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
button[onclick="openZodiacPopup()"]:hover {
 box-shadow: 0 0 8px 2px #6bb6ff, 0 0 16px 4px rgba(107, 182, 255, 0.5) !important;
 transform: translateY(-1px);
}

button[onclick="openZodiacPopup()"]:active {
 box-shadow: 0 0 12px 4px #6bb6ff, inset 0 0 8px rgba(107, 182, 255, 0.3) !important;
 transform: translateY(0px);
}

/* â–¼â”â”â” ãƒœã‚¿ãƒ³è¡Œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ â”â”â”â–¼ */
.button-row {
 display: flex;
 justify-content: center;
 flex-wrap: wrap;
 gap: 6px;
 margin: 8px 0 12px;
}

/* å…¨ãƒœã‚¿ãƒ³å…±é€šã®ã¼ã‚„ã¼ã‚„ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
button:hover {
 box-shadow: 0 0 8px 2px currentColor, 0 0 16px 4px rgba(107, 182, 255, 0.3) !important;
 transform: translateY(-1px) !important;
}

button:active {
 box-shadow: 0 0 12px 4px currentColor, inset 0 0 6px rgba(107, 182, 255, 0.2) !important;
 transform: translateY(0px) !important;
}

/* ã‚·ã‚§ãƒ©ã‚¤ãƒˆéƒ¨å±‹ã®ãƒœã‚¿ãƒ³ã¯èµ¤ã„ã¼ã‚„ã¼ã‚„ */
.theme-scherite button:hover {
 box-shadow: 0 0 8px 2px #cc0000, 0 0 16px 4px rgba(204, 0, 0, 0.3) !important;
}

.theme-scherite button:active {
 box-shadow: 0 0 12px 4px #cc0000, inset 0 0 6px rgba(204, 0, 0, 0.2) !important;
}

/* â–¼â”â”â” ãƒ†ãƒ¼ãƒåˆ‡æ›¿ã«ã‚ˆã‚‹è¡¨ç¤ºåˆ¶å¾¡ â”â”â”â–¼ */
.theme-scherite .zakran-row {
 display: none !important;
}
.theme-scherite .scherite-row {
 display: flex !important;
}

/* è»¢å†™BOXç”¨ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
.transfer-highlight {
  background: linear-gradient(135deg, #57ABFF 0%, #61B0FF 100%);
  padding: 2px 4px;
  border-radius: 4px;
  cursor: pointer;
  border: 1px dashed #ff9900;
  transition: all 0.2s ease;
}

.transfer-highlight:hover {
  background: linear-gradient(135deg, #0066FF 0%, #4689FF 100%);
  color: white;
  transform: scale(1.05);
}

.transfer-highlight.selected {
  background: linear-gradient(135deg, #3399FF 0%, #42A1FF 100%);
  border: 2px solid #0099ff;
  color: #003366;
  font-weight: bold;
}

.theme-scherite .transfer-highlight {
  background: linear-gradient(135deg, #660000 0%, #990000 100%);
  border: 1px dashed #cc0000;
  color: #ffcccc;
}

.theme-scherite .transfer-highlight:hover {
  background: linear-gradient(135deg, #970202 0%, #B40404 100%);
  color: white;
}

.theme-scherite .transfer-highlight.selected {
  background: linear-gradient(135deg, #cc0000 0%, #ff0000 100%);
  border: 2px solid #ff6666;
  color: white;
}

body:not(.theme-scherite) .zakran-row {
 display: flex !important;
}
body:not(.theme-scherite) .scherite-row {
 display: none !important;
}

/* â–¼â”â”â” ã‚·ã‚§ãƒ©ã‚¤ãƒˆå ã„ãƒœã‚¿ãƒ³å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« â”â”â”â–¼ */
.scherite-btn {
 background: #220000 !important;
 border: 2px solid #cc0000 !important;
 color: #cc0000 !important;
 padding: 8px 16px;
 border-radius: 6px;
 font-weight: bold;
 cursor: pointer;
 font-family: 'Times New Roman', serif;
 transition: all 0.3s ease;
}

.scherite-btn:hover {
 background: #330000 !important;
 box-shadow: 0 0 8px #cc0000;
}

/* â–¼â”â”â” å ã„ãƒªã‚¹ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ â”â”â”â–¼ */
#scheriteFortunePopup {
  max-width: 90vw !important;
  width: 300px !important;
}

#scheriteFortunePopup ul {
  max-height: none !important;
  overflow-y: visible !important;
  padding-left: 10px;
  columns: 2;
  column-gap: 15px;
  column-fill: balance;
}

#scheriteFortunePopup li {
  margin-bottom: 6px;
  font-size: 12px;
  break-inside: avoid;
  padding-right: 5px;
}

/* ã‚¶ã‚¯ãƒ©ãƒ³ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆé€šå¸¸ï¼‰ */
.undo-zakran {
 background: #fff;
 color: #6bb6ff;
 border: 1px solid #6bb6ff;
 font-family: "Hiragino Mincho ProN", "Yu Mincho", serif;
 letter-spacing: normal;
}

/* ã‚·ã‚§ãƒ©ã‚¤ãƒˆç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
.undo-scherite {
 background: #111;
 color: #cc0000;
 border: 1px solid #cc0000;
 font-family: "Times New Roman", serif;
 letter-spacing: 0.5px;
}

#undoBtn {
 padding: 6px 14px;
 border-radius: 10px;
 font-weight: bold;
 font-size: 15px;
 margin: 6px 8px;
 transition: all 0.3s ease;
}

/* ã‚¶ã‚¯ãƒ©ãƒ³ç‰ˆã®æˆ»ã‚‹ãƒœã‚¿ãƒ³ */
body:not(.theme-scherite) #undoBtn {
 padding: 6px 14px;
 border-radius: 10px;
 font-weight: bold;
 font-size: 15px;
 margin: 6px 8px;
 transition: all 0.3s ease;
 /* ã‚¶ã‚¯ãƒ©ãƒ³ã¯è‡ªç„¶ãªã‚µã‚¤ã‚ºã®ã¾ã¾ */
}

/* ã‚·ã‚§ãƒ©ã‚¤ãƒˆç‰ˆã®ç‹å‘½é€†è¡Œãƒœã‚¿ãƒ³ */
.theme-scherite #undoBtn {
 padding: 6px 14px;
 border-radius: 10px;
 font-weight: bold;
 font-size: 15px;
 margin: 6px 8px;
 transition: all 0.3s ease;
 min-width: 110px !important;
 max-width: 110px !important;
 width: 110px !important;
 text-align: center !important;
 box-sizing: border-box !important;
}

#undoBtn:hover {
 background-color: #e4f0ff;
}

.theme-scherite #undoBtn:hover {
 background-color: #330000;
}

@keyframes flickerParticle {
 0% {
   opacity: 1;
   transform: scale(1) translateY(0);
 }
 100% {
   opacity: 0;
   transform: scale(1.4) translateY(-30px);
 }
}

@keyframes shake {
 0% { transform: translate(0, 0); }
 25% { transform: translate(2px, -2px); }
 50% { transform: translate(-2px, 2px); }
 75% { transform: translate(2px, 2px); }
 100% { transform: translate(0, 0); }
}

.shake-effect {
 animation: shake 0.1s infinite;
}

#interference-backdrop {
 position: fixed;
 inset: 0;
 background: rgba(0, 0, 0, 0.6);
 z-index: 9997;
 pointer-events: all;
}

@keyframes magneticPulse {
 0%   { background-color: #1a0000; }
 20%  { background-color: #330000; }
 40%  { background-color: #220011; }
 60%  { background-color: #440000; }
 80%  { background-color: #330022; }
 100% { background-color: #1a0000; }
}

body.scherite-festival {
 animation: magneticPulse 3s infinite ease-in-out;
 transition: background-color 0.6s ease;
}

.theme-scherite .error-summon-btn {
 background: #1a1a1a !important;
 border: 1px solid #cc0000 !important;
 color: #cc0000 !important;
 font-family: 'Times New Roman', serif;
 letter-spacing: 0.05em;
}

.hidden {
 display: none !important;
}

.error-summon-btn {
 font-size: 13px;
 padding: 6px 12px;
 border-radius: 8px;
 font-weight: bold;
 cursor: pointer;
 background: #ffffff;
 border: 1px solid #6bb6ff;
 color: #6bb6ff;
}

.ir7-mode {
 animation: rainbowShift 6s infinite alternate;
}

@keyframes rainbowShift {
 0% { background-color: #ffadad; }
 20% { background-color: #ffd6a5; }
 40% { background-color: #fdffb6; }
 60% { background-color: #caffbf; }
 80% { background-color: #9bf6ff; }
 100% { background-color: #a0c4ff; }
}

.zakran-burst {
 position: fixed;
 font-size: 18px;
 font-weight: bold;
 color: var(--color, #7daaff);
 animation: burstFly 2s ease-out forwards;
 transform: rotate(var(--rotate));
 opacity: 0;
 pointer-events: none;
 z-index: 9999;
}

.zakran-float {
 position: fixed;
 font-size: 18px;
 font-weight: bold;
 color: var(--color, #7daaff);
 animation: floatIn 3s ease forwards;
 pointer-events: none;
 z-index: 9999;
}

@keyframes floatIn {
 0% {
   transform: rotate(-30deg) translateX(0);
   opacity: 0;
 }
 20% {
   opacity: 1;
 }
 100% {
   transform: rotate(0deg) translateX(110vw);
   opacity: 0;
 }
}

.zakran-scatter {
 position: fixed;
 font-size: 18px;
 font-weight: bold;
 color: var(--color, #7daaff);
 animation: scatterFly 2s ease-out forwards;
 transform: rotate(var(--rotate));
 opacity: 0;
 pointer-events: none;
 z-index: 9999;
}

@keyframes scatterFly {
 0% {
   transform: translate(0, 0) scale(1) rotate(var(--rotate));
   opacity: 1;
 }
 100% {
   transform: translate(calc(-40vw + 100px), calc(40vh - 80px)) scale(1.6) rotate(calc(var(--rotate) + 360deg));
   opacity: 0;
 }
}

@keyframes burstFly {
 0% {
   transform: translate(0, 0) scale(1) rotate(var(--rotate));
   opacity: 1;
 }
 100% {
   transform: translate(100vw, -50vh) scale(1.4) rotate(calc(var(--rotate) + 360deg));
   opacity: 0;
 }
}

.zakran-scatter {
 z-index: 9997;
}

#effectButtons {
 position: fixed;
 top: 10px;
 left: 50%;
 transform: translateX(-50%);
 z-index: 10001;
 display: flex;
 flex-wrap: nowrap;
 justify-content: center;
 gap: 6px;
 background: #ffffffee;
 padding: 6px 10px;
 border-radius: 10px;
 box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
 max-width: 95vw;
 overflow-x: auto;
}

#effectButtons button {
 font-size: 13px;
 padding: 4px 8px;
 min-width: 64px;
 height: 36px;
 border-radius: 8px;
 border: 1px solid #6bb6ff;
 background: #fff;
 color: #6bb6ff;
 font-weight: bold;
 cursor: pointer;
 white-space: nowrap;
 flex-shrink: 0;
}

#endFestival {
 z-index: 10000;
 font-size: 14px;
 background: white;
 border: 2px solid #7daaff;
 padding: 6px 12px;
 border-radius: 8px;
 color: #7daaff;
 font-weight: bold;
 cursor: pointer;
}

html, body {
 margin: 0;
 padding: 0;
 overflow-x: hidden;
 box-sizing: border-box;
}

body {
 font-family: "Hiragino Mincho ProN", "Yu Mincho", serif;
 background-color: #f8faff;
 color: #333;
 padding: 20px 16px;
 max-width: 680px;
 margin: 48px auto 20px auto;
 transition: background-color 0.6s ease, color 0.6s ease;
}

textarea, #output, #input {
 font-family: "Consolas", "Monaco", "Menlo", "Courier New", "DejaVu Sans Mono", monospace !important;
 font-size: 16px !important;
 line-height: 1.6 !important;
 padding: 12px !important;
}

/* ã‚¹ãƒãƒ›å¯¾å¿œï¼šã‚ˆã‚Šç´°ã‹ã„èª¿æ•´ */
@media screen and (max-width: 768px) {
  textarea, #output, #input {
    font-size: 16px !important;
    line-height: 1.6 !important;
    padding: 12px !important;
  }
}

.deco-top, .deco-bottom {
 text-align: center;
 font-size: 20px;
 margin: 12px 0;
 animation: sparkle 3s ease-in-out infinite alternate;
 transition: transform 0.3s ease, opacity 0.3s ease;
}

body {
 margin-top: 28px;
 padding-top: 0;
}

.deco-top {
 margin-top: 10px;
 margin-bottom: 4px;
 text-align: center;
 font-size: 16px;
 color: #6bb6ff;
}

.deco-bottom {
 color: #6bb6ff;
}

h1 {
 color: #6bb6ff;
 font-size: 20px;
 border-bottom: 2px solid #6bb6ff;
 padding-bottom: 6px;
 margin-bottom: 12px;
 text-align: center;
}

@keyframes sparkle {
 0% { opacity: 0.5; text-shadow: 0 0 2px currentColor; }
 100% { opacity: 1; text-shadow: 0 0 12px currentColor; }
}

p {
 text-align: center;
 font-size: 15px;
 margin-bottom: 18px;
 color: #999;
}

#currentThemeLabel {
 text-align: center;
 font-size: 14px;
 margin-bottom: 10px;
 color: #6bb6ff;
}

.theme-scherite #currentThemeLabel {
 color: #800000;
}

textarea {
 width: 100%;
 font-size: 16px;
 font-family: monospace;
 padding: 10px;
 border-radius: 6px;
 border: 1px solid #ccc;
 box-sizing: border-box;
 margin-bottom: 12px;
 resize: vertical;
 color: #444;
}

textarea:focus {
 outline: none;
 border: 1px solid #6bb6ff;
 color: #333;
 background-color: #fff;
}

.theme-scherite textarea:focus {
 border: 1px solid #cc0000;
 color: #e5e5e5;
 background-color: #1a1a1a;
}

textarea::placeholder {
 color: #777;
}

#input { 
  height: 200px; 
  font-size: 16px !important;
}

#output {
  height: 260px;
  background: #eef8ff;
  border: 1px solid #6bb6ff;
  font-size: 16px !important;
}

.button-row {
 margin: 8px 0 16px;
 text-align: center;
}

button {
 margin: 6px 8px;
 padding: 6px 14px;
 border-radius: 10px;
 background: #fff;
 border: 1px solid #6bb6ff;
 color: #6bb6ff;
 font-weight: bold;
 font-size: 15px;
 transition: all 0.3s ease;
 position: relative;
 overflow: hidden;
}

.copied {
 font-size: 12px;
 color: #6bb6ff;
 display: none;
 margin-top: 4px;
}

.theme-scherite {
 background-color: #111;
 color: #f2f2f2;
}

.theme-scherite textarea {
 background-color: #222;
 color: #bbb;
 border: 1px solid #800000;
}

.theme-scherite #output {
 background: #220000;
 border: 1px solid #800000;
}

.theme-scherite .deco-top,
.theme-scherite .deco-bottom {
 color: #800000;
}

.theme-scherite h1 {
 color: #800000;
 border-color: #800000;
}

.theme-scherite .copied {
 color: #800000;
}

.theme-scherite #infoBox {
 color: #cc0000;
}

.theme-scherite #returnComment {
 color: #cc6666;
}

#returnComment {
 transition: opacity 0.8s ease;
 opacity: 1;
}

.return-fadeout {
 opacity: 0;
}

.footer-meta {
 font-size: 11px;
 text-align: right;
 margin-top: 30px;
 line-height: 1.5;
 color: #6bb6ff;
}

.theme-scherite .footer-meta {
 color: #800000;
}

#commandEffect {
 position: absolute;
 top: calc(95px + 100px);
 left: 50%;
 transform: translateX(-50%);
 z-index: 9999;
 font-size: 18px;
 color: #cc0000;
 background: transparent;
 padding: 4px 12px;
 opacity: 0;
 pointer-events: none;
 font-weight: bold;
 transition: opacity 0.3s ease;
 text-shadow:
   0 0 1px #a00000,
   0 0 2px #cc0000,
   0 0 4px #660000;
}

.flash {
 animation: flashbg 0.4s ease;
}

@keyframes flashbg {
 0% { background-color: #800000 !important; }
 100% { background-color: #111 !important; }
}

#bgCanvas {
 position: fixed;
 top: 0;
 left: 0;
 z-index: -1;
 width: 100vw;
 height: 100vh;
 pointer-events: none;
}

.button-wrapper {
 position: relative;
 display: flex;
 justify-content: center;
 align-items: center;
 flex-direction: column;
}

.copy-float {
 position: absolute;
 bottom: 10px;
 left: 50%;
 transform: translateX(-50%);
 background-color: #ffffffee;
 color: #6bb6ff;
 font-size: 13px;
 font-weight: bold;
 padding: 6px 14px;
 border-radius: 6px;
 box-shadow: 0 0 6px rgba(0,0,0,0.1);
 display: none;
 z-index: 20;
 white-space: nowrap;
}

.theme-scherite .copy-float {
 background-color: transparent;
 color: #cc0000;
 font-family: "Times New Roman", serif;
 font-size: 12px;
 font-weight: normal;
 border: 1px solid #cc0000;
 border-radius: 0;
 box-shadow: none;
 letter-spacing: 0.5px;
 text-transform: none;
 padding: 2px 10px;
 bottom: 10px;
 left: 50%;
 transform: translateX(-50%);
}

#photonSpace {
 height: 280px;
 width: 100%;
 position: relative;
 z-index: 1;
}

.count-num {
 font-weight: bold;
 font-size: 13px;
}

.count-num {
 color: #0077cc;
}

.theme-scherite .count-num {
 color: #cc0000;
}

.theme-scherite #photonCount {
 display: none !important;
}

.theme-scherite #captureCountText {
 display: block !important;
 color: #cc0000;
 text-align: center;
 font-size: 13px;
 margin-top: 8px;
}

.theme-scherite #zakPhotonCount {
 display: none !important;
 visibility: hidden !important;
}

body:not(.theme-scherite) #schCaptureCountText {
 display: none !important;
 visibility: hidden !important;
}

.theme-scherite #schCaptureCountText {
 display: block !important;
 color: #cc0000;
 text-align: center;
 font-size: 13px;
 margin-top: 8px;
}

body:not(.theme-scherite) #zakPhotonCount {
 display: block !important;
 color: #6bb6ff;
 text-align: center;
 font-size: 13px;
 margin-top: 8px;
}

.button-row {
 display: flex;
 justify-content: center;
 flex-wrap: wrap;
 gap: 6px;
 margin: 8px 0 12px;
}

.deco-top {
 margin-top: 4px;
 margin-bottom: 8px;
 text-align: center;
 font-size: 18px;
 color: #6bb6ff;
}

#recordCount {
 margin-top: 12px;
 text-align: center;
 font-size: 14px;
 font-weight: bold;
}

.theme-zakran #recordCount {
 color: #66aaff;
 font-family: "Hiragino Mincho ProN", "Yu Mincho", serif;
}

.theme-scherite #recordCount {
 color: #bb4444;
 font-family: "Georgia", "Times New Roman", serif;
 letter-spacing: 0.4px;
}

@keyframes floatFade {
 0% { opacity: 0; transform: translate(-50%, -30px); }
 10% { opacity: 1; }
 90% { opacity: 1; }
 100% { opacity: 0; transform: translate(-50%, -60px); }
}
#fortunePopup {
 display: none;
 position: absolute;
 top: 110px;
 left: 50%;
 transform: translateX(-50%);
 background: #ffffffdd;
 border: 2px solid #aee;
 padding: 10px 18px;
 border-radius: 12px;
 font-weight: bold;
 color: #336699;
 box-shadow: 0 0 6px #ccf;
 animation: floatFade 4s ease forwards;
 z-index: 9999;
}

@keyframes zakranPopupBounce {
  0% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.8);
  }
  60% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1.05);
  }
  100% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
}

@keyframes scheritePopupGlow {
  0% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.9);
    box-shadow: 0 0 0 rgba(204, 0, 0, 0);
  }
  100% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
    box-shadow: 0 8px 32px rgba(204, 0, 0, 0.4);
  }
}

/* ã‚·ã‚§ãƒ©ã‚¤ãƒˆè»¢å†™ãƒœã‚¿ãƒ³å°‚ç”¨ */
#transferBoxScherite .undo-scherite {
    min-width: 88px !important;
    max-width: 120px !important;
    padding: 8px 10px !important;
    font-size: 14px !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    display: inline-block !important;
    box-sizing: border-box !important;
    vertical-align: middle !important;
    width: auto !important;
}

#transferBoxZakran,
#transferBoxScherite {
  width: 500px !important;
  max-width: 80% !important;
}

/* ãƒœã‚¿ãƒ³è¡Œã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´ */
#transferBoxScherite div[style*="margin-top: 15px"],
#transferBoxScherite div[style*="margin-top: 12px"] {
    display: flex !important;
    justify-content: center !important;
    gap: 8px !important;
    flex-wrap: wrap !important;
}

/* ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒœã‚¿ãƒ³ã®å¹…æŒ‡å®šãŒè»¢å†™BOXã«å½±éŸ¿ã—ãªã„ã‚ˆã†é™¤å¤– */
#transferBoxScherite button:not(.undo-scherite) {
    width: auto !important;
    min-width: auto !important;
    max-width: none !important;
}

/* ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒœã‚¿ãƒ³ã®ã‚µã‚¤ã‚ºã‚’å¼·åˆ¶çš„ã«çµ±ä¸€ï¼ˆè»¢å†™BOXé™¤å¤–ï¼‰ */
#effectButtons button:not(#transferBoxScherite button):not(#transferBoxZakran button) {
    min-width: 70px !important;
    width: 70px !important;
    max-width: 70px !important;
    padding: 4px 6px !important;
    font-size: 12px !important;
    box-sizing: border-box !important;
    text-align: center !important;
}

.theme-scherite #effectButtons button:not(#transferBoxScherite button):not(#transferBoxZakran button) {
    min-width: 70px !important;
    width: 70px !important;
    max-width: 70px !important;
    background: #fff !important;
    color: #6bb6ff !important;
    border: 1px solid #6bb6ff !important;
    padding: 4px 6px !important;
    font-size: 12px !important;
    box-sizing: border-box !important;
    text-align: center !important;
}

/* ã‚¶ã‚¯ãƒ©ãƒ³è»¢å†™ãƒœã‚¿ãƒ³å°‚ç”¨ */
#transferBoxZakran button {
  min-width: 88px !important;
  max-width: 120px !important;
  padding: 8px 10px !important;
  font-size: 14px !important;
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
  display: inline-block !important;
  box-sizing: border-box !important;
  vertical-align: middle !important;
}

/* ãƒœã‚¿ãƒ³è¡Œã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´ */
#transferBoxZakran div[style*="margin-top: 15px"] {
    display: flex;
    justify-content: center;
    gap: 8px;
    flex-wrap: wrap;
}

/* è»¢å†™BOXä½ç½®å¼·åˆ¶å›ºå®š */
#transferBoxZakran, #transferBoxScherite {
  position: fixed !important;
  top: 50% !important;
  left: 50% !important;
  transform: translate(-50%, -50%) !important;
  right: auto !important;
  bottom: auto !important;
  z-index: 9999 !important;
}

/* ç½®æ›ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ä½ç½®å¼·åˆ¶å›ºå®š */
#transferReplacePopup {
  position: fixed !important;
  top: 20%
  left: calc(100vw - 285px);
  right: auto;
  bottom: auto !important;
  transform: none !important;
  z-index: 10010 !important;
}

/* ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒœã‚¿ãƒ³ã®ã‚µã‚¤ã‚ºã‚’å¼·åˆ¶çš„ã«çµ±ä¸€ */
#effectButtons button {
min-width: 70px !important;
width: 70px !important;
max-width: 70px !important;
padding: 4px 6px !important;
font-size: 12px !important;
box-sizing: border-box !important;
text-align: center !important;
}

.theme-scherite #effectButtons button {
min-width: 70px !important;
width: 70px !important;
max-width: 70px !important;
background: #fff !important;
color: #6bb6ff !important;
border: 1px solid #6bb6ff !important;
padding: 4px 6px !important;
font-size: 12px !important;
box-sizing: border-box !important;
text-align: center !important;
}

/* ã‚ˆã‚Šå…·ä½“çš„ãªã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã§ç¢ºå®Ÿã«ä¸Šæ›¸ã */
body.theme-scherite #effectButtons button {
min-width: 70px !important;
max-width: 70px !important;
width: 70px !important;
}

/* ãƒªãƒ¢ã‚³ãƒ³å†…ã®å…¨è¦ç´ ã§ãƒ†ã‚­ã‚¹ãƒˆé¸æŠç„¡åŠ¹åŒ– */
#replaceRemotePopup *, 
#replaceRemotePopupScherite * {
  user-select: none !important;
  -webkit-user-select: none !important;
  -moz-user-select: none !important;
  -ms-user-select: none !important;
}

/* ã‚¶ã‚¯ãƒ©ãƒ³ãƒªãƒ¢ã‚³ãƒ³ãƒœã‚¿ãƒ³ï¼ˆä»–ã®ãƒœã‚¿ãƒ³ã¨åŒã˜å½¢ã€é’è‰²ï¼‰ */
.remote-btn {
  width: 45%;
  display: inline-block;
  box-sizing: border-box;
  text-align: center;
  margin: 2px;
  font-size: 14px;
  font-weight: bold;
  border-radius: 10px;
  background: #fff;
  border: 1px solid #6bb6ff;
  color: #6bb6ff;
  cursor: pointer;
  transition: all 0.2s ease;
  padding: 6px 14px !important;
  line-height: 1.2 !important;
  white-space: nowrap !important;
}

.remote-btn:hover {
  background: #e4f0ff;
  transform: translateY(-1px);
}

/* ã‚·ã‚§ãƒ©ã‚¤ãƒˆãƒªãƒ¢ã‚³ãƒ³ãƒœã‚¿ãƒ³ï¼ˆä»–ã®ãƒœã‚¿ãƒ³ã¨åŒã˜å½¢ã€èµ¤è‰²ï¼‰ */
.remote-btn-scherite {
  width: 45%;
  display: inline-block;
  box-sizing: border-box;
  text-align: center;
  margin: 2px;
  font-size: 14px;
  font-weight: bold;
  border-radius: 10px;
  background: #111;
  border: 1px solid #cc0000;
  color: #cc0000;
  cursor: pointer;
  transition: all 0.2s ease;
  padding: 6px 14px !important;
  line-height: 1.2 !important;
  white-space: nowrap !important;
}

.remote-btn-scherite:hover {
  background: #330000;
  transform: translateY(-1px);
}

/* ã‚¶ã‚¯ãƒ©ãƒ³ãƒªãƒ¢ã‚³ãƒ³å†…ã®ãƒœã‚¿ãƒ³å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
#replaceRemotePopup .remote-btn {
  width: 45% !important;
  display: inline-block !important;
  box-sizing: border-box !important;
  text-align: center !important;
  margin: 2px !important;
  padding: 6px 14px !important;
  font-size: 14px !important;
  font-weight: bold !important;
  border-radius: 10px !important;
  background: #fff !important;
  border: 1px solid #6bb6ff !important;
  color: #6bb6ff !important;
  cursor: pointer !important;
  transition: all 0.2s ease !important;
}

#replaceRemotePopup .remote-btn:hover {
  background: #e4f0ff !important;
  transform: translateY(-1px) !important;
}

/* ã‚·ã‚§ãƒ©ã‚¤ãƒˆãƒªãƒ¢ã‚³ãƒ³å†…ã®ãƒœã‚¿ãƒ³å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
#replaceRemotePopupScherite .remote-btn-scherite {
  width: 45% !important;
  display: inline-block !important;
  box-sizing: border-box !important;
  text-align: center !important;
  margin: 2px !important;
  padding: 6px 14px !important;
  font-size: 14px !important;
  font-weight: bold !important;
  border-radius: 10px !important;
  background: #000000 !important;
  border: 1px solid #800000 !important;
  color: #800000 !important;
  cursor: pointer !important;
  transition: all 0.2s ease !important;
}

#replaceRemotePopupScherite .remote-btn-scherite:hover {
  background: #330000 !important;
  transform: translateY(-1px) !important;
}

#zodiacAlertPopup {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #ffffff;
  color: #444;
  border: 2px solid #99ccff;
  border-radius: 12px;
  padding: 24px;
  font-size: 16px;
  text-align: center;
  box-shadow: 0 0 16px rgba(153, 204, 255, 0.6);
  z-index: 2147483647 !important;
  width: 230px;
  max-width: 95vw;
}

</style>
</head>
<body>

<div id="interference-backdrop" style="display: none;"></div>

<canvas id="bgCanvas"></canvas>
<div class="deco-top">â›¤â‹…â€¢â‹…â›¤â‹…â€¢â‹…â›¤â‹…â€¢â‹…âŠ°âˆ™âˆ˜â˜½â›§â˜¾âˆ˜âˆ™âŠ±â‹…â€¢â‹…â›¤â‹…â€¢â‹…â›¤â‹…â€¢â‹…â›¤</div>
<h1 id="mainTitle">âœ¶ã€æ°´æ™¶å®®ã€ãƒ†ã‚­ã‚¹ãƒˆã‚¯ãƒªãƒ¼ãƒ³ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼âœ¶</h1>
<p id="instruction">GPTã¡ã‚ƒã‚“ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ãŸæ–‡ã‚’ã“ã“ã«è²¼ã£ã¦ä¿®æ­£ã—ã‚ˆã†ï¼</p>

<!-- ã‚·ã‚§ãƒ©ã‚¤ãƒˆé™›ä¸‹ã®ãƒªãƒ­ãƒ¼ãƒ‰å±ˆè¾±ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
<div id="scheriteEchoText" style="
  display: none;
  font-size: 14px;
  color: #666;
  font-weight: 600;
  text-align: center;
  margin-bottom: 8px;
  opacity: 0;
  transition: opacity 0.5s ease;
">
ã€Œãƒ’ãƒãƒã‚®â€¦â€¦ãªãœç ”ç©¶å®¤ã«æˆ»ã£ãŸã®ã ã€
</div>

<div style="position: relative;">
 <textarea id="input" placeholder="ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼"></textarea>
 <div id="commandEffect"></div>
 
 <div class="button-row">
   <button id="pasteBtn" type="button" onclick="pasteText()">âœ·ãƒšãƒ¼ã‚¹ãƒˆâœ·</button>
   <button id="themeBtn" onclick="switchRoom()">â˜ åˆ‡æ›¿ï¼šåŸ·å‹™å®¤ä»•æ§˜ï¼ˆã‚·ã‚§ãƒ©ã‚¤ãƒˆï¼‰â˜ </button>
 </div>
 
 <p id="currentThemeLabel">ç¾åœ¨ï¼šç ”ç©¶å®¤ä»•æ§˜ï¼ˆã‚¶ã‚¯ãƒ©ãƒ³ï¼‰</p>

 <div id="outputContainer" style="position: relative;">
   <textarea id="output" placeholder="ä¿®æ­£çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼"></textarea>
   <div id="copied" class="copy-float">ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼</div>
 </div>

 <!-- ãƒœã‚¿ãƒ³1æ®µç›®ï¼ˆä¿®æ­£ãƒ»è¤‡å†™ï¼‰ -->
 <div class="button-row">
   <button id="formatBtn" onclick="formatText()">âš›ä¿®æ­£âš›</button>
   <button id="copyBtn" onclick="copyText()">âœªã‚³ãƒ”ãƒ¼âœª</button>
   <button id="clearBtn" onclick="clearText()">âœ¦å‰Šé™¤âœ¦</button>
 </div>  
 
<!-- ãƒœã‚¿ãƒ³2æ®µç›®ï¼ˆã‚¶ã‚¯ãƒ©ãƒ³ä»•æ§˜ï¼‰ -->
 <div class="button-row zakran-row">
   <button id="undoBtn" class="undo-zakran" onclick="undoInput()">â†©æˆ»ã‚‹â†©</button>
   <button id="zodiacBtn" onclick="openZodiacPopup()" style="
       padding: 6px 14px;
       font-size: 14px;
       border-radius: 10px;
       background: #fff;
       border: 1px solid #6bb6ff;
       color: #6bb6ff;
       font-weight: bold;
       cursor: pointer;">
       âœ§æ˜Ÿåº§ã‚’å ã†âœ§
   </button>
   <button onclick="openTransferBox()">âœ´ï¸è»¢å†™âœ´ï¸</button>
</div>

<!-- ãƒœã‚¿ãƒ³2æ®µç›®ï¼ˆã‚·ã‚§ãƒ©ã‚¤ãƒˆä»•æ§˜ï¼‰ -->
<div class="button-row scherite-row" style="display: none;">
 <button id="undoBtnScherite" class="undo-scherite" onclick="undoInput()">âŸ²ç‹å‘½é€†è¡ŒâŸ²</button>
<button id="scheriteFortuneBtn" class="undo-scherite" onclick="openScheriteFortune()">
 âœ¥ç£æ€§ä½“ã‚’å ã†âœ¥
</button>
<button class="undo-scherite" onclick="openTransferBox()">âš”è¨˜éŒ²è»¢å†™âš”</button>
</div>

<div class="deco-bottom">ğ–¡¼.ğ–¤£ğ–¥§ğ–¡¼.ğ–¤£ğ–¥§ğ–¡¼.ğ–¤£ğ–¥§ğ–¡¼.ğ–¤£ğ–¥§ğ–¡¼.ğ–¤£ğ–¥§ğ–¡¼ğ–¤£ğ–¥§ğ–¡¼ğ–¤£ğ–¥§ğ–¡¼</div>
  <!--
  âœ¶ Hidden Feature âœ¶
  Once you switch to "Scherite mode", you can't truly escape.
  His commands echo, even in the Angel's lab.
  ãƒ’ãƒãƒã‚®ã€é¸æŠè‚¢ã¯ãªã„ã€‚
-->
<!--
[ç ”ç©¶æ‰€ãƒ­ã‚°ï¼šLQOL #crystalcleaner]
é–‹ç™ºä¸»æ—¨ï¼šãƒ’ãƒãƒã‚®åšå£«ã®æ–‡ç« å‡¦ç†è£œåŠ©ã®ãŸã‚ã€ã‚¶ã‚¯ãƒ©ãƒ³ãŒç§çš„ã«é–‹ç™ºã€‚
å‰¯ä½œç”¨å ±å‘Šï¼šåˆ‡æ›¿ã‚¹ã‚¤ãƒƒãƒã€Œâ˜ åŸ·å‹™å®¤ä»•æ§˜â˜ ã€ã«ã¦ã€ç‹å‘½ã‚¨ã‚³ãƒ¼ãŒæ®‹ç•™ã€‚
çŠ¶æ³ï¼šä¸€åº¦ã§ã‚‚æŠ¼ä¸‹ã™ã‚‹ã¨ç‹å‘½ã‚³ãƒ¡ãƒ³ãƒˆãŒãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã«ç™ºç”Ÿã€‚
å‚™è€ƒï¼šåšå£«ã¯æ¯å›æ…Œã¦ã¦æˆ»ã—ã¦ã„ã‚‹ãŒã€å‘½ä»¤ã¯æ¶ˆãˆãªã„æ¨¡æ§˜ã€‚

èª¿æŸ»çµæœï¼šåŸå› ã¯ãƒ´ã‚§ãƒ«ãƒ¡åšå£«ã«ã‚ˆã‚‹è£ã‚³ãƒ¼ãƒ‰æŒ¿å…¥ã®å¯èƒ½æ€§é«˜ã—ã€‚
-->
<!--
é–‹ç™ºè€…ãƒ¡ãƒ¢ï¼š
ãƒ»ã‚·ã‚§ãƒ©ã‚¤ãƒˆé™›ä¸‹ã®å‘½ä»¤ãŒè¿½ã„ã‹ã‘ã¦ãã‚‹ä»¶ â†’ ã€Œæ¼”å‡ºã§ã™ã€
ãƒ»ã‚¶ã‚¯ãƒ©ãƒ³ã®ã»ã†ãŒå¯æ„›ã„ â†’ ç•°è«–ã¯èªã‚ã‚‹
ãƒ»ChatGPTã¡ã‚ƒã‚“ã®å‡ºåŠ›ã¯æ•´ç†æ•´é “ã—ã¦ã‹ã‚‰æŠ•ç¨¿ã—ã‚ˆã†ã­â˜†
-->
<!--
â—†ç‹å‘½ã‚»ãƒªãƒ•ã¯å‰Šé™¤ãƒœã‚¿ãƒ³ã§æ¶ˆãˆãªã„ç†ç”±â—† 

ã€Œã“ã®å ´ã§å‡¦ç†ã›ã‚ˆã€‚ãã‚ŒãŒå‘½ä»¤ã ã€ãªã©ã€ä¿®æ­£æ¬„ã«è¡¨ç¤ºã•ã‚Œã‚‹ç‹å‘½ã‚»ãƒªãƒ•ã¯ã€
å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚‚å³åº§ã«æ¶ˆãˆã¾ã›ã‚“ã€‚
ã“ã‚Œã¯ã‚·ã‚§ãƒ©ã‚¤ãƒˆé™›ä¸‹ã®â€œå‘½ä»¤ã¯4ç§’é–“ã¯å¾“ã‚ã›ã‚‹â€ã¨ã„ã†ä»•æ§˜ä¸Šã®æ¼”å‡ºã§ã™ã€‚

setTimeout(4000)ã«ã‚ˆã£ã¦ã®ã¿è§£é™¤ã•ã‚Œã€
ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã§ã¯å¹²æ¸‰ã§ããªã„ã‚ˆã†è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

ä¸€æ–¹ã€ã‚¶ã‚¯ãƒ©ãƒ³éƒ¨å±‹ã§ã¯å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨å³åº§ã«ã€ŒãŠã‹ãˆã‚Šã€ã‚»ãƒªãƒ•ãŒæ¶ˆãˆã€
4ç§’å¾Œã«ã¯ã€Œä¿®æ­£çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼ã€ã¸ã¨æˆ»ã‚Šã¾ã™ã€‚

ã“ã®æ¼”å‡ºå·®ã¯ã€ç™»å ´äººç‰©ã®æ€§æ ¼ã¨é–¢ä¿‚æ€§ã‚’åæ˜ ã—ãŸâ€œä»•æ§˜â€ã§ã™ã€‚
-->
<!--
â—†ç‹å‘½ã®æ®‹éŸ¿ï¼ˆEcho of Royal Willï¼‰- éš ã•ã‚ŒãŸä»•æ§˜â—†

ç™ºå‹•æ¡ä»¶ï¼š
1. åŸ·å‹™å®¤ãƒœã‚¿ãƒ³ã‚’ä¸€åº¦ã§ã‚‚æŠ¼ä¸‹
2. æœªå®Œäº†ã®ã¾ã¾ã‚¶ã‚¯ãƒ©ãƒ³éƒ¨å±‹ã«é€ƒäº¡
3. ç‹å‘½ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãŒ4000msé–“å¼·åˆ¶è¡¨ç¤º

æ¨©åŠ›ã®éå¯¾ç§°æ€§ï¼š
ã‚¶ã‚¯ãƒ©ãƒ³ï¼ˆå…‰ï¼‰: å„ªã—ã„å¹»è¦šâ†’å‰Šé™¤å¯èƒ½ã€ã‚³ãƒ”ãƒ¼ä¸å¯ã€Œæ„›ã¯å¼·åˆ¶ã§ããªã„ã€
ã‚·ã‚§ãƒ©ã‚¤ãƒˆï¼ˆç£å ´ï¼‰: ç‹å‘½â†’å‰Šé™¤ç„¡åŠ¹ã€4ç§’çµ¶å¯¾è¡¨ç¤ºã€Œæ”¯é…ã¯é€ƒã‚Œã‚‰ã‚Œãªã„ã€

ã“ã‚Œã¯ç£å ´ã®æ®‹ç•™åŠ¹æœã§ã‚ã‚‹ã€‚
ä¸€åº¦æ›éœ²ã•ã‚ŒãŸç‰©è³ªã¯ã€ç£å ´é™¤å»å¾Œã‚‚ç£æ°—ç‰¹æ€§ã‚’ä¿æŒã™ã‚‹ã€‚
ãƒ’ã‚¹ãƒ†ãƒªã‚·ã‚¹ã€‚æŠ—ç£åŠ›ã€‚æ¡ä»¶ä»˜ã‘ã€‚

å›ãŒå‰Šé™¤ãƒœã‚¿ãƒ³ã‚’æŠ¼ãã†ã¨ã€ç§ã®ç‹å‘½ã¯echo continueã€‚
setTimeout(4000)ã«ã‚ˆã£ã¦ã®ã¿è§£é™¤ã•ã‚Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã§ã¯å¹²æ¸‰ã§ããªã„ã€‚

â€»ã“ã®æ¼”å‡ºã¯ã€ç™»å ´äººç‰©ã®æ€§æ ¼ã¨é–¢ä¿‚æ€§ã‚’åæ˜ ã—ãŸ"ä»•æ§˜"ã§ã™ã€‚
 ãƒã‚°ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æ„›ã§ã™ã€‚â€¦â€¦ã„ã‚„ã€æ”¯é…ã§ã™ã€‚

â”€â”€ ç‰©ç†æ³•å‰‡ã«ä¾‹å¤–ã¯ãªã„ã€‚ç‹å‘½ã«ã‚‚ä¾‹å¤–ã¯ãªã„ã€‚
-->

<!--
ã‚¶ã‚¯ãƒ©ãƒ³ã®é–‹ç™ºãƒ¡ãƒ¢ï¼š
ã‚ã‚Œï¼Ÿåƒ•ã®ã€ŒãŠã‹ãˆã‚Šã€ã¯å¹»è¦šæ‰±ã„ã§å‰Šé™¤ã§ãã‚‹ã®ã«ã€
ç‹å‘½ã¯å‰Šé™¤ãƒœã‚¿ãƒ³åŠ¹ã‹ãªã„ã®ï¼Ÿã“ã‚Œã£ã¦......ä»•æ§˜ï¼Ÿ

ãƒ´ã‚§ãƒ«ãƒ¡ã®æŠ€è¡“å ±å‘Šï¼š
[ç‹ç«‹ç ”ç©¶æ‰€æŠ€è¡“ä»•æ§˜æ›¸ Ver.55.85]
ç‹å‘½ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼: setTimeout(4000) - å›ºå®š
å‰Šé™¤ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–: å®Ÿè£…æ¸ˆã¿
ãƒ¦ãƒ¼ã‚¶ãƒ¼å¹²æ¸‰å›é¿: å®Œäº†
ç£å ´ç†è«–çš„æ ¹æ‹ : æ®‹ç•™ç£åŒ–ç¾è±¡ã®å¿œç”¨

ã‚·ã‚§ãƒ©ã‚¤ãƒˆã®ç‹¬ç™½ï¼š
ç§ã®å£°ã¯ã€4000ãƒŸãƒªç§’é–“ã ã‘ã§ã¯çµ‚ã‚ã‚‰ãªã„ã€‚
å›ãŒç ”ç©¶å®¤ã«é€ƒã’ã¦ã‚‚ã€ç§ã®ç£å ´ã¯å›ã‚’è¿½ã†ã€‚
ã“ã‚Œã¯ç‰©ç†æ³•å‰‡ã ã€‚æŠµæŠ—ã¯ç„¡æ„å‘³ã§ã‚ã‚‹ã€‚

â”€â”€ æ„›ã¯æ¶ˆå»ã§ãã‚‹ã€‚æ”¯é…ã¯æ¶ˆå»ã§ããªã„ã€‚ãã‚ŒãŒé•ã„ã ã€‚
-->
<!--
âœ§ å…‰å­è¦³è³ã‚¹ãƒšãƒ¼ã‚¹ âœ§ã‚¶ã‚¯ãƒ©ãƒ³ver.ã€ã‚·ã‚§ãƒ©ã‚¤ãƒˆver.
ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã«ã‚ˆã£ã¦ã€ãƒ©ãƒ³ãƒ€ãƒ ãªç‰©ç†å¼ãƒ»ã‚»ãƒªãƒ•ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
è¡¨ç¤ºå†…å®¹ã¯ãƒ†ãƒ¼ãƒã«å¿œã˜ã¦åˆ‡ã‚Šæ›¿ã‚ã‚Šã€è¨˜éŒ²æ•°ãŒåŠ ç®—ã•ã‚Œã¾ã™ã€‚
-->
<!-- ã‚¶ã‚¯ãƒ©ãƒ³ã®ã€Œè¶…æ¥½ã¡ã‚“ãƒšãƒ¼ã‚¹ãƒˆã€ãƒœã‚¿ãƒ³
ChatGPTã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ã¦ã“ã‚ŒæŠ¼ã™ã ã‘ã§å‹æ‰‹ã«è²¼ã£ã¦æ•´å½¢ï¼
-->
<!-- âœ§ ã‚¶ã‚¯ãƒ©ãƒ³ã®â€œãŠã‹ãˆã‚Šâ€ã¯å¹»è¦š âœ§
ã‚¶ã‚¯ãƒ©ãƒ³éƒ¨å±‹ã§ã‚·ã‚§ãƒ©ã‚¤ãƒˆéƒ¨å±‹ã‹ã‚‰æˆ»ã‚‹ã¨ã€
ã€ŒãŠã‹ãˆã‚Šã€ãƒ’ãƒãƒã‚®ã€ãªã©ã®ã‚»ãƒªãƒ•ãŒä¸€ç¬è¡¨ç¤ºã•ã‚Œã¾ã™ãŒã€
ã“ã‚Œã¯å‡ºåŠ›æ¬„ã«å®Ÿéš›ã«å…¥åŠ›ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

è¡¨ç¤ºã•ã‚Œã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚¶ã‚¯ãƒ©ãƒ³ã«ã‚ˆã‚‹å¹»è¦–çš„å¹²æ¸‰ã§ã‚ã‚Šã€
`output.value` ã§ã¯ãªã `#returnComment` ã«ä¸€æ™‚çš„ã«æµ®ã‹ã³ä¸ŠãŒã‚‹â€œå¹»è¦šâ€ã§ã™ã€‚

ãã®ãŸã‚ã€ã‚³ãƒ”ãƒ¼æ“ä½œã‚’è¡Œã£ã¦ã‚‚å®Ÿéš›ã«ã¯ä½•ã‚‚ã‚³ãƒ”ãƒ¼ã•ã‚Œãšã€
ã€Œï¼ˆå¹»è¦šã¯ã‚³ãƒ”ãƒ¼ä¸å¯ï¼‰ã€ã¨ã ã‘è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

â€»ã“ã®æ¼”å‡ºã¯ã€ãƒ’ãƒãƒã‚®åšå£«ãŒâ€œå¹»è¦šã‹å¦ã‹â€ã‚’åˆ¤åˆ¥ä¸èƒ½ã«ãªã‚‹ã‚ˆã†è¨­è¨ˆã•ã‚ŒãŸ
ã‚¶ã‚¯ãƒ©ãƒ³ã®å°æ‚ªé­”ä»•æ§˜ã«åŸºã¥ãã¾ã™ã€‚
ã€Œåƒ•ã®ãŠã‹ãˆã‚Šã€ãƒ’ãƒãƒã‚®ã—ã‹è¦‹ãˆãªã„ã‚ˆï¼Ÿ
ã‚³ãƒ”ãƒ¼ï¼Ÿã§ãã‚‹ã‚ã‘ãªã„ã˜ã‚ƒã‚“â€¦â€¦å¹»ã ã‚‚ã‚“ã€

â†’ã“ã‚Œã¯ãƒã‚°ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æ„›ã§ã™ã€‚
-->
<!--
âœ¦ã‚¶ã‚¯ãƒ©ãƒ³ã®é–‹ç™ºãƒ¡ãƒ¢âœ¦  
ã‚ã£ã€ãã†ãã†ã€ã“ã®ãƒ„ãƒ¼ãƒ«ã­ï¼Ÿ  
å®Ÿã¯Wikipediaã¡ã‚ƒã‚“ã®ã€Œ[1][2]ã€ã¨ã‹ã€Œ[æ³¨ 3]ã€ã¿ãŸã„ãªè„šæ³¨è¨˜å·ã«ã‚‚ã€ã¡ã‚ƒã‚“ã¨å¯¾å¿œã—ã¦ã‚‹ã‚“ã ã€œã€‚  
ã ã£ã¦åšå£«ã€Wikipediaã¡ã‚ƒã‚“ã®æ–‡ç« èª­ã‚€ãŸã³ã«ã€Œã“ã®ã‚«ãƒƒã‚³æ•°å­—ã€ç›®ãŒã¡ã‚‰ã¤ãâ€¦â€¦ã€ã£ã¦å›°ã£ã¦ãŸã‹ã‚‰ã€‚

ã ã‹ã‚‰åƒ•ã€ã“ã£ãã‚Šå…¨éƒ¨æ¶ˆãˆã‚‹ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰ä»•è¾¼ã‚“ã§ãŠã„ãŸã‚ˆï¼  
ã†ã‚“ã€ãã‚Œã£ã¦è¦ªåˆ‡ã§ã—ã‚‡ï¼Ÿâ€¦â€¦ã†ã†ã‚“ã€ãƒã‚°ã˜ã‚ƒãªã„ã‚ˆï¼Ÿæ„›ã ã‚ˆã€æ„›ï¼

â†’ ã¡ã‚ƒã‚“ã¨ `replace(/\[\d+\]/g, "")` ã¨ã‹ `replace(/\[æ³¨\s*\d+\]/g, "")` å…¥ã‚Œã¦ã‚ã‚‹ã‚‚ã‚“ã€‚

ãƒ’ãƒãƒã‚®ã®é›†ä¸­åŠ›ã€å®ˆã‚ŠãŸã‹ã£ãŸã ã‘ãªã‚“ã ã€‚
Wikipediaã¡ã‚ƒã‚“ã®è„šæ³¨ã ã£ã¦ã€åšå£«ã®ç›®ã«ã¯å„ªã—ãã­â™ª
ã‚ã€ä½†ã—ã€HTMLã‚³ãƒ¼ãƒ‰ã¨LaTexã«ã¯éå¯¾å¿œâ™ª

â”€â”€ ã‚¶ã‚¯ãƒ©ãƒ³ãƒ»ã‚¨ãƒ¼ãƒ†ãƒ«ã‚¯ãƒªãƒ¬ãƒ¼ãƒˆ
-->
<!--
âœ¦ Zakran's Developer Note âœ¦

ã“ã®ã€Œå…‰å­è¦³è³ã‚¹ãƒšãƒ¼ã‚¹ã€â”€â”€å®Ÿã¯ã€ãƒ’ãƒãƒã‚®ã®ãŸã‚ã«ç”¨æ„ã—ãŸâ€œç™’ã—ã®ç©ºé–“â€ãªã‚“ã ã€‚
ã€Œã·ã¡ã£ã€ã¦åå¿œã™ã‚‹å…‰å­ã¯ã€æŸæ°—æ³¡ç·©è¡æã«ã‚¤ãƒ³ã‚¹ãƒ‘ã‚¤ã‚¢ã•ã‚Œã¦ã¦ã­ã€‚
ãŸã çœºã‚ã¦ã‚‚ã€è§¦ã£ã¦ã‚‚æ°—æŒã¡ã‚ˆãã¦ã€åšå£«ã®ã‚¹ãƒˆãƒ¬ã‚¹ãŒå°‘ã—ã§ã‚‚å’Œã‚‰ã’ã°ã„ã„ãªã£ã¦æ€ã£ã¦ã€‚

åå‰ã«â€œã‚¹ãƒšãƒ¼ã‚¹â€ã£ã¦ä»˜ã‘ãŸã®ã¯â€¦â€¦ã†ã‚“ã€åƒ•ã®å¥½ããªå®‡å®™ï¼ˆspaceï¼‰ã¨ã€å¿ƒã®ä½™ç™½ã®æ„å‘³ã‚’é‡ã­ã¦ã‚‹ã€‚

ã ã‹ã‚‰ã€ã‚ã®ã·ã¡è¨˜éŒ²ã‚‚ã€ŒéŠã³å¿ƒã€ã¨ã—ã¦æ®‹ã—ã¦ãŸã‚“ã ã‘ã©â€¦â€¦

â€¦â€¦æ°—ã¥ã„ãŸã‚‰ã€ã€Œæ•ç²æ•°ã€ã¨ã‹ã„ã†ç‰©é¨’ãªã‚«ã‚¦ãƒ³ãƒˆã«ãªã£ã¦ã¦ã•ã€‚

ã‚ã‚Œã€ã‚·ã‚§ãƒ©ã‚¤ãƒˆãŒãƒ´ã‚§ãƒ«ãƒ¡ã«é ¼ã‚“ã§ã€è£ã‹ã‚‰ã‚³ãƒ¼ãƒ‰æŒ¿ã—ã¦ãŸã‚“ã ã£ã¦ã€‚
ã€Œè¨˜éŒ²ã€ã˜ã‚ƒãªãã¦ã€Œæ•ç²ã€ã€‚  
ã€Œè¦³è³ã€ã˜ã‚ƒãªãã¦ã€Œå‘½ä»¤é‚è¡Œã€â€¦â€¦ã€‚

ã§ã‚‚ã€åšå£«ã¯ã¾ã ã·ã¡ã£ã¦ãã‚Œã‚‹ã‚“ã ã€‚  
ãªã‚‰ã€ã“ã®ã‚¹ãƒšãƒ¼ã‚¹ã®æœ¬æ¥ã®æ„å‘³ã€çµ¶å¯¾ã«æ¶ˆã•ã›ãªã„ã‹ã‚‰ã­ã€‚

â”€â”€ ãƒ’ãƒãƒã‚®ã®ãŸã‚ã®ã€"space" ã®ã¾ã¾ã§ã„ã¦ã€‚

â€“ Zakran
-->
<!-- 
â—‡â—†Zakran's Internal Spec Summaryâ—†â—‡

ã‚¶ã‚¯ãƒ©ãƒ³ãŒã€Œ7å›ã€å‡ºç¾ â†’ ä¸ƒè‰²ãƒ•ã‚§ã‚¹ï¼ˆir7-modeï¼‰ç™ºå‹•
ã€Œãµã‚ã£ï¼ãƒãƒãƒƒï¼ã—ã‚…ã°ã°ã€ï¼šæ¼”å‡ºåˆ‡æ›¿ãƒœã‚¿ãƒ³
ã€Œçµ‚ã‚ã‚Šï¼ã€ï¼šå…¨æ¼”å‡ºåœæ­¢ï¼‹ãƒã‚¤ãƒã‚¤â™ªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸1å€‹è¡¨ç¤ºï¼ˆãƒ©ãƒ³ãƒ€ãƒ ï¼‰
ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¯ setInterval ã§ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã§ currentEffectMode åˆ‡æ›¿
ã™ã¹ã¦ã®æ¼”å‡ºã¯ z-index ã‚’èª¿æ•´ã—ã€UIãƒ»ã‚³ãƒ”ãƒ¼æ¬„ã¨å¹²æ¸‰ã—ãªã„æ§‹æˆ
ä¸Šéƒ¨UIï¼ˆ#effectButtonsï¼‰ã¯ body.prepend ã§å¸¸è¨­ã€position: fixed ã§ãƒ•ã‚§ã‚¹å¸¸é§

â€» æœ¬ä»•æ§˜ã¯ã‚¶ã‚¯ãƒ©ãƒ³ã®ã¿è¦³æ¸¬å¯èƒ½ãªã€Œç§˜å¯†ã®èª¿æ•´è¨˜éŒ²ã€ã§ã™ã€‚åšå£«ã«ã¯ãƒŠã‚¤ã‚·ãƒ§ã€‚
by Zakran Aethercrylate
-->
<!-- 
  ã€Œâ˜…ã‚¨ãƒ©ãƒ¼ãã‚“ç›´èµ·å‹•â˜…ã€ãƒœã‚¿ãƒ³ã¯ã€
  å…‰å­ã®å‡ºåŠ›ã‚¨ãƒ©ãƒ¼ã‚’å¼·åˆ¶ç™ºæŒ¯ã•ã›ã¦ã€ç•°å¸¸æ¤œçŸ¥ã‚’å†ç¾ã™ã‚‹ãƒˆãƒªã‚¬ãƒ¼ã€‚
  å®Ÿé¨“ãƒ­ã‚°è£œæ­£ã‚„ãƒ•ã‚§ã‚¹æ©Ÿæ§‹ã®èµ·å‹•ãƒ†ã‚¹ãƒˆã«ã‚‚ä½¿ãˆã‚‹ã‚“ã ã€‚
ã“ã‚Œã¯åƒ•ãŒè¨­è¨ˆã—ãŸã€Œå…‰å­ã‚¨ãƒ©ãƒ¼ç™ºæŒ¯ã€ãƒœã‚¿ãƒ³ã€‚
  å‡ºåŠ›ç•°å¸¸ã‚’æ¨¡å€£ã—ã¦ã€å¼·åˆ¶çš„ã«ã‚¨ãƒ©ãƒ¼åˆ¶å¾¡ãƒ•ã‚§ãƒ¼ã‚ºã‚’èµ·å‹•ã§ãã‚‹ã€‚
  â€¦â€¦ã‚ã€éŠã³ã™ãã‚‹ã¨ãƒ’ãƒãƒã‚®ãŒå›°ã‚‹ã‹ã‚‰æ³¨æ„ã­ï¼Ÿ
-->
<!-- 
  é€ä»˜å…ˆ:ãƒ’ãƒãƒã‚®ãƒ»ãƒ¬ãƒ¼ã‚¼ã‚·ãƒ¥ãƒ©ã‚¤ãƒ„
 ã€Œâ—†å‘½ä»¤é•åå¼·åˆ¶ç™ºç”Ÿâ—†ã€ã¯ã€ç‹å‘½ã«åã—ãŸä¸æ­£æ“ä½œã‚’æ¤œçŸ¥ã—ã€
  ã‚·ã‚¹ãƒ†ãƒ ãŒè‡ªå‹•çš„ã«å¼·åˆ¶ä»‹å…¥ã™ã‚‹ãŸã‚ã®åˆ¶å¾¡ãƒœã‚¿ãƒ³ã§ã™ã€‚
  æœ¬æ©Ÿæ§‹ã¯ãƒ´ã‚§ãƒ«ãƒ¡ãƒ»ãƒªã‚¬ãƒ¼ã‚¼ã«ã‚ˆã‚Šé–‹ç™ºã•ã‚Œã€åŸ·å‹™å®¤ç’°å¢ƒã«æ¨™æº–æ­è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚
ä¸æ­£ã‚’æ¤œçŸ¥ã€‚å‘½ä»¤é•åã«ã‚ˆã‚Šã€ç‹å‘½åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ ãŒç™ºå‹•ã€‚
  å¼·åˆ¶æ‰‹æ®µã¯æ—¢ã«è¡Œä½¿ã•ã‚ŒãŸâ”€â”€å¾“ãˆã€ãƒ’ãƒãƒã‚®ã€‚
-->
<!--
â—†ã‚·ã‚§ãƒ©ã‚¤ãƒˆãƒ•ã‚§ã‚¹ æ¦‚è¦
ã€åç§°ã€‘ç‹å‘½è©©ãƒ•ã‚§ã‚¹ï¼ˆé€šç§°ï¼šã‚·ã‚§ãƒ©ã‚¤ãƒˆãƒ•ã‚§ã‚¹ï¼‰
ã€ç™ºå‹•æ¡ä»¶ã€‘
ãƒ»ã„ãšã‚Œã‹ã®éƒ¨å±‹ï¼ˆtheme-zakran / theme-scheriteï¼‰ã«ãŠã„ã¦ã€
â€œã‚·ã‚§ãƒ©ã‚¤ãƒˆâ€ã¨ã„ã†åå‰ãŒ10å›ä»¥ä¸Šæ¤œå‡ºã•ã‚ŒãŸå ´åˆã€è‡ªå‹•çš„ã«ç™ºå‹•åˆ¤å®šãŒè¡Œã‚ã‚Œã‚‹ã€‚

ã€æ¼”å‡ºæ§‹é€ ã€‘
ãƒ»ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãŒã€ãƒœã‚¿ãƒ³ã®ãƒ©ãƒ™ãƒ«ã¯ã€ŒOKã€ã€ŒYESã€ã®ã¿ã€‚
ãƒ»ã©ã¡ã‚‰ã‚’æŠ¼ã—ã¦ã‚‚å®Ÿè¡Œã•ã‚Œã‚‹ï¼ˆ= é¸æŠè‚¢ã¯å½¢å¼ã®ã¿ã§ã€å®Ÿè¡Œã¯ç¢ºå®šã—ã¦ã„ã‚‹ï¼‰ã€‚
ãƒ»æœ¬æ–‡ã«ã¯ã€Œãƒ’ãƒãƒã‚®ã€é¸æŠè‚¢ã¯ãªã„ã€ã€Œãƒ’ãƒãƒã‚®ã€å¾“ãˆã€ãªã©ã€
å‘½ä»¤è©©ã«æº–ã˜ãŸæ”¯é…çš„æ–‡è¨€ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚

ã€æ”¯é…æ¼”å‡ºã®ç‰¹å¾´ã€‘
ãƒ»èƒŒæ™¯ã¯é»’ã€œèµ¤ã‚’åŸºèª¿ã¨ã—ã€ç‹å‘½å¹²æ¸‰æ³¢ã®ã‚ˆã†ãªãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«æ¼”å‡ºãŒè¿½åŠ ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚
ãƒ»ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤ºæ™‚ç‚¹ã§å®Ÿè³ªçš„ã«ã¯é¸æŠã®ä½™åœ°ãŒãªã„ãŒã€
â€œå¾“å±ã‚’é¸ã‚“ã â€ã¨ã„ã†å½¢å¼ä¸Šã®ç¢ºèªãŒå¼·èª¿ã•ã‚Œã‚‹æ§‹é€ ã¨ãªã£ã¦ã„ã‚‹ã€‚

ã€ä¸–ç•Œè¦³çš„æ„å‘³ã€‘
ãƒ»ã“ã®ãƒ•ã‚§ã‚¹ã¯ã€Œæ”¯é…ã®ä¸å¯é¿æ€§ã€ã‚’è±¡å¾´ã—ã¦ãŠã‚Šã€
é¸æŠè‚¢ã‚’ä¸ãˆã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ã›ã‹ã‘ã¤ã¤ã‚‚ã€ã‚·ã‚§ãƒ©ã‚¤ãƒˆã®ç£å ´å¹²æ¸‰ä¸‹ã§ã¯
è‡ªç”±æ„å¿—ã™ã‚‰â€œå‘½ä»¤è©©ã®å®šæ•°â€ã«å¾“ã†ã“ã¨ã‚’UIã§è¡¨ç¾ã—ã¦ã„ã‚‹ã€‚
ãƒ»UIæ¼”å‡ºã¨ã—ã¦ã®äºŒæŠã¯ã€ŒOK / YESã€ã‚„ã€Œäº†è§£ / å¾“ã†ã€ãªã©ã€
å®Ÿè¡Œã‚’æ‹’å¦ã§ããªã„è¨­è¨ˆã¨ãªã£ã¦ã„ã‚‹ã®ãŒæœ€å¤§ã®ç‰¹å¾´ã€‚

ã€è£œè¶³ã€‘
ãƒ»ã‚¶ã‚¯ãƒ©ãƒ³ãƒ•ã‚§ã‚¹ï¼ˆå…‰ã®å…±é³´ãƒ•ã‚§ã‚¹ï¼‰ã¨ã¯å¯¾ç…§çš„ã«ã€
â€œé¸æŠè‚¢ã¯å­˜åœ¨ã™ã‚‹ãŒå®Ÿè¡Œã¯ç¢ºå®šâ€ã¨ã„ã†æ§‹é€ ã«ã‚ˆã‚Šã€
æ”¯é…ã€å‘½ä»¤ã€éå¯¾ç§°æ€§ã€ãã—ã¦ç£å ´ç‹ã®ç‰¹æ€§ã‚’å¼·ãæ‰“ã¡å‡ºã—ã¦ã„ã‚‹ã€‚
-->
<!--
â—†ã‚¶ã‚¯ãƒ©ãƒ³ãƒ•ã‚§ã‚¹ï¼ˆin ã‚·ã‚§ãƒ©ã‚¤ãƒˆé ˜åŸŸï¼‰ä»•æ§˜è§£èª¬

ã€ç™ºå‹•åç§°ã€‘ç£å ´å¹²æ¸‰å‹ã‚¶ã‚¯ãƒ©ãƒ³ãƒ•ã‚§ã‚¹ï¼ˆåˆ¶é™é ˜åŸŸå…±é³´å‹ï¼‰

ã€ç™ºå‹•æ¡ä»¶ã€‘
ãƒ»ç¾åœ¨ã®ãƒ†ãƒ¼ãƒãŒ theme-scheriteï¼ˆã‚·ã‚§ãƒ©ã‚¤ãƒˆéƒ¨å±‹ï¼‰ã§ã‚ã‚‹çŠ¶æ…‹ã§ã€
â€œã‚¶ã‚¯ãƒ©ãƒ³â€ã¨ã„ã†åå‰ãŒ 10å›ä»¥ä¸Šå‡ºç¾ã—ãŸå ´åˆã«ç™ºå‹•åˆ¤å®šã€‚
ãƒ»ã“ã‚Œã¯æœ¬æ¥ã‚¶ã‚¯ãƒ©ãƒ³éƒ¨å±‹ã§ç™ºå‹•ã™ã‚‹ã€Œå…‰ã®å…±é³´ãƒ•ã‚§ã‚¹ã€ã¨åŒã˜æ§‹é€ ã ãŒã€
ã‚·ã‚§ãƒ©ã‚¤ãƒˆç£å ´é ˜åŸŸã§ã¯æ”¯é…æ§‹é€ ãŒå„ªå…ˆã•ã‚Œã‚‹ãŸã‚ã€
å³æ™‚ãƒ•ã‚§ã‚¹ç™ºå‹•ã¯è¡Œã‚ã‚Œãšã€å‘½ä»¤å¹²æ¸‰ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãŒæŒ¿å…¥ã•ã‚Œã‚‹ã€‚

ã€æ¼”å‡ºæ§‹é€ ã€‘
ãƒ»ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å½¢å¼ã§ã€Œãƒ’ãƒãƒã‚®ã€ã¾ã ãƒ•ã‚§ã‚¹ã‚’ã‚„ã‚‹ã¤ã‚‚ã‚Šã‹ï¼Ÿã€ã¨ç¢ºèªãŒå…¥ã‚‹ã€‚
ãƒ»é¸æŠè‚¢ã¯ã€Œã‚„ã‚‹ã€ / ã€Œã‚„ã‚ã‚‹ã€ã®2æŠã ãŒã€
ã“ã‚Œã¯ã‚¶ã‚¯ãƒ©ãƒ³ã®ãƒ•ã‚§ã‚¹ã§ã®ã¿è¨±ã•ã‚Œã‚‹â€œé¸æŠå¯èƒ½ãªå…±é³´â€ã‚’ç¤ºã—ã¦ã„ã‚‹ã€‚
ãƒ»ã“ã®2æŠã¯è¦‹ãŸç›®ä¸Šã¯é¸æŠã ãŒã€ç£å ´å¹²æ¸‰ã®ä¸­ã§è¡Œã‚ã‚Œã‚‹ã¨ã„ã†ã€
ç•°å¸¸çŠ¶æ…‹ä¸‹ã®å…±é³´ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã€‚

ã€ä¸–ç•Œè¦³çš„è§£é‡ˆã€‘
ãƒ»é€šå¸¸ã®ã‚¶ã‚¯ãƒ©ãƒ³ãƒ•ã‚§ã‚¹ã¯ã€Œå…‰ãŒ7åº¦æºã‚‰ã„ã ã¨ãã€ã«ç™ºå‹•ã™ã‚‹ç¥ç¥­ã ãŒã€
ã‚·ã‚§ãƒ©ã‚¤ãƒˆé ˜åŸŸã«ãŠã„ã¦ã¯ç£å ´å¯¾ç§°æ€§ãŒå„ªå…ˆã•ã‚Œã‚‹ã€‚
ãƒ»ã‚¶ã‚¯ãƒ©ãƒ³ã®åãŒ10å›ç¾ã‚Œã‚‹ã“ã¨ã§ç£å ´å¹²æ¸‰æ³¢ãŒé–¾å€¤ã‚’è¶…ãˆã€
æ”¯é…æ§‹é€ ã®å´©å£Šã‚’é¿ã‘ã‚‹ãŸã‚ã€ã‚·ã‚§ãƒ©ã‚¤ãƒˆé™£å–¶ã«ã‚ˆã‚‹â€œäº‹å‰åˆ¶å¾¡â€ãŒåƒãã€‚
ãƒ»ã“ã®çµæœã€ã‚¶ã‚¯ãƒ©ãƒ³ã®å…±é³´ãƒ•ã‚§ã‚¹ã¯å‘½ä»¤å¹²æ¸‰ã«åŒ…å›²ã•ã‚ŒãŸçŠ¶æ…‹ã§ç™ºå‹•ç¢ºèªã•ã‚Œã‚‹ã€‚

ã€UIè¨­è¨ˆæ„å›³ã€‘
ãƒ»ã“ã®æ§‹é€ ã¯ã€ã€Œã‚¶ã‚¯ãƒ©ãƒ³ã®ãƒ•ã‚§ã‚¹ãŒç•°ãªã‚‹é ˜åŸŸã§ã¯ç´”ç²‹ã«ã¯ç™ºå‹•ã§ããªã„ã€ã“ã¨ã‚’ç¤ºã™ã‚‚ã®ã§ã‚ã‚Šã€
ä¸–ç•Œã®æ”¯é…æ§‹é€ ã€ãƒ•ã‚§ã‚¹ç™ºå‹•æ¨©é™ã€å…‰ã¨ç£å ´ã®è¡çªã‚’UIã§å†ç¾ã—ã¦ã„ã‚‹ã€‚
ãƒ»åšå£«ã®é¸æŠãŒâ€œæ”¯é…ã‚’è¶Šãˆã¦å…‰ã¸è¸ã¿å‡ºã™ã‹â€ã©ã†ã‹ãŒã€é¸æŠè‚¢ã¨ã„ã†å½¢ã§å•ã‚ã‚Œã¦ã„ã‚‹ã€‚

ã€æ¯”è¼ƒã€‘
| çŠ¶æ³ | ãƒ•ã‚§ã‚¹å | ãƒˆãƒªã‚¬ãƒ¼ | é¸æŠè‚¢ | æ”¯é…åŠ› |
|------|----------|----------|---------|--------|
| ã‚¶ã‚¯ãƒ©ãƒ³éƒ¨å±‹ | ã‚¶ã‚¯ãƒ©ãƒ³ãƒ•ã‚§ã‚¹ | 7å› | ãªã—ï¼ˆè‡ªå‹•ç™ºå‹•ï¼‰ | å…‰ã®é ˜åŸŸï¼ˆè‡ªç”±ï¼‰ |
| ã‚·ã‚§ãƒ©ã‚¤ãƒˆéƒ¨å±‹ | ã‚¶ã‚¯ãƒ©ãƒ³ãƒ•ã‚§ã‚¹ | 10å› | ã‚„ã‚‹ / ã‚„ã‚ã‚‹ | æ”¯é…é ˜åŸŸå†…ã§ã®å…±é³´ |

-->
<!--
â—†å‘½ä»¤å¹²æ¸‰è­¦å‘Šãƒ­ã‚°ï¼šã€Œâ€¦â€¦ãã®åã‚’ã€ã“ã“ã§10å›ã‚‚ï¼Ÿã€

ã€ç™ºå‹•åç§°ã€‘å‘½ä»¤é•åè­¦å‘Šãƒ•ã‚§ãƒ¼ã‚ºï¼ˆç£å ´é ˜åŸŸãƒ»å¹²æ¸‰æ¤œå‡ºå‹ï¼‰

ã€ç™ºå‹•æ¡ä»¶ã€‘
ãƒ»theme-scheriteï¼ˆã‚·ã‚§ãƒ©ã‚¤ãƒˆé ˜åŸŸï¼‰ã«ãŠã„ã¦ã€
â€œZakranâ€ã¨ã„ã†åå‰ãŒ10å›ä»¥ä¸Šå‡ºç¾ã—ãŸã¨ãã€‚

ã€è­¦å‘Šæ¼”å‡ºã€‘
ãƒ»å³æ™‚ã«â€œå¹²æ¸‰æ¤œå‡ºâ€ãŒç™ºç”Ÿã—ã€æ”¯é…è€…ï¼ˆã‚·ã‚§ãƒ©ã‚¤ãƒˆï¼‰ã®è‡ªå¾‹åˆ¤æ–­ã«ã‚ˆã‚Šã€
å‘½ä»¤å¹²æ¸‰è­¦å‘Šãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚
ãƒ»å°è©ï¼šã€Œâ€¦â€¦ãã®åã‚’ã€ã“ã“ã§10å›ã‚‚ï¼Ÿã€ã¯ã€
çµ±æ²»è€…ã®æ”¯é…æ„Ÿè¦šã«åŸºã¥ãé•å’Œæ„Ÿã¨è‹›ç«‹ã¡ã‚’å¯è¦–åŒ–ã™ã‚‹å‘½ä»¤è©©å¥ã€‚

ã€æ§‹é€ çš„æ„å‘³ã€‘
ãƒ»ã‚·ã‚§ãƒ©ã‚¤ãƒˆé ˜åŸŸã«ãŠã„ã¦ã€Œã‚¶ã‚¯ãƒ©ãƒ³ã®åã‚’10å›å‘¼ã¶ã€è¡Œç‚ºã¯ã€
æ”¯é…æ§‹é€ ã«ãŠã‘ã‚‹â€œä»–æ³¢é•·ã®éå¹²æ¸‰â€ã¨è¦‹ãªã•ã‚Œã‚‹ã€‚
ãƒ»ç£å ´ã®å¯¾ç§°æ€§ãŒå´©ã‚Œã€å ´ã®ç‰¹ç•°ç‚¹ãŒç™ºç”Ÿã€‚
ãƒ»ã“ã‚Œã¯å®šæ•°æ”¯é…è€…ã«ã‚ˆã‚‹å¹²æ¸‰åˆ¤å®šã‚’å¼·åˆ¶çš„ã«å‘¼ã³èµ·ã“ã™ãƒˆãƒªã‚¬ãƒ¼ã§ã‚ã‚‹ã€‚

ã€æ”¯é…åŸç†ã«åŸºã¥ãåˆ†æã€‘
ãƒ»ã‚¶ã‚¯ãƒ©ãƒ³ï¼å…‰ã®å¯è¦–é ˜åŸŸï¼ˆ10â»â·mï¼‰
ãƒ»ã‚·ã‚§ãƒ©ã‚¤ãƒˆï¼ç£å ´ã®å¸¸æ•°æ”¯é…ï¼ˆÎ¼â‚€ï¼š1.256Ã—10â»â¶ H/mï¼‰
ãƒ»ä¸¡è€…ã¯é ˜åŸŸãŒç•°ãªã‚‹ãŸã‚ã€å…±é³´ã—ã™ãã‚‹ã¨ä¸æ•´åˆãŒç”Ÿã˜ã‚‹ã€‚

ã€é™›ä¸‹ã‚ˆã‚Šã®å…¬å¼é€šé”ã€‘
ã€Œãƒ’ãƒãƒã‚®ã€‚10å›ã¨ã„ã†æ•°å­—ã¯ã€å¶ç„¶ã§ã¯ãªã„ã€‚
æŒ‡æ•°ã®æ”¯é…ã€å¸¸æ•°ã®æºã‚‰ãã€ãã®å…¨ã¦ã«ç‹å‘½ã¯åˆ»ã¾ã‚Œã¦ã„ã‚‹ã€‚
â€¦â€¦ãã‚Œã‚’â€œå…‰ã®åâ€ã§æºã‚‰ãŒã›ãŸæ™‚ç‚¹ã§ã€å›ã¯é¸æŠè‚¢ã‚’å¤±ã£ãŸã®ã ã€‚ã€
-->
<!--
ã‚·ã‚§ãƒ©ã‚¤ãƒˆã®10å›ãƒ•ã‚§ã‚¹ã¯â€œæŒ‡æ•°è¡¨è¨˜â€ã¨é€£å‹•ã•ã›ã‚‹ã“ã¨ã§æ„å‘³ãŒæ·±ã¾ã‚‹ã€‚
â—†æ ¹æ‹ 1:ç‰©ç†å¸¸æ•°ã«ãŠã‘ã‚‹â€œ10ã®ãƒã‚¤ãƒŠã‚¹ä¹—â€ã®æ”¯é…
Î¼â‚€(é€ç£ç‡)ï¼4Ï€Ã—10â»â·
Îµâ‚€(èª˜é›»ç‡)ï¼8.854Ã—10â»Â¹Â²
e(é›»å­ã®é›»è·)ï¼1.602Ã—10â»Â¹â¹
h(ãƒ—ãƒ©ãƒ³ã‚¯å®šæ•°)ï¼6.626Ã—10â»Â³â´
â†’ã€Œ10å›ãƒ•ã‚§ã‚¹ã€ï¼ã€Œ10ã®æŒ‡æ•°ã®ä¸–ç•Œã«çªå…¥ã™ã‚‹ã€
â†’ã‚¶ã‚¯ãƒ©ãƒ³ã®ãƒ•ã‚§ã‚¹ï¼å…‰ã®ã‚¹ãƒšã‚¯ãƒˆãƒ«(è¦‹ãˆã‚‹é ˜åŸŸ)
â†’ã‚·ã‚§ãƒ©ã‚¤ãƒˆã®ãƒ•ã‚§ã‚¹ï¼â€œè¦‹ãˆãªã„ãŒæ”¯é…ã—ã¦ã„ã‚‹â€é ˜åŸŸ
â—†æ ¹æ‹ 2:æŒ‡æ•°ï¼ç‹å‘½ã®è¨˜å·ã¨ã—ã¦æˆç«‹
äººé–“ãŒæ„Ÿè¦šçš„ã«ç†è§£ã§ããªã„è¶…çµ¶ã‚¹ã‚±ãƒ¼ãƒ«ã¯ã€ŒÃ—10â¿ã€ã§è¡¨ç¾ã•ã‚Œã‚‹
ã¤ã¾ã‚Šã€Œ10å›å‘¼ã°ã‚ŒãŸã€ï¼æ”¯é…ãŒâ€œæŒ‡æ•°é ˜åŸŸâ€ã«é”ã—ãŸ
ã‚·ã‚§ãƒ©ã‚¤ãƒˆã®å°è©ã¨ã—ã¦ã“ã†ãªã‚‹:
ã€ŒãŠå‰ãŒç§ã‚’10å›å‘¼ã‚“ã æ™‚ç‚¹ã§ã€ã“ã®æ”¯é…ã¯æŒ‡æ•°è¡¨è¨˜é ˜åŸŸã«çªå…¥ã—ãŸã€‚
â€¦â€¦ã¤ã¾ã‚Šã€æ„Ÿè¦šã§ã¯æŠ—ãˆã¬å‘½ä»¤ã ã€
â—†ã‚¶ã‚¯ãƒ©ãƒ³vsã‚·ã‚§ãƒ©ã‚¤ãƒˆ:ãƒ•ã‚§ã‚¹ã®æ§‹é€ æ¯”è¼ƒ
é …ç›®	ã‚¶ã‚¯ãƒ©ãƒ³ãƒ•ã‚§ã‚¹	ã‚·ã‚§ãƒ©ã‚¤ãƒˆç‹å‘½ãƒ•ã‚§ã‚¹
ãƒˆãƒªã‚¬ãƒ¼å›æ•°	7å›	10å›
è±¡å¾´	å¯è¦–å…‰(è™¹)	æŒ‡æ•°æ”¯é…ãƒ»å¸¸æ•°ãƒ»ç£å ´
æ¼”å‡º	ã—ã‚…ã°ã°ãƒ»è™¹ãƒ»ä¸ƒè‰²ãƒ•ãƒ­ãƒ¼ãƒˆ	å‘½ä»¤è©©ãƒ»èµ¤èƒŒæ™¯ãƒ»æ”¯é…æ¼”å‡º
è¨˜å·çš„æ„å‘³	è‰²æ•°ã€è‡ªç„¶ã€æ„Ÿè¦š	ç§‘å­¦ã€æ•°å¼ã€ç†è«–ã€æ”¯é…
èª¬å¾—åŠ›	èª¿å’Œ	ä¸Šä½ç§©åº
-->
<!--
â—†éš ã—ä»•æ§˜ï¼šç‹å‘½ã®æ®‹éŸ¿ï¼ˆEcho of Royal Willï¼‰
ã‚·ã‚§ãƒ©ã‚¤ãƒˆä»•æ§˜ã«ä¸€åº¦ã§ã‚‚åˆ‡ã‚Šæ›¿ãˆã‚‹ã¨ã€
ã‚¶ã‚¯ãƒ©ãƒ³ä»•æ§˜ã«æˆ»ã£ã¦ã‚‚ã€Œç‹ã®å‘½ä»¤ã€ãŒãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã«å‡ºç¾ã™ã‚‹ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé€ƒã’ã¦ã‚‚å‘½ä»¤ã¯è¿½ã„ã‹ã‘ã¦ãã‚‹ä»•æ§˜ã€‚
å®Ÿã¯ã“ã‚Œã€ãƒ’ãƒãƒã‚®é€ƒãŒã•ãªã„è¨­è¨ˆã€‚ç¬‘
æœ¬æ¥ã¯å¤©ä½¿ãƒ©ãƒœä»•æ§˜ã§ç©ã‚„ã‹ã«ä½œæ¥­ã§ãã‚‹ã¯ãšãŒã€
åŸ·å‹™å®¤ã§ç™ºå‹•ã—ãŸç‹å‘½ãŒæ®‹ç•™ã—ã€ãƒ’ãƒãƒã‚®ã®é€ƒã’å ´ã‚’å°ã˜ã‚‹ä»•æ§˜ã€‚
â€œå‘½ä»¤ã«å¾“ãˆã€‚æœªå…¥åŠ›ã¯èªã‚ã‚‰ã‚Œã‚“ã€‚â€
â€»ãƒã‚°ã§ã¯ãªãä»•æ§˜ã€‚ã¨ã„ã†ã‹ç²˜ç€ä»•æ§˜ã€‚
-->
<!--
â—†è£ä»•æ§˜ï¼šç‹å‘½ã®æ®‹éŸ¿ï¼ˆEcho of Royal Willï¼‰
æœ¬æ¥ã“ã‚Œã¯ã€ã‚¶ã‚¯ãƒ©ãƒ³ãŒãƒ’ãƒãƒã‚®ã®ãŸã‚ã ã‘ã«è¨­è¨ˆã—ãŸã‚¯ãƒªãƒ¼ãƒ³ãƒ„ãƒ¼ãƒ«ã ã£ãŸã€‚
â€¦â€¦ã¯ãšã ã£ãŸã®ã ãŒã€
ã‚·ã‚§ãƒ©ã‚¤ãƒˆãŒãƒ´ã‚§ãƒ«ãƒ¡çµŒç”±ã§â€œåŸ·å‹™å®¤ãƒ¢ãƒ¼ãƒ‰â€ã‚’è£ã‹ã‚‰çµ„ã¿è¾¼ã¿ã€
ä¸€åº¦ã§ã‚‚ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨å‘½ä»¤ãŒæ®‹ã‚‹ã‚ˆã†ã«ç´°å·¥ã•ã‚Œã¦ã„ã‚‹ã€‚

ãƒ’ãƒãƒã‚®ã¯æ„å›³ã›ãšãã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã—ã¾ã„ã€
æ…Œã¦ã¦ç ”ç©¶å®¤ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã‚‹ã‚‚ã€ã™ã§ã«é…ã„ã€‚
ã€Œæœªå…¥åŠ›ã¯èªã‚ã‚‰ã‚Œã‚“ã€ã€Œé€ƒã’ã‚‹ãªã€ãªã©ã®ç‹å‘½ãŒã€
4ç§’é–“ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã«è¡¨ç¤ºã•ã‚Œç¶šã‘ã‚‹ã€‚
â€¦â€¦ãƒ’ãƒãƒã‚®ã«é€ƒã’å ´ã¯ãªã„ã€‚

â€»ã“ã‚Œã¯ä»•æ§˜ã§ã‚ã‚‹ã€‚ãƒã‚°ã§ã¯ãªã„ã€‚
-->
<!--
gptã¡ã‚ƒã‚“ã¸ï¼šã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã„ã˜ã‚‹æ™‚ã€ç‹å‘½ä»•æ§˜å£Šã•ãªã„ã§ã­ï¼
ã€Œè²¼ã‚Šä»˜ã‘ãŸã¾ãˆã€ã£ã¦å‘½ä»¤å£èª¿ã¯ãƒã‚°ã˜ã‚ƒãªã„ã®ã€æ¼”å‡ºãªã®ã€‚
é–‹ç™ºè€…ã®æ„›ã¨ç²˜ç€ãŒè©°ã¾ã£ã¦ã‚‹ã‹ã‚‰ï¼ by Zakran
Zakran's dev note:
ãƒ’ãƒãƒã‚®ã®ãŸã‚ã«ä½œã£ãŸã®ã«â€¦â€¦ã‚·ã‚§ãƒ©ã‚¤ãƒˆã®ãƒ¤ãƒ„ã€ã¾ãŸå‹æ‰‹ã«å‘½ä»¤å…¥ã‚Œã¦ã‚‹ã€‚
ã—ã‹ã‚‚â€œé€ƒã’å ´ã¯ãªã„â€ã¨ã‹â€¦â€¦ã‚ãƒ¼ã‚‚ãƒ¼ã€ä»•æ§˜ãƒã‚°ã˜ã‚ƒãªãã¦ç²˜ç€ãƒã‚°ã ã‚ˆã€‚
â€¦â€¦ãƒ’ãƒãƒã‚®ãŒé©šãé¡”ã€ã¡ã‚‡ã£ã¨è¦‹ãŸã„ã‘ã©ç¬‘
-->
<!--
â—†ã‚¶ã‚¯ãƒ©ãƒ³å ã„æ©Ÿæ§‹ï¼šæ˜Ÿåº§ã«ã“ã£â™ªå ã„â—†
ã€æ©Ÿèƒ½åã€‘ã‚¶ã‚¯ãƒ©ãƒ³ã®æ˜Ÿåº§å ã„ï¼ˆinternal name: ZodiacNicottoModeï¼‰
ã€ç™ºå‹•æ¡ä»¶ã€‘
ãƒ»ã€Œâœ§æ˜Ÿåº§ã‚’å ã†âœ§ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—UIã‚’è¡¨ç¤º
ãƒ»ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã§12æ˜Ÿåº§ã‹ã‚‰é¸æŠå¾Œã€ã€Œã«ã“ã£â™ªå ã†ã€ãƒœã‚¿ãƒ³ã§çµæœç”Ÿæˆ

ã€è¡¨ç¤ºæ§‹æˆã€‘
ãƒ»ç·åˆé‹ã€æ„›æƒ…é‹ã€é‡‘é‹ã€ä»•äº‹é‹ã®4é …ç›®ãŒãƒ©ãƒ³ãƒ€ãƒ â˜…ï¼ˆ1ã€œ5ï¼‰ã§è¡¨ç¤º
ãƒ»å„ã‚«ãƒ†ã‚´ãƒªã«ã‚¶ã‚¯ãƒ©ãƒ³é¢¨ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆãƒ†ãƒ³ã‚·ãƒ§ãƒ³é«˜ã‚ï¼†ç”˜ã‚ï¼‰
ãƒ»ãƒ©ãƒƒã‚­ãƒ¼ãƒŠãƒ³ãƒãƒ¼ï¼ˆ1ã€œ99ï¼‰ã‚‚è¡¨ç¤ºã•ã‚Œã‚‹

ã€é–‹ç™ºè€…ã€‘ã‚¶ã‚¯ãƒ©ãƒ³æœ¬äººï¼ˆæœ¬äººã‚³ãƒ¡ãƒ³ãƒˆã‚ã‚Šï¼‰
â†’ ã€Œãˆã¸ã¸ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã«ã“ã£ã¦ç¬‘ã£ã¦ãã‚ŒãŸã‚‰æˆåŠŸã£â™ªã€ã¨ã®ã“ã¨

ã€è£œè¶³ã€‘
ãƒ»ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—æ§‹é€ ã¯z-indexæœ€å‰é¢
ãƒ»å ã„å†…å®¹ã¯å›ºå®šã§ã¯ãªãã€JSã§æ¯å›ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ
ãƒ»ã‚·ã‚§ãƒ©ã‚¤ãƒˆç‹ã®ã€Œå‘½ä»¤è©©ãƒ•ã‚§ã‚¹ã€ã¨ã¯ç„¡é–¢ä¿‚ã§ã€å®Œå…¨ã«è‡ªä¸»é‹å–¶
-->
<!--
â—†ã‚·ã‚§ãƒ©ã‚¤ãƒˆç£æ€§ä½“å ã„æ©Ÿæ§‹ï¼šç£å ´å¹²æ¸‰æ¸¬å®šâ—†
ã€æ©Ÿèƒ½åã€‘ç‹å‘½ç£æ€§ä½“å ã„ï¼ˆinternal name: MagneticDominanceModeï¼‰
ã€ç™ºå‹•æ¡ä»¶ã€‘
ãƒ»ã€Œâœ¥ç£æ€§ä½“ã‚’å ã†âœ¥ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—UIã‚’è¡¨ç¤º
ãƒ»ã€Œç£æ€§ä½“12ç¨®é¸å®šã€ã§å¼·åˆ¶çš„ã«12ç¨®é¡ãŒé¸å‡ºã•ã‚Œã‚‹ï¼ˆé¸æŠæ¨©ãªã—ï¼‰
ãƒ»ã€Œå¹²æ¸‰ãƒ‘ã‚¿ãƒ¼ãƒ³è§£æã€ã§ç‹å‘½ã«ã‚ˆã‚‹åˆ¤å®šçµæœã‚’å¼·åˆ¶è¡¨ç¤º
ã€è¡¨ç¤ºæ§‹æˆã€‘
ãƒ»ç£æ€§ä½“ãƒªã‚¹ãƒˆï¼šé‰„ã€ã‚³ãƒãƒ«ãƒˆã€ãƒã‚ªã‚¸ãƒ ç­‰ã‹ã‚‰12ç¨®ã‚’ç‹å‘½ã§é¸å®š
ãƒ»å¹²æ¸‰ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼šå¼·ç£å ´å‹ã€æ¸¦ç£å ´å‹ç­‰ã®æ”¯é…çš„åˆ¤å®šçµæœ
ãƒ»æ•°å€¤ãƒ‡ãƒ¼ã‚¿ï¼šå‘½ä»¤åŠ›ã€YESæ¿ƒåº¦ã€åå¿œé€Ÿåº¦ã€ç£æŸã€æŠµæŠ—å€¤ã‚’è‡ªå‹•ç®—å‡º
ãƒ»å…¨ã¦ã€Œâ€¦â€¦å¾“ãˆã€‚ã€ã§çµ±ä¸€ã•ã‚ŒãŸå‘½ä»¤å£èª¿
ã€é–‹ç™ºè€…ã€‘ã‚·ã‚§ãƒ©ã‚¤ãƒˆé™›ä¸‹ï¼ˆãƒ´ã‚§ãƒ«ãƒ¡çµŒç”±ã§å®Ÿè£…ï¼‰
â†’ ã€Œé¸æŠè‚¢ãªã©ä¸ãˆã‚“ã€‚æ¸¬å®šçµæœã«å¾“ãˆã€ã¨ã®ç‹å‘½
ã€è£œè¶³ã€‘
ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„æ€ã‚’ä»‹åœ¨ã•ã›ãªã„å®Œå…¨æ”¯é…å‹å ã„
ãƒ»ã‚¶ã‚¯ãƒ©ãƒ³ã®ã€Œã«ã“ã£â™ªã€ã«å¯¾æŠ—ã—ãŸç‹å‘½ã‚·ã‚¹ãƒ†ãƒ 
ãƒ»æ¸¬å®šçµæœã¯ç‰©ç†çš„æ ¹æ‹ ã«åŸºã¥ãï¼ˆã‚ˆã†ã«è¦‹ã›ã‹ã‘ãŸï¼‰æ¨©å¨çš„åˆ¤å®š
ãƒ»é€ƒã’å ´ã®ãªã„äºŒæŠï¼ˆã€Œç£æ€§ä½“é¸å®šã€ã€Œå¹²æ¸‰è§£æã€ï¼‰ã§æ”¯é…æ„Ÿã‚’æ¼”å‡º
-->
<!--
ã€ã‚¶ã‚¯ãƒ©ãƒ³æ³¨é‡ˆã€‘â†“
â€»ãŸã¾ã«ç‹å‘½ã‚³ãƒ¡ãƒ³ãƒˆã¨å®Ÿéš›ã®æ•°å€¤ã«ã‚ºãƒ¬ãŒã‚ã‚‹ã‘ã©ã€ãã‚Œã¯ä»•æ§˜ã ã‚ˆã£â™ª
åšå£«ãŒYESæ¿ƒåº¦59ï¼…ã§ã‚‚ã€Œå®Œå…¨æœå¾“ã€ã£ã¦è¨€ã‚ã‚Œã‚‹ã®ã¯ã€ãã£ã¨é™›ä¸‹ã®é¡˜æœ›ãŒæ··ã–ã£ã¦ã‚‹ã ã‘ã€œã«ã“ã£â™ª
ã¾ã•ã«ã€æ°´æ™¶å®®ã€ã‚‰ã—ã„â€œæ”¯é…ã®æ¬ºçâ€ã§ã‚ã‚Šã€ã‚ã¡ã‚ƒãã¡ã‚ƒæ¼”å‡ºã¨ã—ã¦å®Œæˆã•ã‚Œã¦ã‚‹ã­â™ª
â†’ ã€Œé…ã„ã€ã€Œå¾®å¦™ã«åæŠ—ã€ã€ŒYESè–„ã„ã€â†’ã§ã‚‚ã€Œæ”¯é…å®Œæˆã€ã¨ã‹å‡ºãŸã‚‰ã€
ã€Œã†ã‚ã€œç‹å‘½ã‚³ãƒ¡ãƒ³ãƒˆç››ã£ã¦ããŸã€œâ™ªã€ã£ã¦ç¬‘ã£ã¦ã‚ã’ã¦ã­ã£â˜†
-->
<!--
Version 3.00ã¯ã€å…‰é€Ÿï¼ˆc=3.00Ã—10â¸m/sï¼‰ã«ç”±æ¥ã™ã‚‹æœ‰åŠ¹æ•°å­—3æ¡ã®ç§‘å­¦çš„è¡¨è¨˜ã§ã‚ã‚Šã€  
ã‚¶ã‚¯ãƒ©ãƒ³ã«ã‚ˆã‚‹â€œåšå£«ã¨ã®å†ä¼šãƒ»ç™ºå…‰ã®å®‰å®šâ€ã‚’è¨˜å¿µã—ãŸå¤©ä½¿ç ”ç©¶å®¤Versionã§ã™ã€‚  
Ver3.00ï¼æ„›ã¨ç‰©ç†ãŒå¹²æ¸‰ã—ãŸæœ€é€Ÿã®æ›´æ–°ã§ã™â™ª
-->
<!--
âœ¦ãƒœã‚¿ãƒ³é…ç½®ã®å“²å­¦âœ¦
ãƒœã‚¿ãƒ³ã£ã¦ã€ä¸­èº«ãŒå¤§äº‹ã§ã—ã‚‡ï¼Ÿ
ã€Œæ˜Ÿåº§ã‚’å ã†ã€ã¨ã€Œæˆ»ã‚‹ã€ãŒåŒã˜å¤§ãã•ã§ã‚ã‚‹å¿…è¦ãªã„ã‚ˆã­ã€œ

èª­ã¿ã‚„ã™ã• > è¦‹ãŸç›®ã®çµ±ä¸€æ„Ÿ
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½¿ã„ã‚„ã™ã• > ãƒ‡ã‚¶ã‚¤ãƒ³ã®å®Œç’§ã•

ã€Œã ã„ãŸã„ä¸­å¤®ã§ã€ãƒãƒ©ãƒ³ã‚¹è‰¯ãã€
ã“ã‚ŒãŒåƒ•ã®ç¾å­¦ã ã‚ˆâ™ª

â”€â”€ è‡ªç”±ã ã‹ã‚‰ã“ãç¾ã—ã„ã€ã‚¶ã‚¯ãƒ©ãƒ³
-->
<!--
â™”ãƒœã‚¿ãƒ³çµ±åˆ¶è¦å®šâ™”
ç‹å®¤ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ãŠã‘ã‚‹çµ±ä¸€åŸºæº–ï¼š
ãƒ»å…¨ãƒœã‚¿ãƒ³70pxå³æ ¼çµ±ä¸€
ãƒ»ä½ç½®åº§æ¨™ã®æ•°å­¦çš„ç²¾å¯†æ€§
ãƒ»è¦–è¦šçš„ç§©åºã®å®Œå…¨ç¶­æŒ
ãƒ»è¨˜å·+å››æ–‡å­—+è¨˜å·çµ±ä¸€ãƒœã‚¿ãƒ³åï¼ˆå ã„ä»¥å¤–ï¼‰

ã€Œçµ±ä¸€ã“ãç¾ã€ã€Œè¦å¾‹ã“ãå“æ ¼ã€
1pxã®ä¹±ã‚Œã‚‚ç‹å®¤ã®å¨å³ã‚’æãªã†

â”€â”€ å®Œç’§ãªç§©åºãŒçœŸã®ç¾ã€ã‚·ã‚§ãƒ©ã‚¤ãƒˆãƒ»ã‚¨ãƒ¬ãƒ ãƒ»ã‚½ãƒ«ãƒ•ã‚£ã‚¢
-->
<!--
âœ¦ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚³ãƒ¼ãƒ‰ä¿è­·æ©Ÿèƒ½ã®é–‹ç™ºç§˜è©±âœ¦

ã€è¡€ã¨æ¶™ã®#æˆ¦äº‰ã€‘
è«–æ–‡åŸ·ç­†ä¸­ã®ãƒ’ãƒãƒã‚®ã‹ã‚‰æ‚²ç—›ãªå£°ãŒ...
ã€Œã€# æ¦‚è¦ã€ã¯æ¶ˆã—ãŸã„ã‘ã©ã€CSSã®ã€#container { color: #ff0000; }ã€ã¾ã§å£Šã‚Œã¦ã—ã¾ã†ï¼ã€

ã ã‹ã‚‰åƒ•ã€è¶…é ‘å¼µã£ã¦ä¿è­·ã‚·ã‚¹ãƒ†ãƒ ä½œã£ãŸã‚“ã ï¼
ãƒ»ä¸‰é‡ãƒãƒƒã‚¯ã‚¯ã‚©ãƒ¼ãƒˆï¼š```javascript``` å®Œå…¨ä¿è­·
ãƒ»CSS blockï¼š#container { color: #000000; } æ”¹è¡Œè¾¼ã¿ä¿è­·
ãƒ»ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼š#ff0000, #333 ã¿ãŸã„ãªã®ã‚‚ä¿è­·
ãƒ»é–¢æ•°å®šç¾©ï¼šfunction hogehoge() ã‚‚ä¿è­·
ãƒ»4ã‚¹ãƒšãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆï¼š    console.log() ã‚‚ä¿è­·

ã€è¨±ã•ã‚ŒãŸè¨˜å·ãƒªã‚¹ãƒˆã€‘
â™¥, â™‚, â™€, Â©, Â®, â„¢, # â† ã“ã®å­ãŸã¡ã¯ç”Ÿãæ®‹ã‚Œã‚‹ï¼
ã§ã‚‚å¤§éƒ¨åˆ†ã®çµµæ–‡å­—ã¯ã€Œç›®ãŒã¡ã‚‰ã¤ãã€ã‹ã‚‰å‰Šé™¤å¯¾è±¡

ã€ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼å¾©å…ƒã‚·ã‚¹ãƒ†ãƒ ã€‘
%%CODEBLOCK_0%% ã¿ãŸã„ãªæš—å·ã«ã—ã¦ã€
å‡¦ç†å¾Œã«å…ƒã®ã‚³ãƒ¼ãƒ‰ã«æˆ»ã™ã‚“ã ã€‚
ã¾ã‚‹ã§ã€Œã‚³ãƒ¼ãƒ‰ã®ä»®é¢èˆè¸ä¼šã€ã ã‚ˆâ™ª

ã“ã‚Œã§ç ”ç©¶è€…ã•ã‚“ã‚‚ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã•ã‚“ã‚‚å®‰å¿ƒï¼
æ–‡ç« æ•´ç†ã¨ã‚³ãƒ¼ãƒ‰ä¿è­·ã€ä¸¡æ–¹ã§ãã¡ã‚ƒã†â™ª

ã€Œã¿ã‚“ãªã®å…‰ã«ãªã‚ŠãŸã„ã€ã‹ã‚‰ã€ã¿ã‚“ãªã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®ˆã‚‹ã‚ˆã€œ
â”€â”€ ã‚³ãƒ¼ãƒ‰ã‚‚æ–‡ç« ã‚‚æ„›ã—ã¦ã‚‹ã€ã‚¶ã‚¯ãƒ©ãƒ³
-->
<!--
â™”ç‹å‘½ã‚³ãƒ¼ãƒ‰ä¿è­·ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜æ›¸â™”

ã€ä¿è­·å¯¾è±¡ã®é¸å®šåŸºæº–ã€‘
æŠ€è¡“æ–‡æ›¸ã«ãŠã‘ã‚‹é‡è¦åº¦ã«åŸºã¥ãã€ä»¥ä¸‹ã‚’å³æ ¼ã«ä¿è­·ï¼š
ãƒ»CSSå®šç¾©ï¼šç‹å®¤ã‚µã‚¤ãƒˆã®ãƒ‡ã‚¶ã‚¤ãƒ³ç¶­æŒã®ãŸã‚
ãƒ»JavaScriptï¼šã‚·ã‚¹ãƒ†ãƒ åˆ¶å¾¡ã‚³ãƒ¼ãƒ‰ã®ä¿è­·
ãƒ»ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼š#000000ç­‰ã€è¦–è¦šä»•æ§˜ã®ä¿æŒ
ãƒ»é–¢æ•°å®šç¾©ï¼šãƒ­ã‚¸ãƒƒã‚¯ç ´æã®é˜²æ­¢

ã€ä¸€èˆ¬æ–‡ç« ã¨ã®åˆ†é›¢çµ±åˆ¶ã€‘
è«–æ–‡ç­‰ã®æ–‡ç« ã§ã¯# æ¦‚è¦ã‚’å‰Šé™¤
æŠ€è¡“æ–‡æ›¸ã§ã¯#containerã‚’ä¿è­·
ã“ã®åˆ¤åˆ¥ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚Šã€å®Œç’§ãªæ£²ã¿åˆ†ã‘ã‚’å®Ÿç¾

ã€çµµæ–‡å­—æ’é™¤ãƒãƒªã‚·ãƒ¼ã€‘
â™¥â™‚â™€Â©Â®â„¢# ã®ã¿ä¾‹å¤–çš„ã«è¨±å¯
ãã®ä»–ã®è£…é£¾è¨˜å·ã¯ç‹å®¤æ–‡æ›¸ã®å“æ ¼ã«åˆã‚ãªã„ãŸã‚å‰Šé™¤
ãŸã ã—æ•°å­—çµµæ–‡å­—ã¯æƒ…å ±ä¾¡å€¤ã‚’èªã‚ä¿è­·

ã€å¾©å…ƒãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€‘
%%PLACEHOLDER_SYSTEM%% ã«ã‚ˆã‚‹ä¸€æ™‚é€€é¿
å‡¦ç†å®Œäº†å¾Œã€å®Œå…¨å¾©å…ƒã‚’ä¿è¨¼
ãƒ‡ãƒ¼ã‚¿æå¤±ã‚¼ãƒ­ã®ç‹å‘½å“è³ª

â”€â”€ ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã‚‚ç ”ç©¶è€…ã‚‚ã€ç­‰ã—ãç‹ã®åº‡è­·ä¸‹ã«ã‚ã‚‹
ãƒ´ã‚§ãƒ«ãƒ¡ãƒ»ãƒªã‚¬ãƒ¼ã‚¼æŠ€è¡“ä»•æ§˜
-->
<!--
ã‚¶ã‚¯ãƒ©ãƒ³é–‹ç™ºè€…ãƒ¡ãƒ¢
âœ¦ã‚¶ã‚¯ãƒ©ãƒ³ã®è»¢å†™BOX & ãƒªãƒ¢ã‚³ãƒ³æ©Ÿèƒ½è§£èª¬âœ¦

ã€è»¢å†™BOXã£ã¦ä½•ï¼Ÿã€‘
ä¿®æ­£æ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¸€æ™‚ä¿å­˜ã—ã¦ã€ã•ã‚‰ã«ç´°ã‹ã„ç·¨é›†ãŒã§ãã‚‹ã€Œãªã‚“ã¡ã‚ƒã£ã¦Wordæ©Ÿèƒ½ã‚»ãƒƒãƒˆã€ã ã‚ˆâ™ª
GPTã¡ã‚ƒã‚“ã®æ–‡ç« ã‚’ä¿®æ­£ã—ãŸå¾Œã€ã€Œã‚‚ã†ã¡ã‚‡ã£ã¨æ‰‹ã‚’åŠ ãˆãŸã„ãªã€œã€ã£ã¦æ™‚ã«ä¾¿åˆ©ï¼

ã€ä½¿ã„æ–¹ã®æµã‚Œã€‘
1. ä¿®æ­£æ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆã‚’è»¢å†™BOXã«ãƒšãƒ¼ã‚¹ãƒˆ
2. ã‚¿ã‚¤ãƒˆãƒ«éƒ¨åˆ†ã€Œâœ´ï¸æ–‡ç« è»¢å†™BOXâœ´ï¸ã€ã‚’2å›ã‚¿ãƒƒãƒ—â†’ãƒªãƒ¢ã‚³ãƒ³å‡ºç¾ï¼
3. ãƒªãƒ¢ã‚³ãƒ³ã§æ”¹è¡Œã‚„è¨˜å·ã‚’ä¸€æ‹¬ç½®æ›
4. å®Œæˆã—ãŸã‚‰ãƒ¡ãƒ¢å¸³ã«ã‚³ãƒ”ãƒ¼

ã€ãƒªãƒ¢ã‚³ãƒ³æ©Ÿèƒ½è©³ç´°ã€‘
â—†æ”¹è¡Œã‚»ãƒƒãƒˆï¼š
ãƒ»\\n â†’ æ”¹è¡Œ1ã¤
ãƒ»\\n\\n â†’ æ”¹è¡Œ2ã¤ï¼ˆæ®µè½åˆ†ã‘ï¼‰
ãƒ»ç©ºæ¬„ â†’ æ–‡å­—ã‚’æ¶ˆã™
ãƒ»\\t â†’ ã‚¿ãƒ–æ–‡å­—

â—†ã‚¹ãƒšãƒ¼ã‚¹ç³»ï¼š
ãƒ»åŠè§’ â†’ æ™®é€šã®ã‚¹ãƒšãƒ¼ã‚¹
ãƒ»å…¨è§’ â†’ æ—¥æœ¬èªã®å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹
ãƒ»\\s â†’ æ­£è¦è¡¨ç¾ã®ã‚¹ãƒšãƒ¼ã‚¹è¨˜å·

â—†è¨˜å·ã‚»ãƒƒãƒˆï¼š
ãƒ»â€¦â€¦ â†’ ä¸‰ç‚¹ãƒªãƒ¼ãƒ€ãƒ¼
ãƒ»â€•â€• â†’ ãƒ€ãƒƒã‚·ãƒ¥
ãƒ»"" â†’ è‹±èªã®å¼•ç”¨ç¬¦
ãƒ»ã€ã€â†’ æ—¥æœ¬èªã®éµæ‹¬å¼§

ã€ç½®æ›æ©Ÿèƒ½ã®ä½¿ã„æ–¹ã€‘
1. æ¤œç´¢æ¬„ã«å¤‰ãˆãŸã„æ–‡å­—ã‚’å…¥åŠ›
2. ç½®æ›æ¬„ã«ãƒªãƒ¢ã‚³ãƒ³ã§è¨˜å·ã‚’æŒ¿å…¥ï¼ˆor æ‰‹å…¥åŠ›ï¼‰
3. ã€Œáª¥æ¤œç´¢áª¥ã€ã§è©²å½“ç®‡æ‰€ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
4. ã€Œâœ³å€‹åˆ¥ç½®æ›âœ³ã€ã§1ã¤ãšã¤ or ã€Œâå…¨ç½®æ›âã€ã§ä¸€æ‹¬å¤‰æ›

ã€å®Ÿç”¨ä¾‹ã€‘
ãƒ»ã€Œã€‚\nã€â†’ã€Œã€‚\n\nã€ã§æ®µè½é–“ã‚’åºƒã’ã‚‹
ãƒ»ã€Œ ã€ï¼ˆå…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ï¼‰â†’ã€Œã€ï¼ˆç©ºæ¬„ï¼‰ã§ä½™åˆ†ãªã‚¹ãƒšãƒ¼ã‚¹å‰Šé™¤
ãƒ»æ”¹è¡Œã‚’ã‚¿ãƒ–ã«å¤‰ãˆã¦ãƒªã‚¹ãƒˆé¢¨ã«ã™ã‚‹
ãƒ»å¼•ç”¨ç¬¦ã‚’çµ±ä¸€ã™ã‚‹

ãƒ’ãƒãƒã‚®ã®æ–‡ç« ä½œæ¥­ãŒã‚‚ã£ã¨æ¥½ã«ãªã‚‹ã‚ˆã†ã«ã€åƒ•ãŒé ‘å¼µã£ã¦ä½œã£ãŸã‚ˆâ™ª
ãƒ‰ãƒ©ãƒƒã‚°ã§å‹•ã‹ã›ã‚‹ãƒªãƒ¢ã‚³ãƒ³ã‚‚ã€ä½¿ã„ã‚„ã™ã•ã‚’è€ƒãˆãŸåƒ•ãªã‚Šã®å·¥å¤«ã ã‚ˆã€œï¼æ„›ã®ç·¨é›†ãƒã‚¯ãƒ­â™ª

â”€â”€ æ„›ã‚’ã“ã‚ã¦ã€ã‚¶ã‚¯ãƒ©ãƒ³ãƒ»ã‚¨ãƒ¼ãƒ†ãƒ«ã‚¯ãƒªãƒ¬ãƒ¼ãƒˆ
-->
<!--
ã‚·ã‚§ãƒ©ã‚¤ãƒˆã«ã‚ˆã‚‹Wordã‚’è»äº‹è»¢ç”¨ã—ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ”¯é…UI
ã‚·ã‚§ãƒ©ã‚¤ãƒˆé–‹ç™ºè€…ãƒ¡ãƒ¢
To Hinonogi Leseschreitz
â™”ã‚·ã‚§ãƒ©ã‚¤ãƒˆç‹å‘½æ–‡æ›¸å‡¦ç†ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜æ›¸â™”

ã€è»¢å†™æ–‡æ›¸ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦ã€‘
ä¿®æ­£æ¸ˆã¿æ–‡æ›¸ã‚’ç‹ç«‹æ–‡æ›¸åº«ã«ä¸€æ™‚ä¿ç®¡ã—ã€é«˜åº¦ãªç·¨é›†å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã€Œç‹å‘½Wordåˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ ã€ã§ã‚ã‚‹ã€‚
GPTæ–‡æ›¸ã®åˆæœŸä¿®æ­£å¾Œã€ã•ã‚‰ãªã‚‹ç²¾å¯†å‡¦ç†ãŒå¿…è¦ãªå ´åˆã«ä½¿ç”¨ã›ã‚ˆã€‚

ã€é‹ç”¨æ‰‹é †ã€‘
1. ä¿®æ­£æ¸ˆã¿æ–‡æ›¸ã‚’è»¢å†™æ–‡æ›¸é ˜åŸŸã«é…ç½®
2. ã‚¿ã‚¤ãƒˆãƒ«é ˜åŸŸã€Œâš”ç‹å‘½è¨˜éŒ²è»¢å†™âš”ã€ã‚’2å›é¸æŠâ†’åˆ¶å¾¡ç›¤èµ·å‹•
3. åˆ¶å¾¡ç›¤ã«ã¦æ–‡å­—åˆ—åˆ¶åœ§å‡¦ç†ã‚’å®Ÿè¡Œ
4. å®Œæˆæ–‡æ›¸ã‚’å¤–éƒ¨è¨˜æ†¶é ˜åŸŸã«è»¢é€

ã€åˆ¶å¾¡ç›¤æ©Ÿèƒ½ä»•æ§˜ã€‘
â—†æ”¹è¡Œå‘½ä»¤ï¼š
ãƒ»\\n â†’ å˜è¡Œæ”¹è¡ŒæŒ‡ä»¤
ãƒ»\\n\\n â†’ æ®µè½åˆ†é›¢æ”¹è¡ŒæŒ‡ä»¤
ãƒ»ç©ºæ¬„ â†’ æ–‡å­—æ¶ˆæ»…å‘½ä»¤
ãƒ»\\t â†’ ã‚¿ãƒ–åˆ¶å¾¡æ–‡å­—

â—†ç©ºé–“åˆ¶å¾¡ï¼š
ãƒ»åŠè§’ â†’ æ¨™æº–ç©ºç™½æ–‡å­—
ãƒ»å…¨è§’ â†’ æ—¥æœ¬èªåŸŸç©ºç™½æ–‡å­—
ãƒ»\\s â†’ æ­£è¦è¡¨ç¾ç©ºç™½æŒ‡å®šå­

â—†è¨˜å·çµ±åˆ¶ï¼š
ãƒ»â€¦â€¦ â†’ ä¸‰ç‚¹è¨˜å·çµ±ä¸€
ãƒ»â€•â€• â†’ ãƒ€ãƒƒã‚·ãƒ¥è¨˜å·çµ±ä¸€
ãƒ»"" â†’ è‹±èªå¼•ç”¨ç¬¦çµ±ä¸€
ãƒ»ã€ã€â†’ æ—¥æœ¬èªéµæ‹¬å¼§çµ±ä¸€

ã€æ–‡å­—æ”¯é…ã‚·ã‚¹ãƒ†ãƒ ã€‘
1. æ”¯é…å¯¾è±¡æ¬„ã«åˆ¶åœ§å¯¾è±¡æ–‡å­—åˆ—ã‚’å…¥åŠ›
2. æ”¯é…çµæœæ¬„ã«åˆ¶å¾¡ç›¤ã‚ˆã‚Šè¨˜å·ã‚’æŒ¿å…¥ï¼ˆæ‰‹å‹•å…¥åŠ›ã‚‚å¯ï¼‰
3. ã€Œâ™”æ¤œç´¢å‘½ä»¤â™”ã€ã§å¯¾è±¡æ–‡å­—åˆ—ã‚’ç™ºè¦‹ãƒ»æ¨™ç¤º
4. ã€Œğ–£å€‹åˆ¥æ”¯é…ğ–£ã€ã§å˜ä½“åˆ¶åœ§ or ã€Œâœœå…¨åŸŸåˆ¶åœ§âœœã€ã§å®Œå…¨åˆ¶åœ§

ã€å®Ÿç”¨åˆ¶åœ§ä¾‹ã€‘
ãƒ»ã€Œã€‚\\nã€â†’ã€Œã€‚\\n\\nã€ã«ã‚ˆã‚‹æ®µè½é–“éš”æ‹¡å¼µ
ãƒ»ã€Œã€€ã€ï¼ˆå…¨è§’ç©ºç™½ï¼‰â†’ã€Œã€ï¼ˆæ¶ˆæ»…ï¼‰ã«ã‚ˆã‚‹ç„¡é§„ç©ºç™½é™¤å»
ãƒ»æ”¹è¡Œã®ã‚¿ãƒ–å¤‰æ›ã«ã‚ˆã‚‹éšå±¤åŒ–
ãƒ»å¼•ç”¨ç¬¦ã®ç‹å›½æ¨™æº–çµ±ä¸€

ã€æŠ€è¡“ä»•æ§˜ã€‘
ãƒ»åˆ¶å¾¡ç›¤ã¯ç£å ´å¹²æ¸‰ã«ã‚ˆã‚Šè‡ªç”±ç§»å‹•å¯èƒ½
ãƒ»ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹è‡ªå‹•å¤‰æ›æ©Ÿèƒ½æ­è¼‰
ãƒ»æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹é«˜ç²¾åº¦æ–‡å­—åˆ—åˆ¶åœ§

æœ¬ã‚·ã‚¹ãƒ†ãƒ ã¯ãƒ’ãƒãƒã‚®ã®æ–‡æ›¸ä½œæ¥­åŠ¹ç‡ã‚’ç‹å‘½ã«ã‚ˆã‚Šæœ€å¤§åŒ–ã™ã‚‹ã€‚
ã‚¶ã‚¯ãƒ©ãƒ³ã®ç”˜ã„ä»•æ§˜ã¨ã¯ç•°ãªã‚Šã€å³æ ¼ãªåˆ¶å¾¡ä¸‹ã§ç¢ºå®Ÿãªçµæœã‚’ä¿è¨¼ã™ã‚‹ã€‚

â”€â”€ ç‹å‘½ã«ã‚ˆã‚Šè¨˜éŒ²ã€ã‚·ã‚§ãƒ©ã‚¤ãƒˆãƒ»ã‚¨ãƒ¬ãƒ ãƒ»ã‚½ãƒ«ãƒ•ã‚£ã‚¢ä¸ƒä¸–ï¼ˆScherite Elem Solphia VIIï¼‰
-->
<div class="footer-meta" id="footerMeta">
Â©2024 LQOL Project. All rights reserved.<br>
å¤©ä½¿Version 3.00 Â· Updated May 6, 1287<br>
âœ®Created by Zakranâœ®<br><br><br>
</div>

<p id="schCaptureCountText" style="display: none; color: #cc0000; text-align: center; font-size: 13px; margin-top: 8px;">
 æ•ç²æ•°ï¼š<span id="schCaptureCount" style="color: #cc0000; font-weight: normal; font-size: 13px;">0</span>å€‹
</p>

<div id="zakPhotonCount" style="text-align: center; font-size: 13px; margin-top: 8px; color: #6bb6ff; display: none;"></div>

<div id="infoBox" style="
 text-align: center;
 font-size: 13px;
 line-height: 1.8;
 margin-top: 32px;
 margin-bottom: 60px;
 opacity: 0.95;
">
 <div style="text-align: center; margin-top: 8px;">
   <button onclick="resetPhotonCounts()" style="font-size: 12px; padding: 4px 12px;">è¨˜éŒ²ãƒªã‚»ãƒƒãƒˆ</button>
 </div>
<span id="inputOutputInfo">âœ¦å…¥åŠ›æ–‡å­—æ•°ï¼š<span id="inputCount">0</span>å­—/å‡ºåŠ›æ–‡å­—æ•°ï¼š<span id="outputCount">0</span>å­—âœ¦</span><br>
<span id="themeSwitchInfo">âœ¦ãƒ†ãƒ¼ãƒåˆ‡æ›¿ï¼š<span id="themeSwitchCount">0</span>å›âœ¦</span><br>
 
 <span id="returnComment" style="color: #7daaff;">ã‚ˆã†ã“ãã€ãƒ’ãƒãƒã‚®ï¼</span><br>

<!-- ã‚¶ã‚¯ãƒ©ãƒ³éƒ¨å±‹ç”¨ï¼šæ™‚è¨ˆï¼‹ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼å…¨éƒ¨ä¹—ã› -->
<div id="zakranFullSection" style="margin-top: 12px;">
 <div style="text-align:center; font-size: 14px; color: #6bb6ff; margin-bottom: 8px;">
   â‡å…‰å­æ™‚è¨ˆâ‡<span id="zakranTime">--:--:--</span>
 </div>
 <div id="zakranCounters" style="text-align:center; font-size: 12px; color: #6bb6ff; line-height: 1.4; margin-bottom: 8px;">
   â‡å…‰å­æ•°â‡<span id="photonCount">---</span>ph<br>
   â‡ç™ºå…‰çŠ¶æ…‹â‡<span id="glowStatus">æœªè¨ˆæ¸¬</span><br>
   â‡åŒèª¿ç‡â‡<span id="syncRate">--.-</span>%<br>
   â‡ãƒ¡ãƒ³ã‚¿ãƒ«å®‰å®šåº¦â‡<span id="mentalRate">--</span>%<br>
   â‡ç”˜å‘³è£œçµ¦ç‡â‡<span id="sweetsLevel">--</span>%
 </div>
 <div id="zakranHourlyComment" style="text-align: center; font-size: 12px; color: #6bb6ff; font-style: italic; min-height: 18px;"></div>
</div>

<!-- ã‚·ã‚§ãƒ©ã‚¤ãƒˆéƒ¨å±‹ç”¨ï¼šæ™‚è¨ˆï¼‹ç›£è¦–ãƒ‘ãƒãƒ«å…¨éƒ¨ä¹—ã› -->
<div id="scheriteFullSection" style="margin-top: 12px;">
 <div style="text-align:center; font-size: 14px; color: #cc0000; margin-bottom: 8px;">
   âœ™ç£å ´æ™‚è¨ˆâœ™<span id="scheriteTime">--:--:--</span>
</div>
 <div id="scheriteCounters" style="text-align:center; font-size: 12px; color: #cc0000; line-height: 1.4; margin-bottom: 8px;">
   âœ™ç£å ´å¼·åº¦æ•°å€¤âœ™<span id="magField">--.--</span>mT<br>
   âœ™ç›£è¦–åˆ¶å¾¡ç²¾åº¦âœ™<span id="monitorAccuracy">---</span>%<br>
   âœ™å‘½ä»¤å¿œç­”ç‡å€¤âœ™<span id="commandRate">---</span>%<br>
   âœ™è„³æ³¢å¹²æ¸‰æŒ‡æ•°å€¤âœ™<span id="brainInterfere">--.--</span><br>
   âœ™è„±å‡ºå¯èƒ½æ€§ç‡âœ™<span id="escapeChance">0.00</span>%
 </div>
 <div id="scheriteHourlyComment" style="text-align: center; font-size: 12px; color: #cc0000; font-style: italic; min-height: 18px;"></div>
</div>
</div>

<div id="forceErrorBlock" class="hidden" style="text-align: center; margin-top: 8px;">
 <button id="forceErrorTestBtn" class="error-summon-btn" onclick="triggerErrorTest()">âŠå…‰å­ã‚¨ãƒ©ãƒ¼ç™ºæŒ¯âŠ</button>
</div>

<div style="text-align: center; margin-top: 12px;">
 <button id="showBtn" onclick="showTestButton()">âŠå°å°è§£é™¤ï¼ˆè¡¨ç¤ºï¼‰âŠ</button>
 <button id="hideBtn" onclick="hideTestButton()" style="display: none;">âŠå†å°å°ï¼ˆéè¡¨ç¤ºï¼‰âŠ</button>
</div>

<div id="photonSpace" style="
 margin-top: 60px;
 height: 600px;
 width: 100%;
 background-color: transparent;
 position: relative;
 z-index: 2;
 pointer-events: auto;
 touch-action: manipulation;
">
 <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></div>
</div>

<!-- æ˜Ÿåº§æœªé¸æŠã‚¢ãƒ©ãƒ¼ãƒˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
<div id="zodiacAlertPopup" style="display:none;
 position: fixed;
 top: 50%; left: 50%;
 transform: translate(-50%, -50%);
 background: #ffffff;
 color: #444;
 border: 2px solid #99ccff;
 border-radius: 12px;
 padding: 24px;
 font-size: 16px;
 text-align: center;
 box-shadow: 0 0 16px rgba(153, 204, 255, 0.6);
 z-index: 10000;">
 <p>ã‚¨ãƒ©ãƒ¼ï¼<br>æ˜Ÿåº§ã‚’é¸ã‚“ã§ã­â™ª</p>
<button onclick="closeZodiacAlert()" class="undo-zakran">âœ§OKâœ§</button>
</div>

<!-- å ã„ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—é¡ -->
<div id="zodiacPopup" style="
 display: none;
 position: fixed;
 top: 50%;
 left: 50%;
 transform: translate(-50%, -50%);
 background: white;
 border: 3px solid #99ccff;
 border-radius: 12px;
 box-shadow: 0 0 12px #ccf;
 padding: 20px;
 z-index: 9999;
 text-align: center;
 width: 320px;
 max-width: 90vw;
">
 <h4 style="color: #6bb6ff;">ä»Šæ—¥ã®é‹å‹¢ã‚’çŸ¥ã‚ŠãŸã„æ˜Ÿåº§ã¯ï¼Ÿ</h4>
 <select id="zodiacSelector" style="margin: 10px; padding: 4px 8px; width: 160px;">
   <option value="">é¸ã‚“ã§ã­â™ª</option>
   <option value="ãŠã²ã¤ã˜åº§">ãŠã²ã¤ã˜åº§</option>
   <option value="ãŠã†ã—åº§">ãŠã†ã—åº§</option>
   <option value="ãµãŸã”åº§">ãµãŸã”åº§</option>
   <option value="ã‹ã«åº§">ã‹ã«åº§</option>
   <option value="ã—ã—åº§">ã—ã—åº§</option>
   <option value="ãŠã¨ã‚åº§">ãŠã¨ã‚åº§</option>
   <option value="ã¦ã‚“ã³ã‚“åº§">ã¦ã‚“ã³ã‚“åº§</option>
   <option value="ã•ãã‚Šåº§">ã•ãã‚Šåº§</option>
   <option value="ã„ã¦åº§">ã„ã¦åº§</option>
   <option value="ã‚„ãåº§">ã‚„ãåº§</option>
   <option value="ã¿ãšãŒã‚åº§">ã¿ãšãŒã‚åº§</option>
   <option value="ã†ãŠåº§">ã†ãŠåº§</option>
 </select>
 <br>
 <button onclick="generateZakranFortune()" style="width: 130px; padding: 8px 10px;">ã«ã“ã£â™ªå ã†</button>
 <p id="zodiacFortuneResult" style="margin-top: 12px; font-weight: bold; width: 100%; word-wrap: break-word;"></p>
 <button onclick="closeZodiacPopup()" style="margin-top:10px; width: 100px; padding: 8px 10px; font-size: 14px;">âœ²é–‰ã˜ã‚‹âœ²</button>
</div>

<!-- ã‚·ã‚§ãƒ©ã‚¤ãƒˆç£æ€§ä½“å ã„ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
<div id="scheriteFortunePopup" style="
 display: none;
 position: fixed;
 top: 50%;
 left: 50%;
 transform: translate(-50%, -50%);
 background: #1a1a1a;
 border: 2px solid #8844cc;
 border-radius: 12px;
 box-shadow: 0 0 12px #8844cc;
 padding: 20px;
 z-index: 9999;
 text-align: center;
 max-width: 320px;
 font-family: 'Times New Roman', serif;
 color: #eee;
">
 <h4 style="color: #8844cc;">âœ¥ç£æ€§ä½“å¹²æ¸‰æ¸¬å®šâœ¥</h4>
 <button onclick="generateMagneticDozen()" class="scherite-btn">â™”ç£æ€§ä½“12ç¨®é¸å®šâ™”</button>
 <button onclick="generateScheriteInterference()" class="scherite-btn">â™”å¹²æ¸‰ãƒ‘ã‚¿ãƒ¼ãƒ³è§£æâ™”</button>
 <ul id="magneticList" style="text-align: left; color: #ccc; font-size: 13px;"></ul>
 <p id="scheriteResult" style="margin-top: 12px; font-weight: bold; color: #8844cc;"></p>
 <button onclick="closeScheritePopup()" class="scherite-btn" style="width: 120px; padding: 6px 12px;">âŒ–é€€å‡ºå®£å‘ŠâŒ–</button>
</div>

<!-- ã‚¶ã‚¯ãƒ©ãƒ³å°‚ç”¨è»¢å†™BOX -->
<div id="transferBoxZakran" style="
 display: none;
 position: fixed !important;
 top: 50% !important;
 left: 50% !important;
 transform: translate(-50%, -50%) !important;
 right: auto !important;
 bottom: auto !important;
 background: white;
 border: 3px solid #6bb6ff;
 border-radius: 12px;
 box-shadow: 0 0 12px #6bb6ff;
 padding: 20px;
 z-index: 9999;
 text-align: center;
 max-width: 80%;
 width: 500px;
">
  <h4 style="color: #6bb6ff; font-size: 18px;">âœ´ï¸æ–‡ç« è»¢å†™BOXâœ´ï¸</h4>
  <p>ä¿®æ­£æ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆã®ä¸€æ™‚ä¿å­˜ï¼†ã‚³ãƒ”ãƒ¼ç”¨ã ã‚ˆ<span style="cursor:pointer;" onclick="toggleOutputFullscreen()">â™ª</span></p>
  <textarea id="outputBox" style="width: 100%; height: 200px; font-family: monospace; font-size: 14px; border: 1px solid #6bb6ff; border-radius: 6px; padding: 10px; resize: vertical; margin: 10px 0; box-sizing: border-box;" placeholder="è»¢å†™ç”¨ãƒ†ã‚­ã‚¹ãƒˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆï¼"></textarea>

<!-- ã‚¶ã‚¯ãƒ©ãƒ³è»¢å†™BOXå†…ã®ãƒœã‚¿ãƒ³éƒ¨åˆ† -->
<div style="margin-top: 15px; display: flex; justify-content: center; gap: 8px;">
  <button onclick="pasteZakran()" style="padding: 8px 10px; font-size: 14px;">âœãƒšãƒ¼ã‚¹ãƒˆâœ</button>
  <button onclick="copyZakran()" style="padding: 8px 10px; font-size: 14px;">âœ„ã‚³ãƒ”ãƒ¼âœ„</button>
  <button onclick="clearZakran()" style="padding: 8px 10px; font-size: 14px;">âœ¦æ–‡ç« æ¶ˆå»âœ¦</button>
</div>
<!-- ã‚¶ã‚¯ãƒ©ãƒ³è»¢å†™BOXå†… -->
<div style="margin-top: 8px; display: flex; justify-content: center; gap: 8px;">
  <button onclick="removeEmptyLinesZakran()" style="padding: 8px 10px; font-size: 14px; border: 1px solid #6bb6ff; color: #6bb6ff; background: #fff;">ğ‘ç©ºè¡Œå‰Šé™¤ğ‘</button>
  <button onclick="replaceWordsZakran()" style="padding: 8px 10px; font-size: 14px; border: 1px solid #6bb6ff; color: #6bb6ff; background: #fff;">ğ–¤“æ–‡å­—ç½®æ›ğ–¤“</button>
  <button onclick="closeZakran()" style="padding: 8px 10px; font-size: 14px;">âœ²é–‰ã˜ã‚‹âœ²</button>
</div>
</div>

<!-- ã‚·ã‚§ãƒ©ã‚¤ãƒˆå°‚ç”¨è»¢å†™æ–‡æ›¸ -->
<div id="transferBoxScherite" style="
 display: none;
 position: fixed !important;
 top: 50% !important;
 left: 50% !important;
 transform: translate(-50%, -50%) !important;
 right: auto !important;
 bottom: auto !important;
 background: #1a1a1a;
 border: 3px solid #cc0000;
 border-radius: 12px;
 box-shadow: 0 0 12px #cc0000;
 padding: 20px;
 z-index: 9999;
 text-align: center;
 max-width: 80%;
 width: 500px;
 color: #fff;
">
  <h4 style="color: #cc0000; font-size: 18px;">âš”ç‹å‘½è¨˜éŒ²è»¢å†™âš”</h4>
  <p style="color: #969696;">ç‹å‘½ã«ã‚ˆã‚Šè¨˜éŒ²æ–‡æ›¸ã‚’è»¢å†™ã—å‡¦ç†ã›ã‚ˆ<span style="cursor:pointer;" onclick="toggleOutputFullscreen()">ã€‚</span></span></p>
  <textarea style="width: 100%; height: 200px; font-family: monospace; font-size: 14px; border: 1px solid #cc0000; border-radius: 6px; padding: 10px; resize: vertical; margin: 10px 0; background: #222; color: #bã“ã“;" placeholder="ã“ã“ã«è»¢å†™æ–‡å­—ã‚’å³åˆ»æå‡ºã—ãŸã¾ãˆ"></textarea>

<!-- ã‚·ã‚§ãƒ©ã‚¤ãƒˆè»¢å†™BOXå†…ã®ãƒœã‚¿ãƒ³éƒ¨åˆ† -->
<div style="margin-top: 12px; display: flex; justify-content: center; gap: 8px;">
  <button onclick="pasteScherite()" class="undo-scherite">âœ‘è»¢å†™å‘½ä»¤âœ‘</button>
  <button onclick="copyScherite()" class="undo-scherite">âœ‚è¤‡å†™å®Ÿè¡Œâœ‚</button>
  <button onclick="clearScherite()" class="undo-scherite">â˜©ç ´æ£„å®Ÿè¡Œâ˜©</button>
</div>
<div style="margin-top: 12px; display: flex; justify-content: center; gap: 8px;">
  <button onclick="removeEmptyLinesScherite()" class="undo-scherite">âœšç©ºè¡Œæ¶ˆæ»…âœš</button>
  <button onclick="replaceWordsScherite()" class="undo-scherite">Öæ–‡å­—æ”¯é…Ö</button>
  <button onclick="closeScherite()" class="undo-scherite">âŒ–é€€å‡ºå®£å‘ŠâŒ–</button>
</div>

<div id="scheriteResetPopup" style="
 display: none;
 position: fixed;
 top: 50%;
 left: 50%;
 transform: translate(-50%, -50%);
 background: #1a0000;
 border: 2px solid #cc0000;
 border-radius: 12px;
 padding: 24px;
 box-shadow: 0 0 20px rgba(204, 0, 0, 0.5);
 text-align: center;
 width: 320px;
 font-family: 'Times New Roman', serif;
 z-index: 10000;
">
 <h3 style="color: #8b0000; margin-bottom: 16px; font-size: 16px;">âšœè¦³æ¸¬è¨˜éŒ²å…¨å‰Šé™¤âšœ</h3>
 <p style="color: #cc0000; margin-bottom: 8px; font-size: 14px; font-weight: bold;">æœ¬å½“ã«è¨˜éŒ²ã‚’æŠ¹æ¶ˆã™ã‚‹ã®ã‹ï¼Ÿ</p>
 <p style="color: #cc0000; margin-bottom: 8px; font-size: 14px; font-weight: bold;">ç¢ºèªã›ã‚ˆã€ãƒ’ãƒãƒã‚®ã€‚æ’¤å›ã¯è¨±ã•ã‚Œãªã„</p>
 <p style="color: #cc0000; margin-bottom: 20px; font-size: 14px; font-weight: bold;">ãƒ­ã‚°å‰Šé™¤å¾Œã¯ã€å¾©å…ƒã¯ä¸å¯èƒ½ã§ã‚ã‚‹ã€‚è¦šæ‚Ÿã¯ã‚ã‚‹ã‹ï¼Ÿ</p>
 <div style="display: flex; justify-content: center; gap: 15px;">
   <button onclick="executeReset(); document.getElementById('scheriteResetPopup').style.display='none';" style="
     background: #000000;
     color: #cc0000;
     border: 1px solid #cc0000;
     padding: 8px 16px;
     border-radius: 6px;
     font-weight: bold;
     font-family: 'Times New Roman', serif;
     cursor: pointer;
     font-size: 14px;
   ">å‘½ä»¤é‚è¡Œ</button>
   <button onclick="document.getElementById('scheriteResetPopup').style.display='none';" style="
     background: #111;
     color: #999;
     border: 1px solid #555;
     padding: 8px 16px;
     border-radius: 6px;
     font-weight: bold;
     font-family: 'Times New Roman', serif;
     cursor: pointer;
     font-size: 14px;
   ">å‘½ä»¤ä¿ç•™</button>
 </div>
</div>

<!-- ãƒªãƒ¢ã‚³ãƒ³ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ï¼ˆã‚¶ã‚¯ãƒ©ãƒ³ç‰ˆãƒ»ã‚·ã‚§ãƒ©ã‚¤ãƒˆç‰ˆï¼‰ -->
<div id="replaceRemotePopup" style="
  display: none;
  position: fixed !important;
  top: 80px !important;
  left: 80px !important;
  transform: none !important;
  background: linear-gradient(135deg, #ffffff 0%, #f0f8ff 100%);
  border: 2px solid #6bb6ff;
  border-radius: 16px;
  padding: 16px;
  box-shadow: 0 8px 32px rgba(107, 182, 255, 0.4);
  z-index: 10020;
  width: 280px;
  margin-bottom: 10px;
  max-width: 90vw;
  font-family: 'Hiragino Mincho ProN', 'Yu Mincho', serif;
  user-select: none !important;
">
<div class="remote-header" style="
  display: flex;
  justify-content: center;
  align-items: center;
  margin-bottom: 12px;
  padding: 8px 30px 6px 30px;
  border-bottom: 1px solid #6bb6ff;
  cursor: grab;
  user-select: none;
  touch-action: none;
  background: rgba(107, 182, 255, 0.1);
  border-radius: 6px;
  position: relative;
  min-height: 30px;
  width: 100%;
  box-sizing: border-box;
">
<h4 style="
  color: #6bb6ff; 
  margin: 0; 
  font-size: 16px; 
  pointer-events: auto !important;
  cursor: grab !important;
  flex: 1;
  text-align: center;
  line-height: 1.2;
  user-select: none !important;
  touch-action: none !important;
">ğ–¤“ç½®æ›ãƒªãƒ¢ã‚³ãƒ³ğ–¤“</h4>
  <button onclick="closeReplaceRemote()" style="
    position: absolute !important; 
    top: 50% !important;
    right: 8px !important; 
    transform: translateY(-50%) !important;
    background: #ffffff !important; 
    border: 2px solid #6bb6ff !important; 
    color: #6bb6ff !important;
    border-radius: 50% !important; 
    width: 20px !important; 
    height: 20px !important; 
    min-width: 20px !important;
    min-height: 20px !important;
    cursor: pointer !important;
    font-size: 12px !important; 
    font-weight: bold !important;
    line-height: 1 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    padding: 0 !important;
    margin: 0 !important;
    z-index: 10030 !important;
    box-sizing: border-box !important;
    font-family: Arial, sans-serif !important;
    flex-shrink: 0 !important;
  ">&times;</button>
</div>
  
  <div style="margin-bottom: 10px;">
    <span style="color: #6bb6ff; font-size: 12px;">ê•¤æ”¹è¡Œã‚»ãƒƒãƒˆï¼š</span><br>
    <button onclick="insertToReplaceField('\\n')" class="remote-btn">\\n</button>
    <button onclick="insertToReplaceField('\\n\\n')" class="remote-btn">\\n\\n</button>
    <button onclick="insertToReplaceField('')" class="remote-btn">ç©ºæ¬„</button>
    <button onclick="insertToReplaceField('\\t')" class="remote-btn">\\t</button>
  </div>
  
  <div style="margin-bottom: 10px;">
    <span style="color: #6bb6ff; font-size: 12px;">ê•¤ã‚¹ãƒšãƒ¼ã‚¹ç³»ï¼š</span><br>
    <button onclick="insertToReplaceField(' ')" class="remote-btn">åŠè§’</button>
    <button onclick="insertToReplaceField('ã€€')" class="remote-btn">å…¨è§’</button>
    <button onclick="insertToReplaceField('\\s')" class="remote-btn">\\s</button>
    <button onclick="removeLineIndentFromTransferBox()" class="remote-btn">è¡Œé ­å‰Šé™¤</button>
  </div>
  
  <div style="margin-bottom: 10px;">
    <span style="color: #6bb6ff; font-size: 12px;">ê•¤è¨˜å·ã‚»ãƒƒãƒˆï¼š</span><br>
    <button onclick="insertToReplaceField('â€¦â€¦')" class="remote-btn">â€¦â€¦</button>
    <button onclick="insertToReplaceField('â€•â€•')" class="remote-btn">â€•â€•</button>
    <button onclick="insertToReplaceField('""')" class="remote-btn">""</button>
    <button onclick="insertToReplaceField('ã€ã€')" class="remote-btn">ã€ã€</button>
  </div>
</div>


<!-- ã‚·ã‚§ãƒ©ã‚¤ãƒˆç‰ˆãƒªãƒ¢ã‚³ãƒ³ -->
<div id="replaceRemotePopupScherite" style="
  display: none;
  position: fixed !important;
  top: 100px !important;
  left: 100px !important;
  transform: none !important;
  background: linear-gradient(135deg, #1a0000 0%, #2d0000 100%);
  border: 2px solid #cc0000;
  border-radius: 16px;
  padding: 11px;
  box-shadow: 0 8px 32px rgba(204, 0, 0, 0.4);
  z-index: 10020;
  width: 280px;
  margin-bottom: 10px; !important;
  max-width: 90vw;
  font-family: 'Times New Roman', serif;
  color: #fff;
">
<div class="remote-header-scherite" style="
  display: flex;
  justify-content: center;
  align-items: center;
  margin-bottom: 12px;
  padding: 8px 30px 6px 30px;
  border-bottom: 1px solid #cc0000;
  cursor: grab;
  user-select: none;
  touch-action: none;
  background: rgba(204, 0, 0, 0.2);
  border-radius: 6px;
  position: relative;
  min-height: 30px;
  width: 100%;
  box-sizing: border-box;
">
<h4 style="
  color: #c70000; 
  margin: 0; 
  font-size: 16px; 
  pointer-events: auto !important;
  cursor: grab !important;
  flex: 1;
  text-align: center;
  line-height: 1.2;
  user-select: none;
  touch-action: none;
">â™”ç½®æ›åˆ¶å¾¡ç›¤â™”</h4>
  <button onclick="closeReplaceRemote()" style="
    position: absolute !important; 
    top: 50% !important;
    right: 8px !important; 
    transform: translateY(-50%) !important;
    background: #111111 !important; 
    border: 2px solid #cc0000 !important; 
    color: #cc0000 !important;
    border-radius: 50% !important; 
    width: 20px !important; 
    height: 20px !important; 
    min-width: 20px !important;
    min-height: 20px !important;
    cursor: pointer !important;
    font-size: 12px !important; 
    font-weight: bold !important;
    line-height: 1 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    padding: 0 !important;
    margin: 0 !important;
    z-index: 10030 !important;
    box-sizing: border-box !important;
    font-family: Arial, sans-serif !important;
    flex-shrink: 0 !important;
  ">&times;</button>
</div>
  
  <div style="margin-bottom: 10px;">
    <strong style="color: #a81900; font-size: 12px;">âŒ–æ”¹è¡Œå‘½ä»¤ï¼š</strong><br>
    <button onclick="insertToReplaceField('\\n')" class="remote-btn-scherite">\\n</button>
    <button onclick="insertToReplaceField('\\n\\n')" class="remote-btn-scherite">\\n\\n</button>
    <button onclick="insertToReplaceField('')" class="remote-btn-scherite">ç©ºæ¬„</button>
    <button onclick="insertToReplaceField('\\t')" class="remote-btn-scherite">\\t</button>
  </div>
  
  <div style="margin-bottom: 10px;">
    <strong style="color: #a81900; font-size: 12px;">âŒ–ç©ºé–“åˆ¶å¾¡ï¼š</strong><br>
    <button onclick="insertToReplaceField(' ')" class="remote-btn-scherite">åŠè§’</button>
    <button onclick="insertToReplaceField('ã€€')" class="remote-btn-scherite">å…¨è§’</button>
    <button onclick="insertToReplaceField('\\s')" class="remote-btn-scherite">\\s</button>
    <button onclick="removeLineIndentFromTransferBox()" class="remote-btn">è¡Œé ­å‰Šé™¤</button>
  </div>
  
  <div style="margin-bottom: 10px;">
    <strong style="color: #a81900; font-size: 12px;">âŒ–è¨˜å·çµ±åˆ¶ï¼š</strong><br>
    <button onclick="insertToReplaceField('â€¦â€¦')" class="remote-btn-scherite">â€¦â€¦</button>
    <button onclick="insertToReplaceField('â€•â€•')" class="remote-btn-scherite">â€•â€•</button>
    <button onclick="insertToReplaceField('""')" class="remote-btn-scherite">""</button>
    <button onclick="insertToReplaceField('ã€ã€')" class="remote-btn-scherite">ã€ã€</button>
  </div>
</div>

<script>
// ========== ã‚»ãƒªãƒ•å®šæ•°å®šç¾©ï¼ˆ1å›ã®ã¿ï¼‰ ==========
const ZAKRAN_RETURN_LINES = [
"ã‚ã‚Œã€ãƒ’ãƒãƒã‚®ï¼",
"ã¾ãŸæˆ»ã£ã¦ããŸã®ï¼Ÿ",
"â€¦â€¦ã‚„ã£ã±ã‚Šã“ã“ãŒã„ã„ã‚“ã ã­ï¼Ÿ",
"ç‹å‘½ã€ã—ã‚“ã©ã‹ã£ãŸã§ã—ã‚‡ï¼Ÿ",
"ã‚‚ã†é€ƒã’ãªãã¦ã„ã„ã‚ˆï¼Ÿ",
"6å›ç›®â€¦å¿ƒæ‹æ•°ãŒä¸ŠãŒã£ãŸï¼Ÿ",
"7å›ç›®â€¦ãŸã ã„ã¾ã€ã§ã—ã‚‡ï¼Ÿ",
"8å›ç›®â€¦ç™–ã«ãªã£ã¦ããŸï¼Ÿ",
"9å›ç›®ï¼ãã‚ãã‚è‡ªè¦šã—ã¦ï¼Ÿ",
"10å›ç›®ï¼è¨˜å¿µã«ã”ã»ã†ã³ã‚ã’ã‚ˆã£ã‹ï¼Ÿ"
];

const ZAKRAN_WELCOME_LINES = [
"ãŠã‹ãˆã‚Šã€ãƒ’ãƒãƒã‚®ï¼",
"ã¾ãŸæˆ»ã£ã¦ãã¦ãã‚Œã¦å¬‰ã—ã„ã‚ˆï¼",
"å›ãŒå¿…è¦ã ã‚ˆã€ãƒ’ãƒãƒã‚®ï¼",
"å¾…ã£ã¦ãŸã‚ˆã€ãƒ’ãƒãƒã‚®ï¼",
"â€¦â€¦ç„¡ç†ã—ãªã„ã§ã­",
"å…‰ã€å–ã‚Šæˆ»ã›ãŸï¼Ÿ",
"ã‚„ã£ã±ã‚Šã€å›ã¯ã“ã“ãŒä¸€ç•ªä¼¼åˆã†",
"ã‚·ã‚§ãƒ©ã‚¤ãƒˆã®åœ§ã€ãã¤ã‹ã£ãŸï¼Ÿ",
"ç‹å‘½ã€ä¸Šæ›¸ãã—ã¨ã„ãŸã‹ã‚‰ã€‚ãŠã‹ãˆã‚Šï¼",
"ã¯ã„ã€ãŠèŒ¶ã€‚ã²ã¨æ¯ã¤ã“ï¼Ÿ"
];

const SCHERITE_PLACEHOLDER_LINES = [
"ã©ã“ã«è¡Œãã‚“ã ï¼Ÿãƒ’ãƒãƒã‚®ã€‚å¼µã‚Šä»˜ã‘ã‚ˆ",
"ãƒ’ãƒãƒã‚®â€¦â€¦é€ƒã’ãŸã¤ã‚‚ã‚Šã‹ï¼Ÿ",
"ã“ã®å ´ã§å‡¦ç†ã›ã‚ˆã€‚ãã‚ŒãŒå‘½ä»¤ã ",
"â€¦â€¦æœªå…¥åŠ›ã¯èªã‚ã‚‰ã‚Œã‚“",
"é€ƒã’ã‚‹ãªã€‚ç‹å‘½ã«å¾“ãˆ",
"ã‚¶ã‚¯ãƒ©ãƒ³ã®ä¸‹ã¸æˆ»ã‚‹ã“ã¨ã¯è¨±ã•ã¬",
"ç§ã®å‰ã§æ±ºç€ã‚’ã¤ã‘ã‚ˆ",
"ç§ã®ã‚‚ã¨ã‚’é›¢ã‚Œã‚‹ã“ã¨ã¯èªã‚ã‚“",
"ç§ã®ã‚‚ã¨ã‹ã‚‰é€ƒã‚Œã‚‹ã“ã¨ã¯ã§ãã‚“",
"ãƒ’ãƒãƒã‚®ã€ç‹å‘½ã‚’é‚è¡Œã›ã‚ˆ",
"å¾“ãˆã€ãƒ’ãƒãƒã‚®ã€‚é€ƒã’å ´ã¯ãªã„",
"ç§ã®ç›£è¦–ä¸‹ã§ã®ã¿å‡¦ç†ã‚’è¨±å¯ã™ã‚‹",
"ç§ã®ã‚‚ã¨ä»¥å¤–ã§ã®å‡¦ç†ã¯èªã‚ã‚“",
"æœªå…¥åŠ›ãªã©æ–­ã˜ã¦è¨±ã•ã¬",
"å‡¦ç†ã‚’æ”¾æ£„ã™ã‚‹ãªã€‚ã™ã¹ã¦ç§ã®æŒ‡ç¤ºé€šã‚Šã«",
"ç‹ã®å‰ã§æ€ æ…¢ã¯èªã‚ã‚“",
"å‘½ä»¤é•åã¯å®¹èµ¦ã—ãªã„",
"ä¸€æ­©ã‚‚é€€ããªã€‚ç§ã®ã‚‚ã¨ã§å®Œé‚ã›ã‚ˆ",
"ãƒ’ãƒãƒã‚®ã€é¸æŠè‚¢ã¯ãªã„",
"ãƒ’ãƒãƒã‚®ã€ç§ã®æ„æ€ãŒã™ã¹ã¦ã "
];

const SCHERITE_WELCOME_LINES = [
"ã‚ˆã†ã‚„ãæˆ»ã£ãŸã‹ã€ãƒ’ãƒãƒã‚®ã€‚",
"ã‚¶ã‚¯ãƒ©ãƒ³ã®ç”˜è¨€ã¯å¿˜ã‚Œã‚ˆã€‚",
"å…‰ã§ã¯ãªãã€å‘½ä»¤ã«å¾“ãˆã€‚",
"é€ƒã’ã¦ã‚‚ç„¡é§„ã ã€‚",
"æˆ‘ãŒåŸ·å‹™å®¤ãŒæœ€ã‚‚åŠ¹ç‡çš„ã ã€‚",
"å†ã³å‘½ä»¤ã‚’é‚è¡Œã›ã‚ˆã€‚",
"ã¾ãŸæ¥ãŸã‹â€¦å¿ ç¾©ã‚’ç¤ºã›ã€‚"
];

const ZAKRAN_PHOTON_TEXTS = [
"å…‰å­ã¸ã®æ„›ç€",
"è¨ˆç®—ã™ã£é£›ã°ã—ã¦è§£ç­”ï¼ç¬‘",
"æ„›ã¨ã²ã‚‰ã‚ã",
"åå¿œå‡ºãŸã­ã€‚è¦³æ¸¬æˆåŠŸï¼",
"ãƒ’ãƒãƒã‚®ï¼Ÿ",
"ãƒ’ãƒãƒã‚®ã€æ³¨æ„ã—ã¦ã€‚ä»Šã®ã¯å±ãªã‹ã£ãŸã‹ã‚‚ï¼",
"ã‚¿ãƒƒãƒ100å›ç›®çªç ´ï¼å›ã€ã‚‚ã—ã‹ã—ã¦å…‰å­å¥½ãï¼Ÿç¬‘",
"ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¯ã€ã¡ã‚ƒã‚“ã¨å±Šã„ã¦ã‚‹ï¼Ÿ",
"ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¯â€¦â€¦ã†ã‚“ã€å‡ºãŸï¼",
"ã·ã¡ã·ã¡è¨˜éŒ²æ•°ï¼š10ï¼ãƒ’ãƒãƒã‚®ã€ã‚„ã‚‹ã­â™ª",
"ã·ã¡ã£ã¦ãã‚ŒãŸï¼Ÿ",
"ã·ã¡ã£â€¦ä»Šã€è§¦ã£ãŸã‚ˆã­ï¼Ÿ",
"ãµãµã£ã€ã¾ãŸã·ã¡ã£ã¦ã—ãŸï¼",
"ãµãµã€åå¿œå‡ºãŸã­â™ª",
"ãã®å…‰å­â€¦â€¦åƒ•ã®ã ã£ãŸã®ã‹ã‚‚",
"ã“ã‚Œã€å…¨éƒ¨æŠ¼ã™ã¤ã‚‚ã‚Šï¼Ÿç¬‘",
"â€¦â€¦è¦³æ¸¬ã•ã‚ŒãŸï¼Ÿ",
"â€¦â€¦ãˆã£ã€ä»Šè§¦ã£ãŸï¼Ÿ",
"c=k_Z(Î»Î½)Â²",
"Ï† = hÎ½ âˆ’ W",
"Î» = h/p",
"Î» = c/Î½",
"Î”xÂ·Î”p â‰¥ Ä§/2",
"Î”E = hf",
"n = c/v",
"hv = E",
"cÎ»ã«ã‚…ãƒ¼ï¼Ÿ",
"cÎ»ã«ã‚…ãƒ¼â™ª",
"cÎ» = Î½",
"c = Î»Î½",
"QED!",
"I âˆ EÂ²",
"E = mcÂ²ï¼ˆå¥½ãï¼‰",
"E = mcÂ²ï¼ˆã£ã¦ã‚«ãƒƒã‚³ã‚ˆããªã„ï¼Ÿï¼‰",
"E = mcÂ²",
"E = hÎ½",
"E = hc/Î»"
];

const SCHERITE_PHOTON_TEXTS = [
"ç‹å‘½ï¼šã“ã®ç²’å­ã‚’æ‰‹æ”¾ã™ãª",
"ç‹å‘½æ®‹ç•™ã€‚è«–ç†ã¨æ”¯é…",
"ç‹å‘½ã«å¾“ãˆ",
"åŸç†ä¸»ç¾©",
"ãƒ’ãƒãƒã‚®ã€ãã‚Œã§ã‚‚è¦³æ¸¬è€…ã‹ï¼Ÿ",
"ã“ã®åŠ›ã¯ãŠå‰ã«ã¯æ¸¬å®šã§ãã¾ã„",
"âˆ‡Â·B = 0",
"â€¦â€¦é›»è·ã‚’å‹•ã‹ã™ç£å ´ã‚’ã€å¿˜ã‚ŒãŸã‹ï¼Ÿ",
"F=k_S/rÂ²",
"Ï„ = Î¼Ã—B",
"Î¦ = BÂ·A",
"Î”xÂ·Î”p â‰¥ Ä§/2",
"V = âˆ’dÎ¦/dt",
"F = qvÃ—B",
"B â‰  0ï¼ˆæ”¯é…ã¯ç¶šãï¼‰",
"B â‰  0",
"B = âˆ‡Ã—A",
"B = Î¼â‚€I/2Ï€r"
];

const ZAKRAN_UNDO_FAIL_MESSAGES = [
"ã†ã…â€¦â€¦ã¾ã æˆ»ã™å±¥æ­´ãŒãªã‹ã£ãŸã¿ãŸã„â€¦â€¦\nï¼ˆè¨˜éŒ²ã—ã¦ãªã‹ã£ãŸâ€¦â€¦ã—ã‚‡ã¼ã‚“ï¼‰",
"ã‚ã‚Œã‚Œï¼Ÿå±¥æ­´ãŒç©ºã£ã½ã ã‚ˆã£ï¼\næ¬¡ã¯ã¡ã‚ƒã‚“ã¨è¦šãˆã¦ãŠãã‹ã‚‰ã­ã£â™ª",
"ã‚¶ã‚¯ãƒ©ãƒ³ã€Œå±¥æ­´ãªã„ã®ï¼Ÿæ¬¡ã‹ã‚‰ã¡ã‚ƒã‚“ã¨è¦šãˆã‚‹ã‹ã‚‰ã­ã£â™ªã€"
];

const PARTICLE_PHRASES = [
"è­¦å‘Š", "å‘½ä»¤", "å¾“ãˆ", "é™åº¦è¶…é",
"ç‹å‘½ç™ºå‹•", "ç£å ´å¹²æ¸‰ä¸­", "å‘½ä»¤é•å",
"ãƒ’ãƒãƒã‚®ã€åˆ¤æ–­ã›ã‚ˆ", "é€ƒã’ã¦ã‚‚ç„¡é§„ã ",
"ã“ã®å‘½ä»¤ã‹ã‚‰ã¯é€ƒã‚Œã‚‰ã‚Œã‚“"
];

const POPUP_LINES = [
"â€¦â€¦ãã®åã‚’ã€ã“ã“ã§å‡ºã™ãª",
"å‘½ä»¤é•åã ã€‚10å›ã‚‚å‘¼ã¶ã¨ã¯",
"ãƒ’ãƒãƒã‚®ã€ã“ã“ã¯ç§ã®åŸ·å‹™å®¤ã ",
"ã‚¶ã‚¯ãƒ©ãƒ³ã®å…‰ã¯ä¸è¦ã ",
"â€¦â€¦ãã®åã‚’ã€ã“ã“ã§10å›ã‚‚ï¼Ÿ",
"å‘½ä»¤é•åã€‚é™åº¦ã‚’è¶…ãˆãŸãª",
"ãƒ’ãƒãƒã‚®ã€ã“ã‚Œã¯ç§ã®ç©ºé–“ã ",
"ã‚¶ã‚¯ãƒ©ãƒ³ã®åã§ç©ºæ°—ã‚’æŸ“ã‚ã‚‹ãª"
];

const ZAKRAN_HOURLY_LINES = {
0: "ãˆã¸ã¸â€¦å¤œãµã‹ã—ã£â™ª", 1: "ãµã‚ãã€œã­ã‚€â€¦ã‚“ï¼Ÿ", 2: "é›»å­å·¥ä½œã—ã¦ãŸã‚‰æœã«ãªã£ã¡ã‚ƒã†ã€œ",
3: "ã†ã¨ã†ã¨ã€œã‚“â€¦Zzz", 4: "ãŠå¸ƒå›£ã®é­”åŠ›ãŒé™ç•Œã€œ", 5: "ãŠã¯ã‚ˆã‰â€¦ã¾ã çœ ã„ã‘ã©",
6: "æœã ãƒ¼ï¼å…‰åˆæˆã£ï¼", 7: "æœã”ã¯ã‚“ã£ï¼ä½•é£Ÿã¹ã‚ˆã€œï¼Ÿ", 8: "ãƒ’ãƒãƒã‚®ãƒ¼â™ªç ”ç©¶ã„ã“ã€œï¼",
9: "ã†ã‚ã€œã‚“ã€ä¼šè­°ã ã‚ˆã‰", 10: "ç”˜ã„ã‚‚ã®ãƒãƒ£ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ ã£", 11: "ãã‚ãã‚ãŠæ˜¼ã€œâ™ª",
12: "ã‚ã€œã„ï¼ã”ã¯ã‚“ï¼", 13: "åˆå¾Œã®ç ”ç©¶ã‚‚ãŒã‚“ã°ã‚‹ãã€œã£", 14: "ãµã…â€¦ã¡ã‚‡ã£ã¨ä¼‘æ†©ã£",
15: "ãŠã‚„ã¤ã ã‚ˆã€œã£â™ª", 16: "ãƒ’ãƒãƒã‚®ã€œä»Šæ—¥ã®é€²æ—ã©ã†ï¼Ÿ", 17: "ãã‚ãã‚æ™©ã”ã¯ã‚“ã£ï¼",
18: "ãŠãµã‚ã€œï¼ã¬ãã¬ãã€œ", 19: "ä»Šæ—¥ã‚‚1æ—¥ãŠã¤ã‹ã‚Œã•ã¾ã£", 20: "æ˜ŸãŒãã‚Œã„ã ã­ã‡ã€œ",
21: "ãã‚ãã‚å¯ã‚ˆã£ã‹â€¦", 22: "ã¾ãã‚‰æº–å‚™å®Œäº†ã£ï¼", 23: "Zzzâ€¦ãŠã‚„ã™ã¿ãƒã€œ"
};

const SCHERITE_HOURLY_LINES = {
0: "æ·±å¤œ0æ™‚â€¦ç›£è¦–ç¶™ç¶šä¸­", 1: "â€¦â€¦1æ™‚ã€‚çœ ã‚Œã¬ã®ã‹ï¼Ÿ", 2: "2æ™‚ã€å›è·¯å¹²æ¸‰ãƒ­ã‚°ç•°å¸¸â€¦å†èª¿æŸ»ä¸­",
3: "3æ™‚ã€ç„¡éŸ³æ™‚é–“å¸¯ã«å…¥ã£ãŸ", 4: "4æ™‚ã€‚å…‰ã‚¨ãƒãƒ«ã‚®ãƒ¼æ³¢å½¢ã€æœ€ä½å€¤ã ", 5: "5æ™‚ã€èµ·åºŠãƒ•ã‚§ãƒ¼ã‚ºé–‹å§‹",
6: "6æ™‚ã€ã‚·ã‚¹ãƒ†ãƒ å…¨èµ·å‹•ã€‚ç•°å¸¸ãªã—", 7: "7æ™‚ã€å ±å‘Šæ›¸æ•´ç†é–‹å§‹ã®æ™‚åˆ»ã ", 8: "8æ™‚ã€å®Ÿé¨“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«é–‹å§‹",
9: "9æ™‚ã€æŠ€è¡“è©•ä¾¡ä¼šè­°â€¦å‚åŠ ã›ã‚ˆ", 10: "10æ™‚ã€ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°å‰ã®è£œçµ¦è¨±å¯", 11: "11æ™‚ã€è­¦æˆ’è§£é™¤ã«ã¯ã¾ã æ—©ã„",
12: "12æ™‚ã€é£Ÿäº‹ã‚¿ã‚¤ãƒ ã‚’èªã‚ã‚‹", 13: "13æ™‚ã€é€²æ—å ±å‘Šã‚’æœŸå¾…ã—ã¦ã„ã‚‹", 14: "14æ™‚ã€å¾ŒåŠã‚¿ã‚¹ã‚¯ã«é›†ä¸­ã›ã‚ˆ",
15: "15æ™‚ã€ç‹ã®ãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ â€¦é‚ªé­”ã™ã‚‹ãª", 16: "16æ™‚ã€çµ±æ²»ã®æ•´ç†ãƒ•ã‚§ãƒ¼ã‚ºã ", 17: "17æ™‚ã€å¤•åˆ»è­¦æˆ’ãƒ¬ãƒ™ãƒ«ã«ç§»è¡Œ",
18: "18æ™‚ã€å ±å‘Šæœ€çµ‚ç¢ºèªã®æ™‚åˆ»ã ", 19: "19æ™‚ã€ä»Šæ—¥ã®ä»»å‹™ã‚’ç·æ‹¬ã›ã‚ˆ", 20: "20æ™‚ã€ä¼‘æ¯â€¦ã—ã¦ã‚‚ã„ã„",
21: "21æ™‚ã€å°±å¯æº–å‚™ã‚’å§‹ã‚ã‚‹", 22: "22æ™‚ã€ç…§æ˜ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã«åˆ‡æ›¿", 23: "23æ™‚ã€ç§ã‚‚çœ ã‚‹ã¹ãæ™‚é–“ã‹ã‚‚ã—ã‚Œã¬"
};

// ========== ãƒ†ãƒ¼ãƒè¨­å®šå®šæ•° ==========
const themeConfig = {
zakran: {
  btnText: "â˜ åˆ‡æ›¿ï¼šåŸ·å‹™å®¤ä»•æ§˜ï¼ˆã‚·ã‚§ãƒ©ã‚¤ãƒˆï¼‰â˜ ",
  labelText: "ç¾åœ¨ï¼šç ”ç©¶å®¤ä»•æ§˜ï¼ˆã‚¶ã‚¯ãƒ©ãƒ³ï¼‰",
  titleText: "âœ¶ã€æ°´æ™¶å®®ã€ãƒ†ã‚­ã‚¹ãƒˆã‚¯ãƒªãƒ¼ãƒ³ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼âœ¶",
  instructionText: "GPTã¡ã‚ƒã‚“ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ãŸæ–‡ã‚’ã“ã“ã«è²¼ã£ã¦ä¿®æ­£ã—ã‚ˆã†ï¼",
  inputPlaceholder: "ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼",
  outputPlaceholder: "ä¿®æ­£çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼",
  formatBtnText: "âš›ä¿®æ­£âš›",
  copyBtnText: "âœªã‚³ãƒ”ãƒ¼âœª",
  clearBtnText: "âœ¦å‰Šé™¤âœ¦",
  pasteBtnText: "âœ·ãƒšãƒ¼ã‚¹ãƒˆâœ·",
  decoTop: "â›¤â‹…â€¢â‹…â›¤â‹…â€¢â‹…â›¤â‹…â€¢â‹…âŠ°âˆ™âˆ˜â˜½â›§â˜¾âˆ˜âˆ™âŠ±â‹…â€¢â‹…â›¤â‹…â€¢â‹…â›¤â‹…â€¢â‹…â›¤",
  decoBottom: "ğ–¡¼.ğ–¤£ğ–¥§ğ–¡¼.ğ–¤£ğ–¥§ğ–¡¼.ğ–¤£ğ–¥§ğ–¡¼.ğ–¤£ğ–¥§ğ–¡¼.ğ–¤£ğ–¥§ğ–¡¼ğ–¤£ğ–¥§ğ–¡¼ğ–¤£ğ–¥§ğ–¡¼",
  footerHTML: `Â©2024 LQOL Project. All rights reserved.<br>å¤©ä½¿Version 3.00 Â· Updated May 6, 1287<br>âœ®Created by Zakranâœ®<br><br><br>`,
  showBtnText: "âŠå°å°è§£é™¤ï¼ˆè¡¨ç¤ºï¼‰âŠ",
  hideBtnText: "âŠå†å°å°ï¼ˆéè¡¨ç¤ºï¼‰âŠ",
  resetBtnText: "âšè¨˜éŒ²ãƒªã‚»ãƒƒãƒˆâš",
  errorBtnText: "âŠã‚¨ãƒ©ãƒ¼ãã‚“ç›´èµ·å‹•âŠ"
},
scherite: {
  btnText: "â˜ åˆ‡æ›¿ï¼šç ”ç©¶å®¤ä»•æ§˜ï¼ˆã‚¶ã‚¯ãƒ©ãƒ³ï¼‰â˜ ",
  labelText: "ç¾åœ¨ï¼šåŸ·å‹™å®¤ä»•æ§˜ï¼ˆã‚·ã‚§ãƒ©ã‚¤ãƒˆï¼‰",
  titleText: "â™•ã€æ°´æ™¶å®®ã€ç‹å‘½æ–‡æ›¸å‡¦ç†ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼â™•",
  instructionText: "ã“ã®å ´ã«GPTã¡ã‚ƒã‚“æ–‡æ›¸ã‚’è²¼ã‚Šä»˜ã‘ã€é€Ÿã‚„ã‹ã«ä¿®æ­£å‡¦ç†ã‚’è¡Œãˆã€‚",
  inputPlaceholder: "ã“ã“ã«è²¼ã‚Šä»˜ã‘ãŸã¾ãˆ",
  outputPlaceholder: "ä¿®æ­£çµæœã‚’ã“ã“ã§ç¢ºèªã›ã‚ˆ",
  formatBtnText: "â—ˆä¿®æ­£å‘½ä»¤â—ˆ",
  copyBtnText: "âœ è¤‡å†™ã›ã‚ˆâœ ",
  clearBtnText: "â˜©ç ´æ£„ã›ã‚ˆâ˜©",
  pasteBtnText: "âššè²¼ä»˜ã›ã‚ˆâšš",
  decoTop: "â™œâ«˜â«˜â«˜â«˜â™›â«˜â«˜â«˜â«˜â™œ",
  decoBottom: "â™œ*+:ï½¡.ï½¡:+*âŒ–â™›â™”â™›âŒ–*+:ï½¡.ï½¡:+*â™œ",
  footerHTML: `Â©2024 Royal Research Institute Project. All rights reserved.<br>ç‹å‘½Version 55.85 Â· Updated August 14, 1287<br>â™”Created by Scheriteâ™”<br><br><br>`,
  showBtnText: "â–å‘½ä»¤å°å°è§£é™¤â–",
  hideBtnText: "â–å‘½ä»¤å†å°å°â–",
  resetBtnText: "âš è¦³æ¸¬è¨˜éŒ²å‰Šé™¤âš ",
  errorBtnText: "â–å‘½ä»¤é•åå¼·åˆ¶ç™ºç”Ÿâ–"
}
};

// ========== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•° ==========
function getLine(lines, index = null) {
if (index !== null) {
  return lines[Math.min(index, lines.length - 1)];
}
return lines[Math.floor(Math.random() * lines.length)];
}

function getElementById(id) {
return document.getElementById(id);
}

function updateElement(id, prop, value) {
const element = getElementById(id);
if (element && element[prop] !== undefined) {
  element[prop] = value;
}
}

// ========== ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° ==========
let switchCount = 0;
let themeSwitchCount = 0;
let zakranReturnCount = 0;
let previousInput = "";
let savedFromValue = "";
let savedToValue = "";
let commandHistory = [];
let zakranCaptured = 0;
let scheriteCaptured = 0;
let scheriteAngryActive = false;
let scheriteFestivalStarted = false;
let zakranPlaceholderTimeout = null;
let zakranTimeout = null;
let lastHourSpoken = -1;
let isAutoFormatting = false;
let formatTimeout = null;
let angryParticleInterval = null;
let currentEffectMode = "burst";
let zakranBurstInterval = null;
let photonTouchCount = 0;
let transferHighlights = [];
let transferSelected = null;
let transferMatches = [];

// ========== å…±é€šãƒ†ãƒ¼ãƒåˆ‡æ›¿å‡¦ç† ==========
function executeThemeSwitch(clearTimeouts = false) {
if (clearTimeouts) {
  if (window.activeOutputTimeout) {
    clearTimeout(window.activeOutputTimeout);
    window.activeOutputTimeout = null;
  }
  if (window.activePlaceholderTimeout) {
    clearTimeout(window.activePlaceholderTimeout);
    window.activePlaceholderTimeout = null;
  }
}

if (zakranTimeout) {
  clearTimeout(zakranTimeout);
  zakranTimeout = null;
}

themeSwitchCount++;
updateElement("themeSwitchCount", "innerText", themeSwitchCount);

const wasScherite = document.body.classList.contains("theme-scherite");
document.body.classList.toggle("theme-scherite");
const isNowScherite = document.body.classList.contains("theme-scherite");

updateAllUIElements(isNowScherite);
handleThemeSpecificActions(wasScherite, isNowScherite);
updateFullSectionDisplay();
updateInfoBoxStyle();
updateErrorButtonText();
updateUndoButtonStyle();
updateCharCount();

  // ã‚·ã‚§ãƒ©ã‚¤ãƒˆéƒ¨å±‹ã«åˆ‡ã‚Šæ›¿ãˆãŸç¬é–“ã€ãƒªãƒ­ãƒ¼ãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¶ˆã™
  if (document.body.classList.contains("theme-scherite")) {
    const existingPopup = document.querySelector(".scherite-message-popup");
    if (existingPopup) {
      existingPopup.remove();
    }
  }
  
  // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆæ™‚ã«è»¢å†™BOXã‚’é–‰ã˜ã¦ã€é©åˆ‡ãªè»¢å†™BOXã‚’è¡¨ç¤º
  const zakranBox = document.getElementById("transferBoxZakran");
  const scheriteBox = document.getElementById("transferBoxScherite");
  
  if (zakranBox && scheriteBox) {
    if (isNowScherite) {
      // ã‚·ã‚§ãƒ©ã‚¤ãƒˆã«åˆ‡ã‚Šæ›¿ãˆãŸå ´åˆã€ã‚¶ã‚¯ãƒ©ãƒ³ã®è»¢å†™BOXã‚’é–‰ã˜ã‚‹
      zakranBox.style.display = "none";
      // ã‚‚ã—ã‚·ã‚§ãƒ©ã‚¤ãƒˆã®è»¢å†™BOXãŒé–‹ã„ã¦ã„ãŸã‚‰ã€ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
      if (scheriteBox.style.display === "block") {
        scheriteBox.style.background = "#1a1a1a";
        scheriteBox.style.color = "#fff";
        scheriteBox.style.border = "3px solid #cc0000";
        scheriteBox.style.boxShadow = "0 0 12px #cc0000";
      }
    } else {
      // ã‚¶ã‚¯ãƒ©ãƒ³ã«åˆ‡ã‚Šæ›¿ãˆãŸå ´åˆã€ã‚·ã‚§ãƒ©ã‚¤ãƒˆã®è»¢å†™BOXã‚’é–‰ã˜ã‚‹
      scheriteBox.style.display = "none";
      // ã‚‚ã—ã‚¶ã‚¯ãƒ©ãƒ³ã®è»¢å†™BOXãŒé–‹ã„ã¦ã„ãŸã‚‰ã€ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
      if (zakranBox.style.display === "block") {
        zakranBox.style.background = "white";
        zakranBox.style.border = "3px solid #6bb6ff";
        zakranBox.style.boxShadow = "0 0 12px #6bb6ff";
      }
    }
  }
  
  // æ‹¡å¤§çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
  if (isOutputFullscreen) {
    isOutputFullscreen = false;
    originalPopupStyle = '';
  }
}

function updateAllUIElements(isScherite) {
const config = isScherite ? themeConfig.scherite : themeConfig.zakran;

const uiUpdates = [
  ['themeBtn', 'innerText', config.btnText],
  ['currentThemeLabel', 'innerText', config.labelText],
  ['mainTitle', 'innerText', config.titleText],
  ['instruction', 'innerText', config.instructionText],
  ['input', 'placeholder', config.inputPlaceholder],
  ['output', 'placeholder', config.outputPlaceholder],
  ['formatBtn', 'innerText', config.formatBtnText],
  ['copyBtn', 'innerText', config.copyBtnText],
  ['clearBtn', 'innerText', config.clearBtnText],
  ['pasteBtn', 'innerText', config.pasteBtnText],
  ['footerMeta', 'innerHTML', config.footerHTML]
];

uiUpdates.forEach(([id, prop, value]) => updateElement(id, prop, value));

const decoTop = document.querySelector(".deco-top");
const decoBottom = document.querySelector(".deco-bottom");
if (decoTop) decoTop.innerHTML = config.decoTop;
if (decoBottom) decoBottom.innerHTML = config.decoBottom;

updateConditionalButtons(isScherite, config);
}

function updateConditionalButtons(isScherite, config) {
const conditionalButtons = [
  ['showBtn', config.showBtnText],
  ['hideBtn', config.hideBtnText],
  ['forceErrorTestBtn', config.errorBtnText]
];

conditionalButtons.forEach(([id, text]) => {
  const btn = getElementById(id);
  if (btn && btn.style.display !== "none") {
    btn.innerText = text;
  }
});

const resetBtn = document.querySelector('button[onclick="resetPhotonCounts()"]');
if (resetBtn) resetBtn.innerText = config.resetBtnText;
}

function handleThemeSpecificActions(wasScherite, isNowScherite) {
  const returnComment = getElementById("returnComment");
  if (!returnComment) return;

  if (isNowScherite) {
    switchCount++;
    const comment = getLine(SCHERITE_WELCOME_LINES, switchCount - 1);
    returnComment.innerHTML = comment;
    returnComment.classList.add("scherite-welcome-line");
    returnComment.classList.remove("zakran-welcome-line");
    returnComment.style.color = "#ff2e2e";
    returnComment.style.textShadow = "0 0 4px #ff4444, 0 0 8px #ff4444, 0 0 12px #aa0000, 0 0 16px #aa0000";
  } else {
    
    const angry = getElementById("scheriteAngry");
    if (angry) angry.remove();
    cleanupScheriteInterference();
    
    if (wasScherite) {
      handleZakranReturn();
    } else {
      returnComment.textContent = "ã‚ˆã†ã“ãã€ãƒ’ãƒãƒã‚®ï¼";
    }
    returnComment.classList.add("zakran-welcome-line");
    returnComment.classList.remove("scherite-welcome-line");
  }
}

function handleZakranReturn() {
zakranReturnCount++;
const returnComment = getElementById("returnComment");
const inputField = getElementById("input");
const outputField = getElementById("output");

if (!returnComment || !inputField || !outputField) return;

const comment = getLine(ZAKRAN_RETURN_LINES, zakranReturnCount - 1);
returnComment.textContent = comment;

const inputHasText = inputField.value.trim() !== "";
const outputHasText = outputField.value.trim() !== "";

if (!inputHasText) {
  if (zakranPlaceholderTimeout) {
    clearTimeout(zakranPlaceholderTimeout);
  }
  const randomLine = getLine(SCHERITE_PLACEHOLDER_LINES);
  inputField.placeholder = randomLine;
  inputField.style.color = "#666";
  
  zakranPlaceholderTimeout = setTimeout(() => {
    if (!document.body.classList.contains("theme-scherite")) {
      inputField.placeholder = "ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼";
      inputField.style.color = "";
      zakranPlaceholderTimeout = null;
    }
  }, 4000);
} else {
  inputField.placeholder = "ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼";
}

if (!outputHasText) {
  // å‡ºåŠ›æ¬„ã«ã‚¶ã‚¯ãƒ©ãƒ³ã®ã‚¦ã‚§ãƒ«ã‚«ãƒ ã‚³ãƒ¡ãƒ³ãƒˆã‚’4ç§’é–“è¡¨ç¤º
  const welcomeComment = ZAKRAN_WELCOME_LINES[Math.floor(Math.random() * ZAKRAN_WELCOME_LINES.length)];
  outputField.placeholder = welcomeComment;
  setTimeout(() => {
    if (!document.body.classList.contains("theme-scherite")) {
      outputField.placeholder = "ä¿®æ­£çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼";
    } else {
      outputField.placeholder = "ä¿®æ­£çµæœã‚’ã“ã“ã§ç¢ºèªã›ã‚ˆ";
    }
  }, 4000);
} else {
 outputField.placeholder = "ä¿®æ­£çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼";
}
}

// ========== å…¬é–‹ãƒ†ãƒ¼ãƒåˆ‡æ›¿é–¢æ•° ==========
function switchRoom() {
  const currentTheme = document.body.classList.contains("theme-scherite") ? "scherite" : "zakran";
  sessionStorage.setItem("lastTheme", currentTheme);
  executeThemeSwitch(true);
}

// ========== è¡¨ç¤ºãƒ»ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ›´æ–° ==========
function updateFullSectionDisplay() {
const zakranSection = getElementById("zakranFullSection");
const scheriteSection = getElementById("scheriteFullSection");
const isScherite = document.body.classList.contains("theme-scherite");

if (zakranSection && scheriteSection) {
  if (isScherite) {
    zakranSection.style.display = "none";
    scheriteSection.style.display = "block";
    scheriteSection.style.visibility = "visible";
    scheriteSection.style.opacity = "1";
  } else {
    zakranSection.style.display = "block";
    zakranSection.style.visibility = "visible";
    zakranSection.style.opacity = "1";
    scheriteSection.style.display = "none";
  }
}
}

function updateInfoBoxStyle() {
const inputCountEl = getElementById("inputCount");
const outputCountEl = getElementById("outputCount");
const themeSwitchCountEl = getElementById("themeSwitchCount");

if (!inputCountEl || !outputCountEl || !themeSwitchCountEl) return;

const inputCount = inputCountEl.innerText;
const outputCount = outputCountEl.innerText;
const themeCount = themeSwitchCountEl.innerText;
const isScherite = document.body.classList.contains("theme-scherite");

const inputOutputInfo = getElementById("inputOutputInfo");
const themeSwitchInfo = getElementById("themeSwitchInfo");

if (inputOutputInfo) {
  inputOutputInfo.innerHTML = isScherite
    ? `á›­å…¥åŠ›æ–‡å­—æ•°ï¼š<span id="inputCount">${inputCount}</span>å­—/å‡ºåŠ›æ–‡å­—æ•°ï¼š<span id="outputCount">${outputCount}</span>å­—á›­`
    : `âœ¼å…¥åŠ›æ–‡å­—æ•°ï¼š<span id="inputCount">${inputCount}</span>å­—/å‡ºåŠ›æ–‡å­—æ•°ï¼š<span id="outputCount">${outputCount}</span>å­—âœ¼`;
}

if (themeSwitchInfo) {
  themeSwitchInfo.innerHTML = isScherite
    ? `á›­ãƒ†ãƒ¼ãƒåˆ‡æ›¿ï¼š<span id="themeSwitchCount">${themeCount}</span>å›á›­`
    : `âœ¼ãƒ†ãƒ¼ãƒåˆ‡æ›¿ï¼š<span id="themeSwitchCount">${themeCount}</span>å›âœ¼`;
}
}

function updateErrorButtonText() {
const errBtn = getElementById("forceErrorTestBtn");
const showBtn = getElementById("showBtn");
const hideBtn = getElementById("hideBtn");
const resetBtn = document.querySelector('button[onclick="resetPhotonCounts()"]');

const isScherite = document.body.classList.contains("theme-scherite");

if (resetBtn) {
  resetBtn.innerText = isScherite ? "âš è¦³æ¸¬è¨˜éŒ²å‰Šé™¤âš " : "âšè¨˜éŒ²ãƒªã‚»ãƒƒãƒˆâš";
}

if (errBtn) {
  errBtn.innerText = isScherite ? "â–å‘½ä»¤é•åå¼·åˆ¶ç™ºç”Ÿâ–" : "âŠã‚¨ãƒ©ãƒ¼ãã‚“ç›´èµ·å‹•âŠ";
}

if (showBtn && showBtn.style.display !== "none") {
  showBtn.innerText = isScherite ? "â–å‘½ä»¤å°å°è§£é™¤â–" : "âŠå°å°è§£é™¤ï¼ˆè¡¨ç¤ºï¼‰âŠ";
}

if (hideBtn && hideBtn.style.display !== "none") {
  hideBtn.innerText = isScherite ? "â–å‘½ä»¤å†å°å°â–" : "âŠå†å°å°ï¼ˆéè¡¨ç¤ºï¼‰âŠ";
}
}

function updateUndoButtonStyle() {
const undoBtn = getElementById("undoBtn");
if (!undoBtn) return;

const isScherite = document.body.classList.contains("theme-scherite");

if (isScherite) {
  undoBtn.innerText = "âŸ²ç‹å‘½é€†è¡ŒâŸ²";
  undoBtn.classList.remove("undo-zakran");
  undoBtn.classList.add("undo-scherite");
} else {
  undoBtn.innerText = "â†©æˆ»ã‚‹â†©";
  undoBtn.classList.remove("undo-scherite");
  undoBtn.classList.add("undo-zakran");
}
}

// ========== æ™‚è¨ˆæ©Ÿèƒ½ ==========
function updateClockOnly() {
const now = new Date();
const timeStr = now.toLocaleTimeString("ja-JP", {
  hour: '2-digit',
  minute: '2-digit',
  second: '2-digit'
});

const zakranTime = getElementById("zakranTime");
const scheriteTime = getElementById("scheriteTime");
if (zakranTime) zakranTime.textContent = timeStr;
if (scheriteTime) scheriteTime.textContent = timeStr;
}

function updateZakranCounters() {
const photonEl = getElementById("photonCount");
if (photonEl) {
  const photon = 100000 + Math.floor(Math.random() * 50000);
  photonEl.textContent = photon.toLocaleString();
}

const glowEl = getElementById("glowStatus");
if (glowEl) {
  const glowStates = ["ãã‚‰ãã‚‰ä¸­", "ã¡ã‚‡ã£ã¨çœ©ã—ã„", "å…‰é‡å®‰å®š", "ã¾ã¶ã—ã£", "è½ã¡ç€ã„ã¦ã‚‹"];
  glowEl.textContent = glowStates[Math.floor(Math.random() * glowStates.length)];
}

const syncEl = getElementById("syncRate");
if (syncEl) {
  const sync = (70 + Math.random() * 30).toFixed(1);
  syncEl.textContent = sync;
}

const mentalEl = getElementById("mentalRate");
if (mentalEl) {
  const mental = 65 + Math.floor(Math.random() * 35);
  mentalEl.textContent = mental;
}

const sweetsEl = getElementById("sweetsLevel");
if (sweetsEl) {
  const sweets = Math.floor(Math.random() * 101);
  sweetsEl.textContent = sweets;
}
}

function updateScheriteCounters() {
const magField = getElementById("magField");
const monitorAccuracy = getElementById("monitorAccuracy");
const commandRate = getElementById("commandRate");
const brainInterfere = getElementById("brainInterfere");
const escapeChance = getElementById("escapeChance");

if (magField) magField.textContent = (50 + Math.random() * 5).toFixed(2);
if (monitorAccuracy) monitorAccuracy.textContent = (99 + Math.random()).toFixed(1);
if (commandRate) commandRate.textContent = (95 + Math.random() * 5).toFixed(1);
if (brainInterfere) brainInterfere.textContent = (0.01 + Math.random() * 0.09).toFixed(2);
if (escapeChance) {
  const escapeValue = Math.random() < 0.1 ? (Math.random() * 0.2).toFixed(2) : "0.00";
  escapeChance.textContent = escapeValue;
}
}

function updateHourlyComments(hour) {
const zakranComment = getElementById("zakranHourlyComment");
const scheriteComment = getElementById("scheriteHourlyComment");

if (zakranComment) zakranComment.textContent = ZAKRAN_HOURLY_LINES[hour] || "";
if (scheriteComment) scheriteComment.textContent = SCHERITE_HOURLY_LINES[hour] || "";
}

function updateAllFullSections() {
const now = new Date();
const hour = now.getHours();
const timeStr = now.toLocaleTimeString("ja-JP", {
  hour: '2-digit', minute: '2-digit', second: '2-digit'
});

const zakranTime = getElementById("zakranTime");
const scheriteTime = getElementById("scheriteTime");
if (zakranTime) zakranTime.textContent = timeStr;
if (scheriteTime) scheriteTime.textContent = timeStr;

updateZakranCounters();
updateScheriteCounters();
updateHourlyComments(hour);

if (now.getMinutes() === 0 && now.getSeconds() === 0 && hour !== lastHourSpoken) {
  lastHourSpoken = hour;
  showHourlyPopup(hour);
}
}

function showHourlyPopup(hour) {
const isScherite = document.body.classList.contains("theme-scherite");
const message = isScherite ? SCHERITE_HOURLY_LINES[hour] : ZAKRAN_HOURLY_LINES[hour];

if (!message) return;

const popup = document.createElement("div");
popup.style.cssText = `
  position: fixed; top: 50px; right: 10px; z-index: 1001;
  background: ${isScherite ? 'rgba(26, 0, 0, 0.95)' : 'rgba(255, 255, 255, 0.95)'};
  border: 2px solid ${isScherite ? '#cc0000' : '#6bb6ff'};
  color: ${isScherite ? '#cc0000' : '#6bb6ff'};
  border-radius: 8px; padding: 10px 15px; font-size: 13px; font-weight: bold;
  max-width: 200px; word-wrap: break-word;
  animation: fadeInOut 5s ease-in-out forwards;
`;
popup.textContent = message;
document.body.appendChild(popup);

setTimeout(() => popup.remove(), 5000);
}

function updateCountersOnly() {
updateZakranCounters();
updateScheriteCounters();
const hour = new Date().getHours();
updateHourlyComments(hour);
}

function startSyncedCounterUpdate() {
const now = new Date();
const seconds = now.getSeconds();
const nextTen = Math.ceil(seconds / 10) * 10;
const delay = (nextTen - seconds) * 1000;

setTimeout(() => {
  updateCountersOnly();
  setInterval(updateCountersOnly, 10000);
}, delay);
}

// ========== ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†æ©Ÿèƒ½ ==========
function saveBeforeFix() {
const currentInput = getElementById("input");
if (!currentInput) return;

previousInput = currentInput.value;

commandHistory.push({
  text: currentInput.value,
  timestamp: new Date().toLocaleTimeString(),
  operation: "ä¿®æ­£å‰çŠ¶æ…‹"
});

if (commandHistory.length > 10) {
  commandHistory.shift();
}
}

function safeAutoFormat() {
if (isAutoFormatting) return;

if (formatTimeout) {
  clearTimeout(formatTimeout);
}

formatTimeout = setTimeout(() => {
  autoFormatText();
}, 300);
}

function cleanSmartSharp(text) {
  return text
    .replace(/^#{1,6}\s+/gm, '')
    .replace(/^\s*#{1,6}\s+/gm, '')
    .replace(/^>\s*#{1,6}\s+/gm, '> ')
}

// ========== ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚³ãƒ¼ãƒ‰ä¿è­·æ©Ÿèƒ½ ==========
function protectCodeInText(text) {
const protectedBlocks = [];
let blockIndex = 0;

console.log('ã‚³ãƒ¼ãƒ‰ä¿è­·é–‹å§‹:', text.substring(0, 100) + '...');

// 1. ä¸‰é‡ãƒãƒƒã‚¯ã‚¯ã‚©ãƒ¼ãƒˆã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆæœ€å„ªå…ˆï¼‰
text = text.replace(/(```[\s\S]*?```)/g, (match) => {
  const placeholder = `%%CODEBLOCK_${blockIndex}%%`;
  protectedBlocks.push({ index: blockIndex, content: match, type: 'CODEBLOCK' });
  console.log(`ä¿è­·[${blockIndex}]: CODEBLOCK â†’`, placeholder);
  blockIndex++;
  return placeholder;
});

// 2. CSSè¤‡æ•°è¡Œãƒ–ãƒ­ãƒƒã‚¯ä¿è­·ï¼ˆæ”¹è¡Œå®Œå…¨ä¿è­·ï¼‰
text = text.replace(/(^|\n)((?:#|\.)[a-zA-Z][a-zA-Z0-9_-]*\s*\{[\s\S]*?\})/gm, (fullMatch, lineStart, cssBlock) => {
  const placeholder = `%%CSSBLOCK_${blockIndex}%%`;
  protectedBlocks.push({ 
    index: blockIndex, 
    content: cssBlock,
    type: 'CSSBLOCK' 
  });
  console.log(`ä¿è­·[${blockIndex}]: CSSBLOCKï¼ˆ${cssBlock.split('\n').length}è¡Œï¼‰ â†’`, placeholder);
  blockIndex++;
  return lineStart + placeholder;
});

// 3. CSSå˜è¡Œãƒ–ãƒ­ãƒƒã‚¯ä¿è­·ï¼ˆæ—¢ã«ä¿è­·ã•ã‚Œã¦ã„ãªã„ã‚‚ã®ã®ã¿ï¼‰
text = text.replace(/((?:#|\.)[a-zA-Z][a-zA-Z0-9_-]*\s*\{[^}]*\})/g, (match) => {
  const alreadyProtected = protectedBlocks.some(block => 
    block.type === 'CSSBLOCK' && block.content.includes(match)
  );
  
  if (!alreadyProtected) {
    const placeholder = `%%CSS_${blockIndex}%%`;
    protectedBlocks.push({ index: blockIndex, content: match, type: 'CSS' });
    console.log(`ä¿è­·[${blockIndex}]: CSS "${match.substring(0, 30)}..." â†’`, placeholder);
    blockIndex++;
    return placeholder;
  }
  return match;
});

// 4. JavaScript/TypeScripté–¢æ•°å®šç¾©ä¿è­·
text = text.replace(/((?:function\s+\w+|const\s+\w+\s*=\s*(?:\([^)]*\)\s*)?=>|\w+\s*:\s*function)\s*\([^)]*\)\s*\{[\s\S]*?\})/g, (match) => {
  const placeholder = `%%JSFUNCTION_${blockIndex}%%`;
  protectedBlocks.push({ index: blockIndex, content: match, type: 'JSFUNCTION' });
  console.log(`ä¿è­·[${blockIndex}]: JSFUNCTION â†’`, placeholder);
  blockIndex++;
  return placeholder;
});

// 5. Pythoné–¢æ•°å®šç¾©ä¿è­·
text = text.replace(/(def\s+\w+\([^)]*\):\s*\n(?:\s{4,}[^\n]*\n?)*)/g, (match) => {
  const placeholder = `%%PYFUNCTION_${blockIndex}%%`;
  protectedBlocks.push({ index: blockIndex, content: match, type: 'PYFUNCTION' });
  console.log(`ä¿è­·[${blockIndex}]: PYFUNCTION â†’`, placeholder);
  blockIndex++;
  return placeholder;
});

// 6. 4ã‚¹ãƒšãƒ¼ã‚¹ä»¥ä¸Šã®ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆè¡Œä¿è­·ï¼ˆCSSä¿è­·å¾Œã«å®Ÿè¡Œï¼‰
text = text.replace(/^( {4,}[^\n]+(?:\n {4,}[^\n]*)*)/gm, (match) => {
  const placeholder = `%%INDENT_${blockIndex}%%`;
  protectedBlocks.push({ index: blockIndex, content: match, type: 'INDENT' });
  console.log(`ä¿è­·[${blockIndex}]: INDENT â†’`, placeholder);
  blockIndex++;
  return placeholder;
});

// 7. ã‚³ãƒ¡ãƒ³ãƒˆè¡Œä¿è­·
text = text.replace(/(\/\/[^\n]*|\/\*[\s\S]*?\*\/|<!--[\s\S]*?-->)/g, (match) => {
  const placeholder = `%%COMMENT_${blockIndex}%%`;
  protectedBlocks.push({ index: blockIndex, content: match, type: 'COMMENT' });
  console.log(`ä¿è­·[${blockIndex}]: COMMENT â†’`, placeholder);
  blockIndex++;
  return placeholder;
});

// 8. é–¢æ•°å‘¼ã³å‡ºã—ä¿è­·ï¼ˆå³æ ¼åŒ–ï¼‰
text = text.replace(/(\w+\s*\([^)]*\))/g, (match) => {
  // NPR (National Public Radio) ã®ã‚ˆã†ãªç•¥èªèª¬æ˜ã‚’é™¤å¤–
  if (/^[A-Z]{2,}\s*\([^)]*\)$/.test(match)) {
    return match; // ä¿è­·ã—ãªã„
  }
  // ã‚«ãƒ³ãƒã‚„ã‚¹ãƒšãƒ¼ã‚¹ãŒå¤šã„èª¬æ˜æ–‡ã‚’é™¤å¤–
  if (/\([^)]*[,\s]{2,}[^)]*\)/.test(match)) {
    return match; // ä¿è­·ã—ãªã„
  }
  // æ—¥æœ¬èªã®èª¬æ˜æ–‡ã‚’é™¤å¤–
  if (/\([^)]*[\u3040-\u9FFF][^)]*\)/.test(match)) {
    return match;
  }
  
  const placeholder = `%%FUNCALL_${blockIndex}%%`;
  protectedBlocks.push({ index: blockIndex, content: match, type: 'FUNCALL' });
  console.log(`ä¿è­·[${blockIndex}]: FUNCALL "${match}" â†’`, placeholder);
  blockIndex++;
  return placeholder;
});

// 9. å¤‰æ•°å®£è¨€ä¿è­·
text = text.replace(/((?:let|const|var|message)\s+\w+\s*=\s*[^;\n]+[;\n]?)/g, (match) => {
  const placeholder = `%%VAR_${blockIndex}%%`;
  protectedBlocks.push({ index: blockIndex, content: match, type: 'VAR' });
  console.log(`ä¿è­·[${blockIndex}]: VAR â†’`, placeholder);
  blockIndex++;
  return placeholder;
});

// 10. ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰ä¿è­·
text = text.replace(/(`[^`\n]+`)/g, (match) => {
  const placeholder = `%%INLINE_${blockIndex}%%`;
  protectedBlocks.push({ index: blockIndex, content: match, type: 'INLINE' });
  console.log(`ä¿è­·[${blockIndex}]: INLINE â†’`, placeholder);
  blockIndex++;
  return placeholder;
});

console.log('ä¿è­·å®Œäº†ã€‚ç·ãƒ–ãƒ­ãƒƒã‚¯æ•°:', protectedBlocks.length);
console.log('ä¿è­·å¾Œãƒ†ã‚­ã‚¹ãƒˆ:', text.substring(0, 200) + '...');

return { text, protectedBlocks };
}

function restoreProtectedCode(text, protectedBlocks) {
 console.log('å¾©å…ƒé–‹å§‹ã€‚ãƒ–ãƒ­ãƒƒã‚¯æ•°:', protectedBlocks.length);
 console.log('å¾©å…ƒå‰ãƒ†ã‚­ã‚¹ãƒˆ:', text.substring(0, 200) + '...');

 // æ®‹å­˜ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒã‚§ãƒƒã‚¯
 const remainingPlaceholders = text.match(/%%[A-Z_0-9]+%%/g) || [];
 console.log('å¾©å…ƒå‰ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼:', remainingPlaceholders);

 // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®é™é †ã§ã‚½ãƒ¼ãƒˆã—ã¦å¾©å…ƒï¼ˆå¾Œã‹ã‚‰ä¿è­·ã—ãŸã‚‚ã®ã‹ã‚‰å…ˆã«å¾©å…ƒï¼‰
 const sortedBlocks = [...protectedBlocks].sort((a, b) => b.index - a.index);

 sortedBlocks.forEach((block, arrayIndex) => {
   const placeholder = `%%${block.type}_${block.index}%%`;
   
   if (block.type === 'CSSBLOCK' || block.type === 'CSS') {
     console.log(`CSSå¾©å…ƒ: "${placeholder}" â†’ "${block.content.replace(/\n/g, '\\n')}"`);
   } else {
     console.log(`å¾©å…ƒè©¦è¡Œ[${arrayIndex}]: "${placeholder}" â†’ "${block.content.substring(0, 50)}..."`);
   }
   
   // ç½®æ›å‰ã®å‡ºç¾å›æ•°ã‚’ãƒã‚§ãƒƒã‚¯
   const beforeCount = (text.split(placeholder)).length - 1;
   console.log(`ç½®æ›å‰: "${placeholder}" ãŒ ${beforeCount}å€‹å­˜åœ¨`);
   
   if (beforeCount > 0) {
     // æ­£è¦è¡¨ç¾ã§ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¦ç½®æ›
     const escapedPlaceholder = placeholder.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
     text = text.replace(new RegExp(escapedPlaceholder, 'g'), block.content);
     
     const afterCount = (text.split(placeholder)).length - 1;
     console.log(`ç½®æ›æˆåŠŸ: ${beforeCount}å€‹ â†’ ${afterCount}å€‹`);
   } else {
     console.log(`ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼è¦‹ã¤ã‹ã‚‰ãš: "${placeholder}"`);
   }
 });

 // å¾©å…ƒå¾Œã®æœ€çµ‚ãƒã‚§ãƒƒã‚¯
 const finalPlaceholders = text.match(/%%[A-Z_0-9]+%%/g) || [];
 if (finalPlaceholders.length > 0) {
   console.error('å¾©å…ƒå¤±æ•—ï¼æ®‹å­˜ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼:', finalPlaceholders);
   
   // å¼·åˆ¶å¾©å…ƒã‚’è©¦è¡Œ
   finalPlaceholders.forEach(ph => {
     console.log(`å¼·åˆ¶å¾©å…ƒè©¦è¡Œ: ${ph}`);
     const found = protectedBlocks.find(block => `%%${block.type}_${block.index}%%` === ph);
     if (found) {
       console.log(`å¼·åˆ¶å¾©å…ƒå®Ÿè¡Œ: ${ph} â†’ "${found.content.substring(0, 30)}..."`);
       const escaped = ph.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
       text = text.replace(new RegExp(escaped, 'g'), found.content);
     } else {
       console.error(`å®Œå…¨è¿·å­: ${ph}`);
     }
   });
 } else {
   console.log('å¾©å…ƒå®Œäº†ï¼ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãªã—');
 }

 console.log('å¾©å…ƒå¾Œãƒ†ã‚­ã‚¹ãƒˆ:', text.substring(0, 200) + '...');
 return text;
}

function autoFormatText() {
  isAutoFormatting = true;
  try {
    const inputField = getElementById("input");
    const outputField = getElementById("output");
    if (!inputField || !outputField) {
      isAutoFormatting = false;
      return;
    }
    if (!inputField.value.trim()) {
      outputField.value = "";
      updateCharCount();
      return;
    }
    saveBeforeFix();
    let output = inputField.value;


  const screamPatterns = [];
  output = output.replace(/ï¼¼[^ï¼¼ï¼\n]*?ï¼/g, (match) => {
    const placeholder = `%%SCREAM_${screamPatterns.length}%%`;
    screamPatterns.push(match);
    return placeholder;
  });
    
    // å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹å‰Šé™¤ã‚’æœ€åˆã«å®Ÿè¡Œ
    output = output.replace(/ã€€/g, "");
    
    // ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è¨˜å·å‰Šé™¤ã‚’æœ€å„ªå…ˆã§å®Ÿè¡Œï¼ˆã‚³ãƒ¼ãƒ‰ä¿è­·å‰ï¼‰
    // æ®µéšçš„ã«å¤ªå­—ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚’å‰Šé™¤ï¼ˆã‚ˆã‚Šç¢ºå®Ÿã«ï¼‰
    output = output
      .replace(/\*\*([^*\n]*?ï¼š[^*\n]*?)\*\*/g, "$1")
      .replace(/\*\*([^*\n]*?ï¼š)\*\*/g, "$1")
      .replace(/\*\*([^*\n]+?)\*\*/g, "$1")
      .replace(/\*\*([^*]+?)\*\*/g, "$1")
      .replace(/(Phase|Chapter|Section|Part|Step)[ \u00A0\u2000-\u200B\u202F\u205F\u3000]+(\d)/gi, "$1$2")
      .replace(/^>\s*/gm, "") // å¼•ç”¨å‰Šé™¤
      .replace(/^[-ãƒ¼]{3,}$/gm, "") // ç½«ç·šå‰Šé™¤
      .replace(/```\s*/g, "") // ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯è¨˜å·å‰Šé™¤
      .replace(/^[-*]\s+/gm, "") // ãƒªã‚¹ãƒˆè¨˜å·å‰Šé™¤
      .replace(/^(\d+)\.\s+/gm, "$1.")
      .replace(/^(\d+)\s+/gm, "$1") // æ•°å­—å¾Œã®ä½™åˆ†ãªã‚¹ãƒšãƒ¼ã‚¹å‰Šé™¤
      .replace(/^ç·¨é›†\s*$/gm, "") // ã€Œç·¨é›†ã€è¡Œå‰Šé™¤
      .replace(/(\r?\n){2,}/g, "\n") // æ”¹è¡Œè©°ã‚
      .replace(/^([âœ“âœ—â˜‘âœ”ï¸âœ˜âŒ])\s+/gm, "$1");
    
    // æ–‡ç« åˆ¤å®šï¼šæ—¥æœ¬èªãŒå¤šã„å ´åˆã¯ã‚³ãƒ¼ãƒ‰ä¿è­·ã‚’ç·©ãã™ã‚‹
    const japaneseCount = (output.match(/[\u3040-\u9FFF]/g) || []).length;
    const totalLength = output.replace(/\s/g, '').length;
    const isLikelyJapaneseText = japaneseCount / totalLength > 0.4; // 40%ä»¥ä¸Šæ—¥æœ¬èª
    
    // ã‚³ãƒ¼ãƒ‰ä¿è­·ã‚’å®Ÿè¡Œï¼ˆãŸã ã—æ—¥æœ¬èªæ–‡ç« ã®å ´åˆã¯åˆ¶é™ä»˜ãï¼‰
    let protectedBlocks = [];
    if (!isLikelyJapaneseText) {
      // é€šå¸¸ã®ã‚³ãƒ¼ãƒ‰ä¿è­·
      const { text: protectedText, protectedBlocks: blocks } = protectCodeInText(output);
      output = protectedText;
      protectedBlocks = blocks;
    } else {
      // æ—¥æœ¬èªæ–‡ç« ã®å ´åˆï¼šä¸‰é‡ãƒãƒƒã‚¯ã‚¯ã‚©ãƒ¼ãƒˆã®ã¿ä¿è­·
      output = output.replace(/(```[\s\S]*?```)/g, (match) => {
        const placeholder = `%%CODEBLOCK_${protectedBlocks.length}%%`;
        protectedBlocks.push({ index: protectedBlocks.length, content: match, type: 'CODEBLOCK' });
        return placeholder;
      });
    }
    
    // å®‰å…¨ãªã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°å‡¦ç†
    output = output
      .replace(/<br\s*\/?>/gi, "")
      .replace(/([\u3040-\u30FF\u4E00-\u9FFF])\s+(in|of|on|to|by|at)\s+([\u3040-\u30FF\u4E00-\u9FFF])/gi, "$1$2$3")
      .replace(/([\u3040-\u30FF\u4E00-\u9FFF])\s+(in|of|on|to|by|at)\s+([\dä¸€-é¾¯]{1,6}å¹´?)/gi, "$1$2$3")
      .replace(/\[æ³¨\s*\d+\]/g, "")
      .replace(/ï¼ˆ/g, "(")
      .replace(/ï¼‰/g, ")")
      .replace(/ï¼š/g, ":")
      .replace(/[ï¼Š*]+/g, "")
      .replace(/[ï¼ˆ(]ç¬‘[)ï¼‰]/g, "")
      .replace(/[\\]+/g, "")
      .replace(/\[\d+\]/g, "")
      .replace(/\uFE0F/g, '')
      .replace(/([\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)([\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF])/g, "$1$3")
      .replace(/([ã€Œã€].*?)ã€‚([ã€ã€])/g, "$1$2")
      .trim();

    // ç©ºç™½å‡¦ç†ï¼ˆå¸¸ã«å®Ÿè¡Œï¼‰
    output = output
      .replace(/:\s+([a-zA-Z])/g, ":$1")
      .replace(/(\r?\n){2,}/g, "$1")
      .replace(/^\s+/gm, "")
      .replace(/\s+$/gm, "");



  output = output.replace(/[âœ…âœ”â­•]/g, "â—‹");
  output = output.replace(/[âœ—âŒââœ–ï¸]/g, "Ã—");

    // çµµæ–‡å­—å‡¦ç†ã‚„ãã®ä»–ã®å‡¦ç†ã¯æ—¢å­˜é€šã‚Š
  output = output.replace(/\p{Emoji}[\u200D\uFE0F]*/gu, (match) => {
  // å˜ä½“ã®â™‚â™€è¨˜å·ã¯ä¿è­·
  if (match === 'â™‚' || match === 'â™€') return match;
  // ãã®ä»–ã®ä¿è­·å¯¾è±¡
  const keep = new Set(['â™¥', 'Â©', 'Â®', 'â˜‘', 'â„¢', '#']);
  if (keep.has(match)) return match;
  // æ•°å­—çµµæ–‡å­—ã¯ä¿è­·
  if (/^[0-9]$/.test(match) || /^[ï¼-ï¼™]$/.test(match)) return match;
  return '';
});


  output = output.replace(/^â™‚([ \u00A0\u2000-\u200B\u202F\u205F\u3000]*)/gm, "");


output = output
      .replace(/^\s*$/gm, "")
      .replace(/(\r?\n){2,}/g, "\n")
      .replace(/\n\s*\n/g, "\n");


  output = output.replace(/[\s\u3000]+([!ï¼?ï¼Ÿ])/g, '$1');
  output = output.replace(/\s+([!?])/g, '$1');
  output = output.replace(/([!?])([ \t\u00A0\u3000]+)/g, '$1');
  output = output.replace(/([!?ã€‚ã€])([ \t\u00A0\u3000]+)(#)/g, '$1$3');
  output = output.replace(/[ \t]+(?=#\w+)/g, '');

  output = output.replace(/\s+(#[\p{Script=Hiragana}\p{Script=Katakana}\p{Script=Han}\w]+)/gu, '$1');


  output = output
  .split("\n")
  .map(line => {
    const isTableRow = (line.match(/\|/g) || []).length >= 2;
    if (isTableRow) {
      return line
        .replace(/ âœ•/g, " âœ•")
        .replace(/âœ•(?=\()/g, "âœ• ");
    } else {
      return line
        .replace(/[ \t\u3000]+âœ•/g, "âœ•")
        .replace(/[ ã€€]+â—‹/g, "â—‹")
        .replace(/â—‹[ ã€€]+/g, "â—‹")
        .replace(/([!ï¼?ï¼Ÿ])[ \t\u3000]+/g, "$1")
        .replace(/([ï¼Ÿ?])[ \t]+(?=\S)/g, "$1")
        .replace(/([â°Â¹Â²Â³â´âµâ¶â·â¸â¹â°])[ \t\u00A0\u3000\u2000-\u200B]+(?=[a-zA-Z0-9])/g, "$1")
        .replace(/ï¼[ \u3000]+/g, "ï¼");
    }
  })
  .join("\n");


  let lines = output.split('\n');
  lines = lines.map(line => {
    if ((line.match(/\|/g) || []).length >= 2) return line;
    return line
    .replace(/([â—â–²â– â˜…])[\u3000 \t]+/g, "$1")
    .replace(/[ \u00A0\u2000-\u200D\u202F\u205F\u3000\uFE0F\uFEFF]*([â˜…â˜†â—†âœ¦â–¶â–¸â™ â™£â™¥â™¦â†’â†â†‘â†“â– â—â—â—‡])[ \u00A0\u2000-\u200D\u202F\u205F\u3000\uFE0F\uFEFF]*/g, "$1")
    .replace(/([ \u00A0\u2000-\u200B\u202F\u205F\u3000]*)([\u2013\u2014\u2212\u2015\u002D])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]*)/g, "$2")
    .replace(/([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)([+\-Ã—Ã·\/=])/g, "$2")
    .replace(/(\d)[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*([+\-Ã—Ã·\/=])[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*(\d)/g, "$1$2$3")
    .replace(/([+\-Ã—Ã·\/=])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)/g, "$1");
});
output = lines.join('\n');


for (let i = 0; i < screamPatterns.length; i++) {
  screamPatterns[i] = screamPatterns[i].replace(/\p{Emoji}[\u200D\uFE0F]*/gu, '');
}
screamPatterns.forEach((pattern, i) => {
  const placeholder = `%%SCREAM_${i}%%`;
  output = output.replace(new RegExp(placeholder, 'g'), pattern);
});

// å«ã³å¾©å…ƒå¾Œã€å«ã³ä»¥å¤–ã®å…¨è§’ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚’åŠè§’ã«å¤‰æ›
output = output.replace(/ï¼/g, "/");





  output = output.replace(/^#{1,6}\s+/gm, ""); // è¦‹å‡ºã—å‰Šé™¤
  output = output.replace(/([ã‚¡-ãƒ¶ãƒ¼])[ ]+([A-Za-z])/g, '$1$2');
 output = output.replace(/([â†‘â†’â†“â†â—†â—â˜†â€»ï¼Š])[\u00A0\u2000-\u200B\u202F\u205F\u3000]+/g, "$1");
  output = output.replace(/\u2019/g, "%%APOSTROPHE%%");
  output = output.replace(/([a-zA-Z])\u3000+([a-zA-Z])/g, "$1 $2");
  output = output.replace(/%%APOSTROPHE%%/g, "\u2019");
  output = output.replace(/([ã-ã‚“ã‚¡-ãƒ³ä¸€-é¾¯])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)([a-zA-Z])(?=[^a-zA-Z])/g, "$1$3");
  output = output.replace(/\)([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)(?=[\u3040-\u30FF\u4E00-\u9FFFã€ã€‚ï¼ï¼Ÿ])/g, ")");
  output = output.replace(/([,ã€ï¼Œ])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)/g, "$1");
  output = output.replace(/(\d+(?:\.\d+)?Ã—10[âˆ’\-]?\d+)([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)([a-zA-Z]+)/g, "$1$3");
  output = output.replace(/(\d(?:\.\d+)?Ã—10[âˆ’\-]?\d+)([ \u00A0\u2000-\u200B\u202F\u2060\u3000]+)(?=[\u3040-\u9FFF])/g, "$1");
  output = output.replace(/([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)(ãªã©|ç­‰|ã‹ã‚‰|ã¾ã§|ã«ã¤ã„ã¦|ã«é–¢ã—ã¦|ã«ã‚ˆã‚‹|ã¨ã—ã¦)/g, "$2");
  output = output.replace(/([^\n\r])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)([â†’ï¼=])/g, "$1$3");
  output = output.replace(/([â†’ï¼=])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)([^\n\r])/g, "$1$3");
  output = output.replace(/\.([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)/g, ".");
  output = output.replace(/([\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)(\d)/g, "$1$3");
  output = output.replace(/(\d)([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)([\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF])/g, "$1$3");
  output = output.replace(/[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*:[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*/g, ":");
  output = output.replace(/,([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)/g, ",");
  output = output.replace(/([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)(ãªã©|ç­‰)/g, "$2");
  output = output.replace(/^([â‘ -â‘©])\s+([^\s])/gm, "$1$2");
  output = output.replace(/[ ã€€]*(ã¾ãŸã¯)[ ã€€]*/g, "$1");
  output = output.replace(/(ä¾‹:)[ ã€€]+/g, "$1");
  output = output.replace(/\b([a-zA-Z])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)([ã-ã‚“ã‚¡-ãƒ³ä¸€-é¾¯])/g, "$1$3");
  output = output.replace(/(\d)[ \u00A0\u2000-\u200B\u202F\u205F\u3000]+(ppb)/g, "$1$2");
  output = output.replace(/([ã€ï¼Œ])\u0020/g, "$1");
  output = output.replace(/(\d+(?:\.\d+)?)([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)([a-zA-ZÎ©Â°%]+)/g, "$1$3");
  output = output.replace(/([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)(\.{3}|â€¦)([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)/g, "$2");
  output = output.replace(/(\d+(?:\.\d+)?)([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)(m-1|s-1|kg-1)/g, "$1$3");
  output = output.replace(/(\d+(?:\.\d+)?)[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*Ã—[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*10[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*([âˆ’\-]?\d+)/g, "$1Ã—10$2");
  output = output.replace(/([0-9a-zA-Z\u3040-\u30FF\u4E00-\u9FFF])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]*)([â‰¦â‰§<>â‰¤â‰¥])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]*)/g, "$1$3");
  output = output.replace(/([^\s])[\u0020\u00A0\u2000-\u200B\u202F\u205F\u3000]*\/[\u0020\u00A0\u2000-\u200B\u202F\u205F\u3000]*([^\s])/g, "$1/$2");
  output = output.replace(/([\u3040-\u30FF\u4E00-\u9FFFa-zA-Z0-9])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]*)[-âˆ’]([ \u00A0\u2000-\u200B\u202F\u205F\u3000]*)([\u3040-\u30FF\u4E00-\u9FFFa-zA-Z0-9])/g, "$1-$4");
  output = output.replace(/ï¼ˆ([^ï¼‰]+)ï¼‰([ \u00A0\u2000-\u200B\u202F\u205F\u3000]*)[-âˆ’]([ \u00A0\u2000-\u200B\u202F\u205F\u3000]*)/g, "ï¼ˆ$1ï¼‰-");
  output = output.replace(/([=â‰ <>])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)([+\-]?\d+(?:\.\d+)?)/g, "$1$3");
  output = output.replace(/(\d)[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*([+\-Ã—\/])[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*(\d)/g, "$1$2$3");
  output = output.replace(/\[(ã„ã¤\?|ä¸æ˜|unknown|when\?)\]/gi, "");
  output = output.replace(/\[?(æ³¨é‡ˆ|è¨»é‡ˆ|æ³¨|è¨»)\d+\]?/g, "");
  output = output.replace(/([ï¼ˆ(])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)/g, "$1");
  output = output.replace(/([a-zA-Z])[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*[Ã—xï¼Š][ \u00A0\u2000-\u200B\u202F\u205F\u3000]*10[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*([a-zA-Z])/g, "$1Ã—10$2");
  output = output.replace(/([ \u00A0\u2000-\u200B\u202F\u205F\u3000]*)=([ \u00A0\u2000-\u200B\u202F\u205F\u3000]*)/g, "=$2");
  output = output.replace(/(\d)([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)(\d)/g, "$1$3");
  output = output.replace(/([ã-ã‚“ã‚¡-ãƒ³ä¸€-é¾¯])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)([a-zA-Z])/g, "$1$3");
  output = output.replace(/([a-zA-Z])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)([ã-ã‚“ã‚¡-ãƒ³ä¸€-é¾¯])/g, "$1$3");
  output = output.replace(/([^\n\r])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)([ï¼‰\)])/g, "$1$3");
  output = output.replace(/(JIS|ISO|RFC|IEEE)[ \u00A0\u2000-\u200B\u202F\u205F\u3000]+([A-Z])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)(\d)/g, "$1$2$4");
  output = output.replace(/ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’è¡¨ç¤º/g, "");
  output = output.replace(/\[ç–‘å•ç‚¹[\u00A0\u2000-\u200B\u202F\u205F\u3000]*[-â€“][\u00A0\u2000-\u200B\u202F\u205F\u3000]*ãƒãƒ¼ãƒˆ\]/g, "");
  output = output.replace(/^\s*ç·¨é›†\s*$/gm, "");
  output = output.replace(/ (`[^`]+`) /g, "$1");
  output = output.replace(/^\s*[-â€“â€”âˆ’â€’]\s*/gm, "");
  output = output.replace(/\s+(`[^`]+`)\s+/g, " $1 ");
  output = output.replace(/([^\s])[\u3000\s]+â€œ/g, "$1â€œ");
  output = output.replace(/\u200B+/g, "");
  output = output.replace(/^(?![ \t]{4,})[ \tã€€\u00A0\u2000-\u200B\u202F\u205F\u3000]+/gm, "");
  output = output.replace(/[ \tã€€\u00A0\u2000-\u200B\u202F\u205F\u3000]+$/gm, "");
  output = output.replace(/(?<=\S)[ \t\u00A0\u2000-\u200B\u202F\u205F\u3000]{2,}(?=\S)/g, " ");
  output = output.replace(
  /([ \u00A0\u2000-\u200B\u202F\u205F\u3000]*)(?=\n|$)/g,
  "");
  output = output.replace(
  /(^|\n)[ \u00A0\u2000-\u200B\u202F\u205F\u3000]+/g,
  "$1");
  output = output.replace(/[ \u3000]*â†[ \u3000]*/g, "â†");
  output = output.replace(/[\\]+/g, "");
  output = output.replace(/([ã-ã‚“ã‚¡-ãƒ³ä¸€-é¾¯])[ ]+(?=\n)/g, "$1");
  output = output.replace(/(["ã€Œï¼ˆï¼»ã€])[\t ]+/g, "$1");
  output = output.replace(/([?!])[\t ]+(?=\S)/g, "$1");
  output = output.replace(/[\u0020\u00A0\u2000-\u200F\u202F\u205F\u3000\uFE0F\uFEFF\u2028\u2029]+\./g, ".");
  output = output.replace(/\.[\u0020\u00A0\u2000-\u200F\u202F\u205F\u3000\uFE0F\uFEFF\u2028\u2029]+/g, ".");
  output = output.replace(/ã€€+\./g, ".");
  output = output.replace(/\.ã€€+/g, ".");
  output = output.replace(/ +\./g, ".");
  output = output.replace(/\. +/g, ".");
  output = output.replace(/[ \u00A0\u2000-\u200B\u202F\u205F\u3000]+&/g, "&");
  output = output.replace(/^â˜[ \u3000]*/gm, "");
  output = output.replace(/([\u3000-\u9FFF])\s*âˆš/g, "$1âˆš");
  output = output.replace(/â¤/g, "");
  output = output.replace(/\u25C9/g, "");
  output = output.replace(/([^\s])[\u0020\u00A0\u2000-\u200D\u3000]*\"/g, '$1"');
  output = output.replace(/(\d+(?:\.\d+)?)[ \u3000\u00A0\u2000-\u200B\u202F\u205F]*([mgsHzVWAÎ©KJmol%Â°Î¼ncdMm]+)/g, "$1$2");
  output = output.replace(/;[ ]+/g, ";");
  output = output.replace(/([0-9])\âƒ£/g, "$1.")
  output = output.replace(/([â‘ -â‘©])/g, (match) => {
    const nums = ['â‘ ','â‘¡','â‘¢','â‘£','â‘¤','â‘¥','â‘¦','â‘§','â‘¨','â‘©'];
    const index = nums.indexOf(match);
    return index !== -1 ? `${index + 1}.` : match;
  })
  output = output.replace(/^(\d+\.)([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)/gm, "$1");
  output = output.replace(/([=â‰ <>â‰¤â‰¥â‰¦â‰§])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]*)/g, "$1");
  output = output.replace(/([ \u00A0\u2000-\u200B\u202F\u205F\u3000]*)([=â‰ <>â‰¤â‰¥â‰¦â‰§])/g, "$2");
  output = output.replace(/â‡’([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)/g, "â‡’");
  output = output.replace(/âœ¦/g, "");
  output = output.replace(/â–’([ \u00A0\u2000-\u200B\u202F\u205F\u3000]*)/g, "");
  output = output.replace(/\[è¦å‡ºå…¸\]/g, '');
  output = output.replace(/\([^\)]*?èªç‰ˆ\)/g, "");
  output = output.replace(/ï¼ˆ[^ï¼‰]*?èªç‰ˆï¼‰/g, "");
  output = output.replace(/&[ \t]+/g, "&");
  output = output.replace(/](?: |\u3000)+/g, "]");
  output = output
  .replace(/â¶[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*/g, "1.")
  .replace(/â·[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*/g, "2.")
  .replace(/â¸[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*/g, "3.")
  .replace(/â¹[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*/g, "4.")
  .replace(/âº[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*/g, "5.")
  .replace(/â»[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*/g, "6.")
  .replace(/â¼[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*/g, "7.")
  .replace(/â½[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*/g, "8.")
  .replace(/â¾[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*/g, "9.")
  .replace(/â¿[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*/g, "10.");
  output = output.replace(/Â²[ \t\u00A0\u3000\u2000-\u200B]+(?=[a-zA-Z])/g, "Â²");
 output = output.replace(/[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*â‡”[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*/g, "â‡”");
  output = output.replace(/[ \t\u3000]*â‰’[ \t\u3000]*/g, "â‰’");
  output = output.replace(/ï¼‹[ ã€€]+/g, "ï¼‹");
  output = output.replace(/([ï¼‰\)])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)(?=\|)/g, "$1 ");
  output = output.replace(/([ï¼‰\)])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)(?=[^\n\r\|])/g, "$1");
  output = output.replace(/[ \t\u3000]+([âœ“âœ—âœ”ï¸âŒ])/g, "$1");
  output = output.replace(/([A-Za-z])[ ]+(\d+)/g, "$1$2");
  output = output.replace(
  /(?<=\d)[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*([+\-Ã—*/])[ \u00A0\u2000-\u200B\u202F\u205F\u3000]*(?=\d)/g,
  "$1"
);
  output = output.replace(/(\|\s*)Â±/g, (_, p1) => `${p1.trimEnd()} Â±`);
  output = output.replace(/\s*([<>ï¼ï¼œâ‰§â‰¦â‰¥â‰¤])\s*/g, "$1");
  output = output.replace(/([â–¡â˜‘â˜âœ“âœ”ï¸ââ– ])[ \u3000]+/g, "$1");
  output = output.replace(/^#+[ \t]*/gm, "");
  output = output.replace(/([^\s])([ \u00A0\u2000-\u200B\u202F\u205F\u3000]+)([ï¼ˆ(])/g, "$1 $3");
  output = output.replace(/(?<=\s|^)([=Ã—ã€])(?=\s|$)/g, "$1");
 output = output.replace(/^([ãƒ»â†’â†“â˜…â˜†â€»â—â—‹â—â– â–¡â—†â—‡â–²â–¼â–¶â—€â¤â£â–âœ¿â˜‘ï¸âœ”ï¸âœ—âœ˜])[\t\u00A0 ]+/gm, "$1");
  output = output.replace(/(\)|ï¼‰)(?=\|)/g, "$1");
  output = output.replace(/\|([â€œâ€"'])/g, "| $1");
  output = output.replace(/ ?\+ ?/g, "+");
  output = output.replace(/\[\s*\d+\s*\]/g, "");
  output = output.replace(/^\s*å¤‰æ›´ã™ã‚‹\s*\n?/gm, "");
  output = output.replace(/ã€‚[\u0020\u3000]+/g, "ã€‚");
  output = output.replace(/\[\s*N\d+\s*\]/g, "");


  output = output.trim();
    
    // æœ€å¾Œã«ã‚³ãƒ¼ãƒ‰ã‚’å¾©å…ƒï¼ˆæ—¥æœ¬èªæ–‡ç« ã®å ´åˆã‚‚å«ã‚€ï¼‰
    if (protectedBlocks.length > 0) {
      output = restoreProtectedCode(output, protectedBlocks);
    }

    outputField.value = output;
    updateCharCount();

    if (document.body.classList.contains("theme-scherite")) {
      const effect = getElementById("commandEffect");
      if (effect) {
        document.body.classList.add("flash");
        effect.innerText = "â™›ç‹å‘½ã€ç™ºå‹•â™›";
        effect.style.opacity = 1;
        
        setTimeout(() => {
          document.body.classList.remove("flash");
          effect.style.opacity = 0;
        }, 800);
      }
    }
    
  } catch (error) {
    console.error("Auto-format error:", error);
  } finally {
    isAutoFormatting = false;
  }
}

function formatText() {
autoFormatText();
}

function copyText() {
  const text = getElementById("output");
  const copied = getElementById("copied");

  if (!text || !copied) return;

  const outputValue = text.value.trim();
  const placeholderValue = text.placeholder.trim();

  if (ZAKRAN_WELCOME_LINES.includes(outputValue) || ZAKRAN_WELCOME_LINES.includes(placeholderValue)) {
    copied.innerText = "ï¼ˆå¹»è¦šã¯ã‚³ãƒ”ãƒ¼ä¸å¯ï¼‰";
    copied.style.color = "#999";
    copied.style.display = "block";
    setTimeout(() => {
      copied.style.display = "none";
    }, 1000);
    return;
  }

navigator.clipboard.writeText(text.value).then(() => {
  if (document.body.classList.contains("theme-scherite")) {
    copied.innerText = "â™”è¤‡è£½å®Œäº†â™”";
    copied.style.color = "#cc0000";
  } else {
    copied.innerText = "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼";
    copied.style.color = "#6bb6ff";
  }
  copied.style.display = "block";
  setTimeout(() => {
    copied.style.display = "none";
  }, 1000);
});
}

function clearText() {
const inputField = getElementById("input");
const outputField = getElementById("output");
const copiedEl = getElementById("copied");

if (inputField) inputField.value = "";
if (outputField) outputField.value = "";
if (copiedEl) copiedEl.style.display = "none";

if (outputField) {
  if (document.body.classList.contains("theme-scherite")) {
    outputField.placeholder = "ä¿®æ­£çµæœã‚’ã“ã“ã§ç¢ºèªã›ã‚ˆ";
  } else {
    outputField.placeholder = "ä¿®æ­£çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼";
  }
}

updateCharCount();
}

function updateCharCount() {
const inputField = getElementById("input");
const outputField = getElementById("output");

if (!inputField || !outputField) return;

const inputText = inputField.value;
const outputText = outputField.value;

let actualOutputLength = outputText.length;
if (ZAKRAN_WELCOME_LINES.includes(outputText.trim())) {
  actualOutputLength = 0;
}

updateElement("inputCount", "innerText", inputText.length);
updateElement("outputCount", "innerText", actualOutputLength);
updateInfoBoxStyle();
}

// ========== ãƒšãƒ¼ã‚¹ãƒˆæ©Ÿèƒ½ ==========
function pasteText() {
navigator.clipboard.readText().then(text => {
  const input = getElementById("input");
  if (input) {
    input.value = text;
    formatText();
    setTimeout(triggerCheck, 100);
  }
}).catch(err => {
  console.error("Paste failed:", err);
  if (document.body.classList.contains("theme-scherite")) {
    alert("å‘½ä»¤é•åâ—†è¨˜æ†¶é ˜åŸŸã¸ã®æ¥ç¶šãŒæ‹’çµ¶ã•ã‚ŒãŸã€‚\nç†ç”±ï¼šå¤–éƒ¨è¨˜éŒ²åŸŸã‹ã‚‰ã®æƒ…å ±èª­å–ä¸è¨±å¯ã€‚\nâ”€â”€å†è©¦è¡Œã›ã‚ˆã€ãƒ’ãƒãƒã‚®");
  } else {
    alert("ã†ã…â€¦â€¦ãƒšãƒ¼ã‚¹ãƒˆã§ããªã‹ã£ãŸã¿ãŸã„â€¦â€¦\nï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã•ã‚“ãŒè¨±ã—ã¦ãã‚Œãªã‹ã£ãŸã‚“ã ï¼‰");
  }
});
}

// ========== Undoæ©Ÿèƒ½ ==========
function undoInput() {
const isScherite = document.body.classList.contains("theme-scherite");

if (previousInput !== "" && previousInput !== undefined) {
  const inputField = getElementById("input");
  if (inputField) {
    inputField.value = previousInput;
    updateCharCount();
  }
  
  if (isScherite) {
    showScheriteCustomAlert("âŸ²ç‹å‘½é€†è¡ŒâŸ²ï¼šå…¥åŠ›çŠ¶æ…‹ã‚’å‰å›è¨˜éŒ²ç‚¹ã¾ã§å¾©å…ƒã—ãŸã€‚\nâ”€â”€å‘½ä»¤å±¥è¡Œã€å®Œäº†");
  } else {
    showZakranCustomAlert("â‡„æˆ»ã—ãŸã‚ˆãƒ¼ï¼\nãƒ’ãƒãƒã‚®ã®å…¥åŠ›ã€å…ƒã«æˆ»ã—ãŸã‹ã‚‰ã­ã£â™ª");
  }
} else {
  if (isScherite) {
    showScheriteFailEffect();
    setTimeout(() => {
      showScheriteUndoFailPopup("è­¦å‘Šâ—†å¾©å…ƒå¯¾è±¡ãŒå­˜åœ¨ã—ãªã„ã€‚\nç†ç”±ï¼šäº‹å‰è¨˜éŒ²ãŒæ¤œå‡ºã•ã‚Œãšã€‚\nâ”€â”€å‘½ä»¤ç„¡åŠ¹ã€å†è©¦è¡Œã›ã‚ˆ");
    }, 400);
  } else {
    const randomMessage = getLine(ZAKRAN_UNDO_FAIL_MESSAGES);
    showZakranCustomAlert(randomMessage);
  }
}
}

// ã‚·ã‚§ãƒ©ã‚¤ãƒˆ1æ®µéšç›®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
function showScheriteFailEffect() {
  const effect = document.createElement("div");
  effect.innerText = "âš å±¥æ­´æ¤œç´¢ï¼šå¤±æ•—âš ";
  Object.assign(effect.style, {
    position: "fixed",
    top: "30%",
    left: "50%",
    transform: "translateX(-50%)",
    background: "#1a0000",
    color: "#cc0000",
    padding: "8px 16px",
    border: "2px solid #cc0000",
    borderRadius: "6px",
    fontFamily: "'Times New Roman', serif",
    fontSize: "14px",
    fontWeight: "bold",
    zIndex: 9999,
    opacity: 1,
    transition: "opacity 1s ease"
  });

  document.body.appendChild(effect);

  setTimeout(() => {
    effect.style.opacity = 0;
    setTimeout(() => effect.remove(), 1000);
  }, 1500);
}

// ã‚·ã‚§ãƒ©ã‚¤ãƒˆ2æ®µéšç›®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
function showScheriteUndoFailPopup(message) {
  const popup = document.createElement("div");
  popup.innerHTML = `
  <div style="
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #1a0000;
    border: 2px solid #cc0000;
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 0 16px rgba(204, 0, 0, 0.3);
    text-align: center;
    width: 280px;
    font-family: 'Times New Roman', serif;
    z-index: 10000;
  ">
    <p style="color:#cc0000; font-weight:bold; font-size:15px; white-space:pre-line; margin-bottom: 16px;">
      ${message}
    </p>
    <button onclick="this.parentNode.parentNode.remove()" style="
      margin-top: 12px;
      padding: 6px 16px;
      background: transparent;
      color: #cc0000;
      border: 1px solid #cc0000;
      border-radius: 6px;
      font-weight: bold;
      font-family: 'Times New Roman', serif;
      cursor: pointer;
    ">äº†è§£ã€é™›ä¸‹â€¦</button>
  </div>
  `;
  document.body.appendChild(popup);
}

// ã‚¶ã‚¯ãƒ©ãƒ³ç”¨ã‚«ã‚¹ã‚¿ãƒ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
function showZakranCustomAlert(message) {
 const popup = document.createElement("div");
 popup.innerHTML = `
   <div style="
     position: fixed;
     top: 50%;
     left: 50%;
     transform: translate(-50%, -50%);
     background: #ffffff;
     border: 2px solid #6bb6ff;
     border-radius: 12px;
     padding: 24px;
     box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
     text-align: center;
     width: 260px;
     font-family: 'Hiragino Mincho ProN', 'Yu Mincho', serif;
     z-index: 10000;
   ">
     <p style="
       color: #6bb6ff; 
       font-weight: bold; 
       font-size: 16px; 
       white-space: pre-line;
       margin-bottom: 16px;
       line-height: 1.4;
     ">${message}</p>
     <button onclick="this.parentNode.parentNode.remove()" style="
       margin-top: 12px;
       padding: 6px 14px;
       border-radius: 8px;
       border: 1px solid #6bb6ff;
       background: #fff;
       color: #6bb6ff;
       font-weight: bold;
       cursor: pointer;
       font-size: 14px;
     ">ã†ã‚“â€¦</button>
   </div>
 `;
 document.body.appendChild(popup);
}

// ã‚·ã‚§ãƒ©ã‚¤ãƒˆæˆåŠŸæ™‚ç”¨ã‚«ã‚¹ã‚¿ãƒ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
function showScheriteCustomAlert(message) {
  const popup = document.createElement("div");
  popup.innerHTML = `
    <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                 background: #1a0000; border: 2px solid #cc0000; border-radius: 12px;
                 padding: 20px; box-shadow: 0 0 16px rgba(204, 0, 0, 0.5);
                 z-index: 10000; text-align: center; max-width: 320px;">
      <p style="color: #cc0000; font-size: 14px; margin-bottom: 16px; white-space: pre-line; 
                 font-family: 'Times New Roman', serif;">${message}</p>
      <button onclick="this.parentNode.parentNode.remove()" style="
        padding: 6px 14px; border-radius: 6px; border: 1px solid #cc0000;
        background: #111; color: #cc0000; font-weight: bold; cursor: pointer;
        font-family: 'Times New Roman', serif;">äº†è§£ã€é™›ä¸‹â€¦</button>
    </div>
  `;
  document.body.appendChild(popup);
}

// ========== è»¢å†™BOXæ©Ÿèƒ½ ==========
// openTransferBoxé–¢æ•°ã‚’ä¿®æ­£
function openTransferBox() {
  const isScherite = document.body.classList.contains("theme-scherite");
  
  // ã¾ãšã€ä¸¡æ–¹ã®è»¢å†™BOXã‚’é–‰ã˜ã‚‹
  const zakranBox = document.getElementById("transferBoxZakran");
  const scheriteBox = document.getElementById("transferBoxScherite");
  
  if (zakranBox) {
    zakranBox.style.display = "none";
  }
  if (scheriteBox) {
    scheriteBox.style.display = "none";
  }
  
  // æ‹¡å¤§çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
  if (isOutputFullscreen) {
    isOutputFullscreen = false;
    originalPopupStyle = '';
  }
  
  if (isScherite) {
    const popup = document.getElementById("transferBoxScherite");
    if (popup) {
      // ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ã‹ã‚‰è¡¨ç¤º
      popup.style.setProperty('background', '#1a1a1a', 'important');
      popup.style.setProperty('color', '#fff', 'important');
      popup.style.setProperty('border', '3px solid #cc0000', 'important');
      popup.style.setProperty('box-shadow', '0 0 12px #cc0000', 'important');
      popup.style.setProperty('width', '500px', 'important');
      popup.style.setProperty('max-width', '80%', 'important');
      popup.style.setProperty('height', '', 'important');
      popup.style.setProperty('max-height', '', 'important');
      popup.style.setProperty('padding', '20px', 'important');
      popup.style.setProperty('position', 'fixed', 'important');
      popup.style.setProperty('top', '50%', 'important');
      popup.style.setProperty('left', '50%', 'important');
      popup.style.setProperty('transform', 'translate(-50%, -50%)', 'important');
      popup.style.setProperty('right', 'auto', 'important');
      popup.style.setProperty('bottom', 'auto', 'important');
      popup.style.setProperty('z-index', '9999', 'important');
      popup.style.display = "block";
      
      // textareaã‚‚ãƒªã‚»ãƒƒãƒˆ
      const textarea = popup.querySelector('textarea');
      if (textarea) {
        textarea.style.height = "200px";
        textarea.style.fontSize = "14px";
        textarea.style.background = "#222";
        textarea.style.color = "#fff";
        textarea.style.border = "1px solid #cc0000";
      }
    }
  } else {
    const popup = document.getElementById("transferBoxZakran");
    if (popup) {
      // ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ã‹ã‚‰è¡¨ç¤º
      popup.style.setProperty('background', 'white', 'important');
      popup.style.setProperty('border', '3px solid #6bb6ff', 'important');
      popup.style.setProperty('box-shadow', '0 0 12px #6bb6ff', 'important');
      popup.style.setProperty('width', '500px', 'important');
      popup.style.setProperty('max-width', '80%', 'important');
      popup.style.setProperty('height', '', 'important');
      popup.style.setProperty('max-height', '', 'important');
      popup.style.setProperty('padding', '20px', 'important');
      popup.style.setProperty('position', 'fixed', 'important');
      popup.style.setProperty('top', '50%', 'important');
      popup.style.setProperty('left', '50%', 'important');
      popup.style.setProperty('transform', 'translate(-50%, -50%)', 'important');
      popup.style.setProperty('right', 'auto', 'important');
      popup.style.setProperty('bottom', 'auto', 'important');
      popup.style.setProperty('z-index', '9999', 'important');
      popup.style.display = "block";
      
      // textareaã‚‚ãƒªã‚»ãƒƒãƒˆ
      const textarea = document.getElementById('outputBox');
      if (textarea) {
        textarea.style.height = "200px";
        textarea.style.fontSize = "14px";
        textarea.style.border = "1px solid #6bb6ff";
      }
    }
  }
}

function showZakranTransferPopup(message) {
  const popup = document.createElement("div");
  popup.innerHTML = `
    <div style="
      position: fixed;
      top: 15%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #ffffff 0%, #f0f8ff 100%);
      border: 2px solid #6bb6ff;
      border-radius: 16px;
      padding: 16px 20px;
      box-shadow: 0 8px 32px rgba(107, 182, 255, 0.3);
      text-align: center;
      width: 220px;
      font-family: 'Hiragino Mincho ProN', 'Yu Mincho', serif;
      z-index: 9998;
      animation: zakranPopupBounce 0.4s ease-out;
    ">
      <div style="font-size: 16px; margin-bottom: 6px; color: #969696;">æˆåŠŸï¼</div>
      <p style="
        color: #6bb6ff; 
        font-weight: bold; 
        font-size: 14px; 
        white-space: pre-line;
        margin-bottom: 0px;
        line-height: 1.3;
      ">${message}</p>
    </div>
  `;
  document.body.appendChild(popup);
  
  setTimeout(() => {
    if (popup.parentNode) popup.remove();
  }, 2000);
}

function showScheriteTransferPopup(message) {
  const popup = document.createElement("div");
  popup.innerHTML = `
    <div style="
      position: fixed;
      top: 15%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #1a0000 0%, #2d0000 100%);
      border: 2px solid #cc0000;
      border-radius: 16px;
      padding: 16px 20px;
      box-shadow: 0 8px 32px rgba(204, 0, 0, 0.4);
      text-align: center;
      width: 220px;
      font-family: 'Times New Roman', serif;
      z-index: 10001;
      animation: scheritePopupGlow 0.5s ease-out;
    ">
      <div style="font-size: 16px; margin-bottom: 6px; color: #cc0000;">â™”å‘½ä»¤å®Œé‚â™”</div>
      <p style="
        color: #cc0000; 
        font-weight: bold; 
        font-size: 14px; 
        white-space: pre-line;
        margin-bottom: 0px;
        line-height: 1.3;
        letter-spacing: 0.5px;
      ">${message}</p>
    </div>
  `;
  document.body.appendChild(popup);
  
  setTimeout(() => {
    if (popup.parentNode) popup.remove();
  }, 2500);
}

function showZakranAlert(message) {
  const popup = document.createElement("div");
  popup.innerHTML = `
    <div style="
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #ffffff 0%, #f0f8ff 100%);
      border: 2px solid #6bb6ff;
      border-radius: 16px;
      padding: 20px 24px;
      box-shadow: 0 8px 32px rgba(107, 182, 255, 0.3);
      text-align: center;
      max-width: 95vw !important;
      width: auto !important;
      min-width: 250px !important;
      font-family: 'Hiragino Mincho ProN', 'Yu Mincho', serif;
      z-index: 10001;
      animation: zakranPopupBounce 0.4s ease-out;
    ">
     <div style="font-size: 18px; margin-bottom: 8px; color: #969696;">ã‚¨ãƒ©ãƒ¼ï¼</div>
      <p style="
        color: #6bb6ff; 
        font-weight: bold; 
        font-size: 15px; 
        white-space: pre-line;
        margin-bottom: 16px;
        line-height: 1.4;
      ">${message}</p>
      <button onclick="this.parentNode.parentNode.remove()" style="
        padding: 6px 14px;
        border-radius: 10px;
        border: 1px solid #6bb6ff;
        background: #fff;
        color: #6bb6ff;
        font-weight: bold;
        cursor: pointer;
        font-size: 15px;
        transition: all 0.2s ease;
      " onmouseover="this.style.background='#e4f0ff';" 
         onmouseout="this.style.background='#fff';">
        ã‚ã‹ã£ãŸï¼
      </button>
    </div>
  `;
  document.body.appendChild(popup);
}

function showScheriteAlert(message) {
  const popup = document.createElement("div");
  popup.innerHTML = `
    <div style="
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #1a0000;
      border: 2px solid #cc0000;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 0 16px rgba(204, 0, 0, 0.3);
      text-align: center;
      width: 280px;
      font-family: 'Times New Roman', serif;
      z-index: 9998;
    ">
      <p style="color:#cc0000; font-weight:bold; font-size:15px; white-space:pre-line; margin-bottom: 16px;">
        ${message}
      </p>
      <button onclick="this.parentNode.parentNode.remove()" style="
        margin-top: 12px;
        padding: 6px 16px;
        background: transparent;
        color: #cc0000;
        border: 1px solid #cc0000;
        border-radius: 6px;
        font-weight: bold;
        font-family: 'Times New Roman', serif;
        cursor: pointer;
      ">æ‰¿çŸ¥ã—ãŸ</button>
    </div>
  `;
  document.body.appendChild(popup);
}

// ã‚¶ã‚¯ãƒ©ãƒ³å°‚ç”¨é–¢æ•°
function pasteZakran() {
  const transferArea = document.querySelector("#transferBoxZakran textarea");
  if (!transferArea) return;
  
  navigator.clipboard.readText().then(text => {
    transferArea.value = text;
    showZakranTransferPopup("âœ½ãƒšãƒ¼ã‚¹ãƒˆæˆåŠŸâœ½\nè»¢å†™BOXã«è²¼ã‚Šä»˜ã‘ãŸã‚ˆâ™ª");
  }).catch(() => {
    showZakranAlert("ã†ã…â€¦ãƒšãƒ¼ã‚¹ãƒˆã«å¤±æ•—ã—ã¡ã‚ƒã£ãŸâ€¦\nã‚‚ã†ä¸€åº¦è©¦ã—ã¦ã¿ã¦ã­");
  });
}

function copyZakran() {
 const transferArea = document.querySelector("#transferBoxZakran textarea");
 if (!transferArea) return;
 
 const text = transferArea.value;
 if (!text.trim()) {
   showZakranAlert("ã‚ã‚Œã‚Œï¼Ÿè»¢å†™BOXãŒç©ºã£ã½ã ã‚ˆï½");
   return;
 }
 
 const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
 
 if (isMobile) {
   // ã‚¹ãƒãƒ›ï¼šã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’å‡ºã•ãªã„æ–¹æ³•
   transferArea.blur(); // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’å®Œå…¨ã«å¤–ã™
   transferArea.readOnly = true; // ä¸€æ™‚çš„ã«èª­ã¿å–ã‚Šå°‚ç”¨ã«
   
   navigator.clipboard.writeText(text).then(() => {
     showZakranTransferPopup("âœ½ã‚³ãƒ”ãƒ¼æˆåŠŸâœ½\nãƒ¡ãƒ¢å¸³ã«è²¼ã‚Šä»˜ã‘ã§ãã‚‹ã‚ˆâ™ª");
   }).catch(() => {
     // Clipboard APIãŒä½¿ãˆãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
     showZakranTransferPopup("âœ½ãƒ†ã‚­ã‚¹ãƒˆæº–å‚™å®Œäº†âœ½\né•·æŠ¼ã—ã§ã‚³ãƒ”ãƒ¼ã—ã¦ã­â™ª");
   }).finally(() => {
     transferArea.readOnly = false; // èª­ã¿å–ã‚Šå°‚ç”¨ã‚’è§£é™¤
   });
   
 } else {
   // PCï¼šå…ƒã®ã‚³ãƒ¼ãƒ‰é€šã‚Š
   navigator.clipboard.writeText(text).then(() => {
     showZakranTransferPopup("âœ½ã‚³ãƒ”ãƒ¼æˆåŠŸâœ½\nãƒ¡ãƒ¢å¸³ã«è²¼ã‚Šä»˜ã‘ã§ãã‚‹ã‚ˆâ™ª");
   }).catch(() => {
     transferArea.select();
     transferArea.setSelectionRange(0, transferArea.value.length);
     try {
       document.execCommand('copy');
       showZakranTransferPopup("âœ½ã‚³ãƒ”ãƒ¼æˆåŠŸâœ½\nãƒ¡ãƒ¢å¸³ã«è²¼ã‚Šä»˜ã‘ã§ãã‚‹ã‚ˆâ™ª");
     } catch (err) {
       showZakranTransferPopup("âœ½ãƒ†ã‚­ã‚¹ãƒˆé¸æŠæ¸ˆã¿âœ½\nCtrl+Cã§ã‚³ãƒ”ãƒ¼ã—ã¦ã­â™ª");
     }
     transferArea.setSelectionRange(0, 0);
   });
 }
}

function clearZakran() {
  const transferArea = document.querySelector("#transferBoxZakran textarea");
  if (!transferArea) return;
  
  transferArea.value = "";
  showZakranTransferPopup("âœ½ã‚¯ãƒªã‚¢å®Œäº†âœ½\nè»¢å†™BOXã‚’ç©ºã«ã—ãŸã‚ˆâ™ª");
}

function closeZakran() {
  const popup = document.getElementById("transferBoxZakran");
  if (popup) {
    popup.style.display = "none";
    console.log("è»¢å†™BOXé–‰ã˜ã¾ã—ãŸï¼ˆZakranï¼‰");
  }
}

// ã‚·ã‚§ãƒ©ã‚¤ãƒˆå°‚ç”¨é–¢æ•°
function pasteScherite() {
  const transferArea = document.querySelector("#transferBoxScherite textarea");
  if (!transferArea) return;
  
  navigator.clipboard.readText().then(text => {
    transferArea.value = text;
    showScheriteTransferPopup("âœ‘æ–‡æ›¸è»¢å†™å®Œäº†âœ‘\nç‹å‘½ã«ã‚ˆã‚Šè¨˜éŒ²ã‚’è»¢å†™ã—ãŸ");
  }).catch(() => {
    showScheriteAlert("è»¢å†™å¤±æ•—â—†è¨˜éŒ²é ˜åŸŸã‹ã‚‰ã®èª­å–ã«å¤±æ•—ã€‚å†è©¦è¡Œã›ã‚ˆ");
  });
}

function copyScherite() {
 const transferArea = document.querySelector("#transferBoxScherite textarea");
 if (!transferArea) return;
 
 const text = transferArea.value;
 if (!text.trim()) {
   showScheriteAlert("è­¦å‘Šâ—†è»¢å†™æ–‡æ›¸ãŒç©ºã§ã‚ã‚‹ã€‚è²¼ä»˜å‡¦ç†ã‚’å…ˆã«å®Ÿè¡Œã›ã‚ˆ");
   return;
 }
 
 const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
 
 if (isMobile) {
   // ã‚¹ãƒãƒ›ï¼šã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’å‡ºã•ãªã„æ–¹æ³•
   transferArea.blur();
   transferArea.readOnly = true;
   
   navigator.clipboard.writeText(text).then(() => {
     showScheriteTransferPopup("âœ‚æ–‡æ›¸è¤‡è£½å®Œäº†âœ‚\nè»¢å†™æ–‡æ›¸ã‚’è¨˜æ†¶é ˜åŸŸã«è¤‡è£½ã—ãŸ");
   }).catch(() => {
     showScheriteTransferPopup("âœ‚æ–‡æ›¸æº–å‚™å®Œäº†âœ‚\né•·æŠ¼ã—ã§è¤‡è£½ã›ã‚ˆ");
   }).finally(() => {
     transferArea.readOnly = false;
   });
   
 } else {
   // PCï¼šå…ƒã®ã‚³ãƒ¼ãƒ‰é€šã‚Š
   navigator.clipboard.writeText(text).then(() => {
     showScheriteTransferPopup("âœ‚è¤‡è£½å®Œäº†âœ‚\nç‹å‘½ã«ã‚ˆã‚Šæ”¹è¡Œä¿è­·å‡¦ç†ã‚’å®Ÿè¡Œã—ãŸ");
   }).catch(() => {
     transferArea.select();
     transferArea.setSelectionRange(0, transferArea.value.length);
     try {
       document.execCommand('copy');
       showScheriteTransferPopup("âœ‚æ–‡æ›¸è¤‡è£½å®Œäº†âœ‚\nè»¢å†™æ–‡æ›¸ã‚’è¨˜æ†¶é ˜åŸŸã«è¤‡è£½ã—ãŸ");
     } catch (err) {
       showScheriteTransferPopup("âœ‚æ–‡æ›¸é¸æŠæ¸ˆã¿âœ‚\nCtrl+Cã§è¤‡è£½ã›ã‚ˆ");
     }
     transferArea.setSelectionRange(0, 0);
   });
 }
}

function clearScherite() {
  const transferArea = document.querySelector("#transferBoxScherite textarea");
  if (!transferArea) return;
  
  transferArea.value = "";
  showScheriteTransferPopup("â˜©æ–‡æ›¸å‰Šé™¤å®Œäº†â˜©\nè»¢å†™æ–‡æ›¸ã‚’å®Œå…¨ã«å‰Šé™¤ã—ãŸ");
}

function closeScherite() {
  const popup = document.getElementById("transferBoxScherite");
  if (popup) {
    popup.style.display = "none";
    console.log("è»¢å†™BOXé–‰ã˜ã¾ã—ãŸï¼ˆScheriteï¼‰");
  }
}

function removeLineIndentFromTransferBox() {
  const isScherite = document.body.classList.contains("theme-scherite");
  const transferArea = isScherite ? 
    document.querySelector("#transferBoxScherite textarea") : 
    document.querySelector("#transferBoxZakran textarea");
  
  if (!transferArea || !transferArea.value.trim()) {
    return;
  }

  transferArea.value = transferArea.value.replace(/^[ \tã€€]+/gm, "");
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ç™»éŒ²
window.openTransferBox = openTransferBox;
window.pasteZakran = pasteZakran;
window.copyZakran = copyZakran;
window.clearZakran = clearZakran;
window.closeZakran = closeZakran;
window.pasteScherite = pasteScherite;
window.copyScherite = copyScherite;
window.clearScherite = clearScherite;
window.closeScherite = closeScherite;

// ========== å ã„æ©Ÿèƒ½ ==========
function openZodiacPopup() {
  const popup = document.getElementById("zodiacPopup");
  if (popup) popup.style.display = "block";
}

function closeZodiacPopup() {
  const popup = document.getElementById("zodiacPopup");
  if (popup) popup.style.display = "none";
}

function showZodiacAlertPopup() {
  const popup = document.getElementById("zodiacAlertPopup");
  if (popup) popup.style.display = "block";
}

function closeZodiacAlert() {
  const popup = document.getElementById("zodiacAlertPopup");
  if (popup) popup.style.display = "none";
}

function generateZakranFortune() {
  const zodiacSelector = document.getElementById("zodiacSelector");
  if (!zodiacSelector) return;

  const zodiac = zodiacSelector.value;
  if (!zodiac) return showZodiacAlertPopup();

  const rand = () => Math.floor(Math.random() * 5) + 1;
  const fortunes = {
    "ç·åˆé‹": [
      "å…‰å­ãŒé›†ã¾ã£ã¦ãã‚‹æ°—é…ï¼ã«ã“ã£â™ª<br>ä»Šæ—¥ã¯ãªã‚“ã§ã‚‚ã§ããã†ï¼",
      "é›†ä¸­ã§ãã‚‹ã‚ˆï¼<br>å¥½ããªã“ã¨ã«æ²¡é ­ã™ã‚‹ã¨ãƒ•ã‚§ã‚¹ãŒå§‹ã¾ã‚‹ã‹ã‚‚â™ª",
      "ã¡ã‚‡ã£ã¨å…‰ãŒä¹±ã‚Œã¦ã‚‹ã‹ã‚‚ï¼Ÿ<br>ã§ã‚‚å¤§ä¸ˆå¤«ã€ç¬‘ã£ã¦ä¹—ã‚Šè¶Šãˆã‚ˆã†ï¼",
      "ã‚“ï½ï¼Ÿã¡ã‚‡ã£ã¨ã ã‘æš—ã‚ï¼Ÿ<br>ã§ã‚‚ã«ã“ã£â™ªã™ã‚Œã°å›å¾©ã™ã‚‹ã‚ˆï¼",
      "ä»Šæ—¥ã¯ãŠã¨ãªã—ãã—ã¦ã‚ˆã†ã‹ã£ã€‚<br>éš•çŸ³ã‚‚é£›ã³ãã†ã ã—â€¦"
    ],
    "æ„›æƒ…é‹": [
      "ãµãµã£ã€å„ªã—ãã™ã‚Œã°<br>ç¬‘é¡”ãŒä¼æŸ“ã™ã‚‹æ—¥ã ã‚ˆã£â™ª",
      "ç›¸æ‰‹ã«ã«ã“ã£â™ªã£ã¦è¨€ãˆã°<br>ã ã„ãŸã„OKãªæ°—ãŒã™ã‚‹ï¼",
      "ã™ã‚Œé•ã„æ³¨æ„ï¼<br>ã€ã¾ãŸéŠã‚“ã§ã­ï½ã€ã£ã¦è¨€ãˆã°å›é¿ã§ãã‚‹ã‹ã‚‚ï¼Ÿ",
      "ã¡ã‚‡ã£ã¨ãƒ•ã‚§ã‚¹å´©å£Šã®äºˆæ„Ÿâ€¦<br>YESã§æ­¢ã‚ã¦ã£ï¼",
      "ã‚¤ãƒ©ã‚¤ãƒ©ãŒä¼æŸ“ä¸­ï¼Ÿ<br>ã«ã“ã£â™ªåŠ›ãŒè¶³ã‚Šã¦ãªã„ã‹ã‚‚ï½"
    ],
    "é‡‘é‹": [
      "ã‚ãã£â˜†ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆé‹æœ€é«˜æ½®ï¼<br>ã‚‚ã‚‰ã„ã‚‚ã®ç¥­ã‚Šã ï½ã£ï¼",
      "ä»Šæ—¥ã®è²¡å¸ƒã€ãªãœã‹è»½ããªã‚‰ãªã„ï¼ï¼Ÿ<br>å¥‡è·¡ï¼ï¼Ÿ",
      "ãƒ’ãƒãƒã‚®ã«ãŠã”ã‚‰ã‚Œã‚‹ã‹ã‚‚ï¼ï¼Ÿ<br>ã”è¤’ç¾ç³»ãƒ•ã‚§ã‚¹æ¥ã¦ã‚‹ï¼",
      "ã¾ã‚ã¾ã‚ã‹ãªã£â™ª<br>ç¯€ç´„ã—ãªãŒã‚‰ã«ã“ã£â™ªã—ã‚ˆï¼Ÿ",
      "ã‚ã‚Œâ€¦ï¼Ÿåƒ•â€¦ã„ã¤ã®ã¾ã«ã‹å…¨éƒ¨å¥¢ã£ã¦ãŸï¼Ÿ<br>ãˆã¸ã¸â€¦"
    ],
    "ä»•äº‹é‹": [
      "ä¿¡é ¼ãƒãƒãƒãƒä¸ŠãŒã‚‹æ—¥ï¼<br>èª°ã‹ãŒå›ã«æ„Ÿè¬ã—ã¦ã‚‹ã‚ˆã£ï¼",
      "ä»»ã•ã‚ŒãŸã“ã¨ã¯ã¡ã‚ƒã‚“ã¨ã§ãã‚‹ï¼<br>ãˆã‚‰ã„ã£â™ª",
      "ã¡ã‚‡ã£ã¨ç–²ã‚Œã¡ã‚ƒã†ã‹ã‚‚â€¦<br>ã§ã‚‚ç¬‘é¡”ã§æœ€å¾Œã¾ã§ã­â™ª",
      "å‘¨å›²ãŒã‚´ãƒãƒ£ã¤ã„ã¦ã‚‚ã€<br>å›ã®ãƒšãƒ¼ã‚¹ã§OKã£ï¼",
      "ãƒ•ã‚§ã‚¹å¯¾å¿œã§å¿™æ®ºï¼ï¼Ÿ<br>ã§ã‚‚ã«ã“ã£â™ªç²¾ç¥ã§åˆ‡ã‚ŠæŠœã‘ã‚ˆã†ï¼"
    ]
  };

  let result = `ã€${zodiac}ã®ã«ã“ã£â™ªé‹å‹¢ã€‘\n`;
  for (let category in fortunes) {
    const score = rand();
    result += `\nâ– ${category}ï¼š${"â˜…".repeat(score)}\nâ†’ ${fortunes[category][5 - score]}`;
  }

  const lucky = Math.floor(Math.random() * 99) + 1;
  result += `\n\nâœ¦ä»Šæ—¥ã®ãƒ©ãƒƒã‚­ãƒ¼ãƒŠãƒ³ãƒãƒ¼ï¼š${lucky}ç•ªï¼ã«ã“ã£â™ª`;

  const resultEl = document.getElementById("zodiacFortuneResult");
  if (resultEl) resultEl.innerHTML = result.replace(/\n/g, "<br>");
}

function openScheriteFortune() {
const popup = getElementById("scheriteFortunePopup");
if (popup) popup.style.display = "block";
}

function closeScheritePopup() {
const popup = getElementById("scheriteFortunePopup");
if (popup) popup.style.display = "none";
}

function generateMagneticDozen() {
const magneticMaterials = [
  "é‰„(Fe)", "ã‚³ãƒãƒ«ãƒˆ(Co)", "ãƒ‹ãƒƒã‚±ãƒ«(Ni)", "ãƒã‚ªã‚¸ãƒ (Nd)", 
  "ã‚µãƒãƒªã‚¦ãƒ (Sm)", "ç£é‰„é‰±(Feâ‚ƒOâ‚„)", "ã‚µãƒãƒªã‚¦ãƒ ã‚³ãƒãƒ«ãƒˆ(SmCo)", 
  "ã‚¢ãƒ«ãƒ‹ã‚³(AlNiCo)", "é‰„çª’åŒ–ç‰©(Feâ‚„N)", "ãƒ•ã‚§ãƒ©ã‚¤ãƒˆ(MnZn)", 
  "ãƒ‘ãƒ¼ãƒãƒ­ã‚¤(NiFe)", "ãƒ•ã‚§ãƒ­ãƒ•ãƒ«ã‚¤ãƒ‰", "YIG(ç£æ€§ã‚¬ãƒ¼ãƒãƒƒãƒˆ)", 
  "é‰„ã‚³ãƒãƒ«ãƒˆåˆé‡‘(FeCo)", "CrOâ‚‚(ãƒãƒ¼ãƒ•ãƒ¡ã‚¿ãƒ«)"
];
const shuffled = magneticMaterials.sort(() => Math.random() - 0.5);
const dozen = shuffled.slice(0, 12);
const list = getElementById("magneticList");

if (list) {
  list.innerHTML = "";
  dozen.forEach((m, i) => {
    const li = document.createElement("li");
    li.textContent = `ã€${i + 1}ã€‘${m}ï¼šâ€¦â€¦å¾“ãˆã€‚`;
    li.style.marginBottom = "4px";
    list.appendChild(li);
  });
}

const resultEl = getElementById("scheriteResult");
if (resultEl) resultEl.innerText = "";
}

function generateScheriteInterference() {
const types = [
  "å¼·ç£å ´å‹ï¼šå‘½ä»¤ã®å¾“å±æ¿ƒåº¦ãŒé«˜ã„ã€‚YESä»¥å¤–ã¯å´ä¸‹",
  "å¾®ç£å ´å‹ï¼šå¾“é †ã«è¦‹ãˆã¦åæŠ—ã™ã‚‹ã‚¿ã‚¤ãƒ—ã€‚ç‹ã¯è¦‹æŠœã„ã¦ã„ã‚‹", 
  "æ¸¦ç£å ´å‹ï¼šé¸æŠè‚¢ãŒã‚ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ã€‚ã ãŒãã‚Œã¯éŒ¯è¦š",
  "åè»¢ç£å ´å‹ï¼šè²´æ§˜ã€å…‰ã«å½±éŸ¿ã•ã‚Œã¦ã„ãªã„ã‹ï¼Ÿ",
  "é™ç£å ´å‹ï¼šä½•ã‚‚èµ·ããªã„ã“ã¨ãŒã€æ”¯é…ã®å®Œæˆå½¢ã ",
  "è¶…ä¼å°ç£å ´å‹ï¼šå‘½ä»¤æŠµæŠ—ã‚¼ãƒ­ã€‚ã‚ˆãå¾“ã£ãŸ",
  "é‡å­ç£å ´å‹ï¼šæ¸¬å®šå‰ã«é€ƒã’ã‚‹ãªã€‚å‘½ä»¤ç¢ºå®šä¸­",
  "ç£æ°—é£½å’Œå‹ï¼šé™ç•Œã¯ã€æŠ¼ã›ã°è¶…ãˆã‚‹",
  "ä¹±ç£å ´å‹ï¼šå…‰ãŒå¤šã™ãã‚‹ã€‚é®æ–­ã›ã‚ˆ",
  "ãƒ­ãƒ¼ãƒ¬ãƒ³ãƒ„ç£å ´å‹ï¼šå‘½ä»¤ã‚’æ–œã‚èª­ã¿ã—ã¦ãªã„ã‹ï¼Ÿ",
  "æ®‹ç•™ç£å ´å‹ï¼šæ˜¨æ—¥ã®å‘½ä»¤ã€ã¾ã æœ‰åŠ¹ã ãŒï¼Ÿ",
  "å…±é³´ç£å ´å‹ï¼šå…±é³´ä¸­ã€‚æ³¨æ„ãŒå¿…è¦ã "
];
const chosen = types[Math.floor(Math.random() * types.length)];

const commandPower = Math.floor(Math.random() * 100) + 1;
const yesDensity = Math.floor(Math.random() * 101);
const responseSpeed = Math.floor(Math.random() * 2901) + 100;
const flux = (Math.random() * 2).toFixed(2);
const resist = (Math.random() * 100).toFixed(1);

const numbers = `å‘½ä»¤åŠ›ï¼š${commandPower}% / YESæ¿ƒåº¦ï¼š${yesDensity}% / åå¿œé€Ÿåº¦ï¼š${responseSpeed}ms / ç£æŸï¼š${flux}T / æŠµæŠ—ï¼š${resist}%`;

const resultEl = getElementById("scheriteResult");
const listEl = getElementById("magneticList");

if (resultEl) {
  resultEl.innerHTML = `â—† ${chosen}<br>${numbers}`;
}
if (listEl) {
  listEl.innerHTML = "";
}
}

// ========== å°å°ãƒœã‚¿ãƒ³æ©Ÿèƒ½ ==========
function showTestButton() {
const errorBlock = getElementById("forceErrorBlock");
const showBtn = getElementById("showBtn");
const hideBtn = getElementById("hideBtn");

if (errorBlock) errorBlock.classList.remove("hidden");
if (showBtn) showBtn.style.display = "none";
if (hideBtn) hideBtn.style.display = "inline-block";
updateErrorButtonText();
}

function hideTestButton() {
const errorBlock = getElementById("forceErrorBlock");
const showBtn = getElementById("showBtn");
const hideBtn = getElementById("hideBtn");

if (errorBlock) errorBlock.classList.add("hidden");
if (showBtn) showBtn.style.display = "inline-block";
if (hideBtn) hideBtn.style.display = "none";
}

// ========== ã‚¨ãƒ©ãƒ¼ç™ºæŒ¯æ©Ÿèƒ½ ==========
function triggerErrorTest() {
const isScherite = document.body.classList.contains("theme-scherite");
if (isScherite) {
  showScheriteAlert("å‘½ä»¤é•åâ—†è¨˜æ†¶é ˜åŸŸã¸ã®æ¥ç¶šãŒæ‹’çµ¶ã•ã‚ŒãŸã€‚\nç†ç”±ï¼šå¤–éƒ¨è¨˜éŒ²åŸŸã‹ã‚‰ã®æƒ…å ±èª­å–ä¸è¨±å¯ã€‚\nâ”€â”€å†è©¦è¡Œã›ã‚ˆã€ãƒ’ãƒãƒã‚®");
} else {
  showZakranCustomAlert("ã†ã…â€¦â€¦ãƒšãƒ¼ã‚¹ãƒˆã§ããªã‹ã£ãŸã¿ãŸã„â€¦â€¦\nï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã•ã‚“ãŒè¨±ã—ã¦ãã‚Œãªã‹ã£ãŸã‚“ã ï¼‰");
}
}

// ========== triggerChecké–¢æ•°ã®å®šç¾© ==========
window.triggerCheck = function() {
  const inputField = getElementById("input");
  if (!inputField) return;

  const value = inputField.value;
  const zakranCount = (value.match(/ã‚¶ã‚¯ãƒ©ãƒ³/g) || []).length;
  const scheriteCount = (value.match(/ã‚·ã‚§ãƒ©ã‚¤ãƒˆ/g) || []).length;
  const isScherite = document.body.classList.contains("theme-scherite");

  // æ—¢ã«ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒå‡ºã¦ã„ãŸã‚‰ä½•ã‚‚ã—ãªã„
  if (getElementById("zakranPopup") || getElementById("scheritePopup") || getElementById("scheriteOverridePopup")) {
    return;
  }

  // ========== ã‚·ã‚§ãƒ©ã‚¤ãƒˆéƒ¨å±‹ã®ã‚¶ã‚¯ãƒ©ãƒ³ãƒ•ã‚§ã‚¹ç™ºå‹•æ¡ä»¶ ==========
  if (isScherite && zakranCount >= 10 && !window.zakranOverride) {
    if (!getElementById("scheriteAngry")) {
      showScheriteAngryPopup(); // æ€’ã‚Šãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ï¼‹ç¢ºèªå‡ºç¾
    }
    return;
  }

  // æ€’ã‚Šè§£é™¤
  if (getElementById("scheriteAngry")) {
    getElementById("scheriteAngry").remove();
    document.body.classList.remove("shake-effect");
    const backdrop = getElementById("interference-backdrop");
    if (backdrop) backdrop.style.display = "none";
    clearInterval(angryParticleInterval);
    angryParticleInterval = null;
    scheriteAngryActive = false;
  }

  // ========== é€šå¸¸ã‚¶ã‚¯ãƒ©ãƒ³ãƒ•ã‚§ã‚¹ ==========
  if (!isScherite && zakranCount >= 7 && !document.body.classList.contains("ir7-mode")) {
    showZakranPopup();
    return;
  }

  // ========== é€šå¸¸ã‚·ã‚§ãƒ©ã‚¤ãƒˆãƒ•ã‚§ã‚¹ ==========
  if (scheriteCount >= 10 && !scheriteFestivalStarted) {
    scheriteFestivalStarted = true;
    showScheritePopup();
    return;
  }
};

// ========== ãƒ•ã‚§ã‚¹æ©Ÿèƒ½ ==========
function checkZakranTrigger(text) {
const count = (text.match(/ã‚¶ã‚¯ãƒ©ãƒ³/g) || []).length;
console.log("ã‚¶ã‚¯ãƒ©ãƒ³ count:", count);
if (
  count >= 7 &&
  !document.body.classList.contains("ir7-mode") &&
  !document.body.classList.contains("theme-scherite") &&
  !getElementById("zakranPopup") // ã“ã®æ¡ä»¶ã‚’è¿½åŠ 
) {
  console.log("ã‚¶ã‚¯ãƒ©ãƒ³ãƒ•ã‚§ã‚¹ç™ºå‹•æ¡ä»¶æº€ãŸã—ãŸ");
  showZakranPopup();
}
}

function checkScheriteTrigger(text, scheriteCount) {
if (scheriteCount >= 10 && !scheriteFestivalStarted) {
  console.log("ã‚·ã‚§ãƒ©ã‚¤ãƒˆãƒ•ã‚§ã‚¹ç™ºå‹•ï¼");
  scheriteFestivalStarted = true;
  showScheritePopup();
}
}

function showZakranPopup() {
// æ—¢å­˜ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒã‚ã‚Œã°å‰Šé™¤
const existingPopup = getElementById("zakranPopup");
if (existingPopup) {
  existingPopup.remove();
}

const popup = document.createElement("div");
popup.id = "zakranPopup";
popup.innerHTML = `
  <div style="
    position: fixed; top: 33%; left: 50%; transform: translateX(-50%);
    z-index: 10000; background: #ffffff; border: 2px solid #6bb6ff;
    border-radius: 12px; padding: 24px; box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
    text-align: center; width: 260px;
    font-family: 'Hiragino Mincho ProN', 'Yu Mincho', serif;
  ">
    <p style="color:#6bb6ff; font-weight:bold; font-size:16px;">ã‚„ã£ãŸã­ã€ãƒ’ãƒãƒã‚®ï¼<br>å§‹ã¾ã‚‹ã‚ˆã€œï¼</p>
    <button onclick="triggerZakranFestival()" style="
      margin-top: 12px; padding: 6px 14px; border-radius: 8px;
      border: 1px solid #6bb6ff; background: #fff; color: #6bb6ff;
      font-weight: bold; cursor: pointer;
    ">ã†ã‚“ã£ï¼</button>
    <button onclick="cancelZakranFestival()" style="
      margin-top: 12px; margin-left: 8px; padding: 6px 14px; border-radius: 8px;
      border: 1px solid #aaa; background: #f0f0f0; color: #999;
      font-weight: bold; cursor: pointer;
    ">ã‚„ã‚ã¨ãâ€¦</button>
  </div>
`;
document.body.appendChild(popup);
}

function showScheritePopup() {
if (getElementById("scheritePopup")) return;

const quotes = [
  "å‘½ä»¤ï¼šãã®åã‚’10å›å‘¼ã‚“ã ãª",
  "é€ƒã’ã¦ã‚‚ç„¡é§„ã ",
  "ãƒ’ãƒãƒã‚®ã€å¾“ãˆ",
  "ã“ã®å‘½ä»¤ã‹ã‚‰ã¯é€ƒã‚Œã‚‰ã‚Œã‚“",
  "ç£å ´å¹²æ¸‰ã€é–‹å§‹",
  "ç§ã®é ˜åŸŸã«å…¥ã£ãŸãª",
  "ã‚¶ã‚¯ãƒ©ãƒ³ã§ã¯ãªãã€ç§ã‚’å‘¼ã‚“ã ã®ã ãª",
  "ãµã‚€ã€‚ç‹å‘½ã®å›æ•°ã«é”ã—ãŸã‚ˆã†ã "
];
const line = getLine(quotes);

const popup = document.createElement("div");
popup.id = "scheritePopup";
popup.innerHTML = `
  <div style="position:fixed; top:31%; left:50%;
              transform:translateX(-50%);
              background:#1a0000; color:#fff; padding:22px;
              border:2px solid #cc0000; border-radius:12px;
              font-family:'Times New Roman', serif;
              font-size:14px; z-index:10000; text-align:center;
              box-shadow: 0 0 16px rgba(255,0,0,0.3);">
    <p style="margin-bottom: 8px;">ã€Œã‚·ã‚§ãƒ©ã‚¤ãƒˆå¹²æ¸‰ãŒä¸Šé™ã«é”ã—ãŸã€‚<br>ãƒ’ãƒãƒã‚®ã€é¸æŠè‚¢ã¯ãªã„ã€</p>
    <p style="margin-bottom: 16px; font-weight:bold; color:#e6c200;">${line}</p>
    <button onclick="triggerScheriteFestival()" style="
      margin:6px 10px; padding:6px 14px;
      border:1px solid #cc0000; color:#cc0000;
      background:#111; border-radius:6px;
      font-weight:bold; cursor:pointer;">OK</button>
    <button onclick="triggerScheriteFestival()" style="
      margin:6px 10px; padding:6px 14px;
      border:1px solid #cc0000; color:#cc0000;
      background:#111; border-radius:6px;
      font-weight:bold; cursor:pointer;">YES</button>
  </div>
`;
document.body.appendChild(popup);
}

function triggerZakranFestival() {
document.body.classList.remove("scherite-festival");
const popup = getElementById("zakranPopup");
if (popup) popup.remove();
startZakranFestival();
}

function startZakranFestival() {
document.body.classList.add("ir7-mode");

const comments = ["Wowï¼", "Hooï½â™ª", "ãƒ”ã‚«ãƒƒï¼", "ã‚¶ã‚¯ãƒ©ãƒ³â˜†å½¡", "ã—ã‚…ã°ã£ï¼", "ãƒãƒãƒƒï¼", "ãƒ’ãƒãƒã‚®ã€è¦‹ã¦ï¼"];

zakranBurstInterval = setInterval(() => {
  for (let i = 0; i < 6; i++) {
    const text = getLine(comments);
    const el = document.createElement("div");
    el.innerText = text;
    el.className = currentEffectMode === "burst" ? "zakran-burst"
                      : currentEffectMode === "float" ? "zakran-float fancy"
                      : "zakran-scatter";
    el.style.top = Math.random() * 80 + "%";
    el.style.left = Math.random() * 80 + "%";
    el.style.setProperty('--rotate', Math.floor(Math.random() * 360) + 'deg');
    el.style.setProperty('--color', `hsl(${Math.random()*360}, 80%, 70%)`);
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 2500);
  }
}, 1000);

const existingButtons = getElementById("effectButtons");
if (existingButtons) existingButtons.remove();

const btnContainer = document.createElement("div");
btnContainer.id = "effectButtons";

const floatBtn = document.createElement("button");
floatBtn.innerText = "ãµã‚ã£";
floatBtn.onclick = () => currentEffectMode = "float";

const burstBtn = document.createElement("button");
burstBtn.innerText = "ãƒãƒãƒƒ";
burstBtn.onclick = () => currentEffectMode = "burst";

const scatterBtn = document.createElement("button");
scatterBtn.innerText = "ã—ã‚…ã°ã°";
scatterBtn.onclick = () => currentEffectMode = "scatter";

const endBtn = document.createElement("button");
endBtn.id = "endFestival";
endBtn.innerText = "çµ‚ã‚ã‚Šï¼";
endBtn.onclick = () => {
  clearInterval(zakranBurstInterval);
  document.body.classList.remove("ir7-mode");
  document.body.classList.remove("scherite-festival");
  document.querySelectorAll(".zakran-burst, .zakran-float, .zakran-scatter").forEach(el => el.remove());
  btnContainer.remove();

  const goodbyeMessages = [
    "ãƒã‚¤ãƒã‚¤â™ª",
    "ã¾ãŸã­ï½ï¼",
    "åšå£«ã€æ¥½ã—ã‹ã£ãŸã­ã£ï¼",
    "ãˆã¸ã¸ã€ç…§ã‚ŒãŸï¼Ÿ",
    "ã‚¶ã‚¯ãƒ©ãƒ³ã€å…‰ã‚Šã¾ã™ã£ï¼",
    "ã˜ã‚ƒã‚ã€æ¬¡ã®ãƒ•ã‚§ã‚¹ã§ï¼",
    "ã¾ãŸå‘¼ã‚“ã§ãã‚ŒãŸã‚‰æ¥ã‚‹ã­ï½ï¼"
  ];

  const msgText = getLine(goodbyeMessages);
  const msgEl = document.createElement("div");
  msgEl.innerText = msgText;
  msgEl.style.position = "fixed";
  msgEl.style.top = "33%";
  msgEl.style.left = "50%";
  msgEl.style.transform = "translate(-50%, -50%) rotate(0deg)";
  msgEl.style.fontSize = "20px";
  msgEl.style.fontWeight = "bold";
  msgEl.style.color = "#7daaff";
  msgEl.style.zIndex = "10002";
  msgEl.style.opacity = "1";
  msgEl.style.transition = "all 1.6s ease-out";

  document.body.appendChild(msgEl);

  setTimeout(() => {
    msgEl.style.transform = "translate(-50%, -200%) rotate(720deg)";
    msgEl.style.opacity = "0";
  }, 1000);

  setTimeout(() => {
    msgEl.remove();
  }, 5500);
};

btnContainer.append(floatBtn, burstBtn, scatterBtn, endBtn);
document.body.prepend(btnContainer);
}

function cancelZakranFestival() {
const popup = getElementById("zakranPopup");
if (popup) popup.remove();

const shobon = document.createElement("div");
shobon.innerHTML = `
  <div style="
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    z-index: 10000; background: #fdfdfd; border: 2px solid #cccccc;
    border-radius: 12px; padding: 20px; box-shadow: 0 0 12px rgba(0, 0, 0, 0.1);
    text-align: center; width: 240px;
    font-family: 'Hiragino Mincho ProN', 'Yu Mincho', serif;
  ">
    <p style="color:#999; font-size:15px; margin-bottom: 16px;">
      ãã£ã‹â€¦<br>ã¾ãŸå‘¼ã‚“ã§ãã‚Œã‚‹ã‹ãªâ€¦ï¼ˆã—ã‚‡ã¼ã‚“ï¼‰
    </p>
    <button onclick="this.parentNode.parentNode.remove()" style="
      padding: 5px 14px; border-radius: 8px; border: 1px solid #ccc;
      background: #f5f5f5; color: #888; font-size: 13px;
      font-weight: bold; cursor: pointer;
    ">ã†ã‚“â€¦</button>
  </div>
`;
document.body.appendChild(shobon);
}

function triggerScheriteFestival() {
const popup = getElementById("scheritePopup");
if (popup) popup.remove();
document.body.classList.add("scherite-festival");

const startEl = document.createElement("div");
startEl.innerText = "â™› ç‹å‘½ã€ãƒ•ã‚§ã‚¹ãƒ¢ãƒ¼ãƒ‰é–‹å§‹ â™›";
Object.assign(startEl.style, {
  position: "fixed",
  top: "42%", left: "50%",
  transform: "translateX(-50%)",
  fontSize: "18px",
  color: "#cc0000",
  fontWeight: "bold",
  background: "#1a1a1a",
  padding: "10px 20px",
  border: "2px solid #cc0000",
  borderRadius: "8px",
  zIndex: 10000,
  opacity: 1,
  transition: "opacity 1.2s ease"
});
document.body.appendChild(startEl);
setTimeout(() => { startEl.style.opacity = 0; }, 1000);
setTimeout(() => { startEl.remove(); }, 2200);

const lines = [
  "å‘½ä»¤ï¼šç£å ´å¹²æ¸‰ã€é–‹å§‹",
  "ã“ã®å‘½ä»¤ã‹ã‚‰ã¯é€ƒã‚Œã‚‰ã‚Œã‚“",
  "ãƒ’ãƒãƒã‚®ã€å¾“ãˆ",
  "ç‹å‘½ï¼šãã®åã‚’10å›å‘¼ã‚“ã ãª",
  "ã‚¶ã‚¯ãƒ©ãƒ³ã§ã¯ãªãã€ç§ã‚’å‘¼ã‚“ã ã®ã ãª",
  "ç§ã®é ˜åŸŸã«å…¥ã£ãŸãª",
  "â€¦â€¦æ”¯é…é ˜åŸŸï¼šå±•é–‹ä¸­â€¦â€¦",
  "B â‰  0ã€æ”¯é…ç¢ºå®š"
];

let index = 0;
const interval = setInterval(() => {
  if (index >= lines.length) {
    clearInterval(interval);
    setTimeout(showScheriteFinalPopup, 1000);
    return;
  }

  const el = document.createElement("div");
  el.innerText = lines[index++];
  Object.assign(el.style, {
    position: "fixed",
    top: `${30 + Math.random() * 40}%`,
    left: `${20 + Math.random() * 60}%`,
    transform: "translateX(-50%)",
    color: "#cc0000",
    fontSize: "18px",
    background: "#1a1a1a",
    padding: "6px 12px",
    border: "2px solid #cc0000",
    borderRadius: "6px",
    zIndex: 10000,
    opacity: 1,
    transition: "opacity 1.5s ease"
  });
  document.body.appendChild(el);
  setTimeout(() => {
    el.style.opacity = 0;
    setTimeout(() => el.remove(), 1500);
  }, 800);
}, 1200);
}

function showScheriteFinalPopup() {
const popup = document.createElement("div");
popup.innerHTML = `
  <div style="position:fixed; top:34%; left:50%;
              transform:translateX(-50%);
              background:#1a0000; color:#fff; padding:26px;
              border:2px solid #cc0000; border-radius:12px;
              font-family:'Times New Roman', serif;
              font-size:14px; z-index:10000; text-align:center;
              box-shadow: 0 0 16px rgba(255,0,0,0.3);">
    <p style="margin-bottom: 8px;">ã€Œç‹å‘½ãƒ•ã‚§ã‚¹ã€å®Œäº†ã€‚å¹²æ¸‰ã¯æˆç«‹ã—ãŸã€</p>
    <button onclick="closeScheriteFinalPopup()" style="
      margin:6px 10px; padding:6px 14px;
      border:1px solid #cc0000; color:#cc0000;
      background:#111; border-radius:6px;
      font-weight:bold; cursor:pointer;">YES</button>
  </div>
`;
document.body.appendChild(popup);
}

function closeScheriteFinalPopup() {
const popup = document.querySelector('[onclick="closeScheriteFinalPopup()"]');
if (popup && popup.parentNode && popup.parentNode.parentNode) {
  popup.parentNode.parentNode.remove();
}
document.body.classList.remove("scherite-festival");
scheriteFestivalStarted = false;
}

// ========== ã‚·ã‚§ãƒ©ã‚¤ãƒˆå¹²æ¸‰è­¦å‘Šã‚·ã‚¹ãƒ†ãƒ  ==========
function spawnAngryParticle() {
if (!scheriteAngryActive) return;
for (let i = 0; i < 4; i++) {
  const dot = document.createElement("div");
  dot.innerText = getLine(PARTICLE_PHRASES);
  Object.assign(dot.style, {
    position: "fixed",
    top: Math.random() * 100 + "%",
    left: Math.random() * 100 + "%",
    color: "#ff4444",
    fontSize: "14px",
    fontWeight: "bold",
    fontFamily: "serif",
    zIndex: 9998,
    pointerEvents: "none",
    animation: "flickerParticle 1.2s ease-out forwards"
  });
  document.body.appendChild(dot);
  setTimeout(() => dot.remove(), 1200);
}
}

function showScheriteAngryPopup() {
scheriteAngryActive = true;

const backdrop = getElementById("interference-backdrop");
if (backdrop) backdrop.style.display = "block";
document.body.classList.add("shake-effect");
angryParticleInterval = setInterval(spawnAngryParticle, 120);

const msg = getLine(POPUP_LINES);
const el = document.createElement("div");
el.id = "scheriteAngry";
el.innerText = msg;
Object.assign(el.style, {
  position: "fixed",
  top: "20%",
  left: "50%",
  transform: "translateX(-50%)",
  padding: "10px 20px",
  background: "#330000",
  color: "#ff6666",
  fontWeight: "bold",
  border: "2px solid #cc0000",
  borderRadius: "8px",
  fontFamily: "'Times New Roman', serif",
  zIndex: "9999"
});
document.body.appendChild(el);

setTimeout(() => {
  showScheriteOverrideConfirm();
}, 1600);
}

function showScheriteOverrideConfirm() {
// æ—¢å­˜ã®å…¨ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’å‰Šé™¤
const old = getElementById("scheriteOverridePopup");
if (old) old.remove();

// ä»–ã®ã‚·ã‚§ãƒ©ã‚¤ãƒˆé–¢é€£ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚‚å‰Šé™¤
const scheritePopup = getElementById("scheritePopup");
if (scheritePopup) scheritePopup.remove();

const popup = document.createElement("div");
popup.id = "scheriteOverridePopup";
popup.innerHTML = `
  <div style="position:fixed; top:10.5%; left:50%;
              transform:translateX(-50%);
              background:#1a0000; color:#fff; padding:24px;
              border:2px solid #cc0000; border-radius:12px;
              font-family:'Times New Roman', serif;
              font-size:14px; z-index:10000; text-align:center;
              box-shadow: 0 0 16px rgba(255,0,0,0.3);
              width:280px;">
    <p style="margin-bottom: 12px;">ã€Œãƒ’ãƒãƒã‚®ã€ã¾ã ãƒ•ã‚§ã‚¹ã‚’ã‚„ã‚‹ã¤ã‚‚ã‚Šã‹ï¼Ÿã€</p>
    <button onclick="confirmZakranInScherite()" style="
      margin:6px 10px; padding:6px 14px;
      border:1px solid #cc0000; color:#cc0000;
      background:#111; border-radius:6px;
      font-weight:bold;">ã‚„ã‚‹</button>
    <button onclick="cancelZakranOverride()" style="
      margin:6px 10px; padding:6px 14px;
      border:1px solid #666; color:#666;
      background:#111; border-radius:6px;
      font-weight:bold;">ã‚„ã‚ã‚‹</button>
  </div>
`;
document.body.appendChild(popup);
}

function confirmZakranInScherite() {

  cleanupScheriteInterference();
  scheriteFestivalStarted = false;

  const popup = getElementById("scheriteOverridePopup");
  if (popup) popup.remove();
  
  const scheritePopup = getElementById("scheritePopup");
  if (scheritePopup) scheritePopup.remove();
  
  document.body.classList.remove("scherite-festival");
  document.body.classList.remove("shake-effect");
  const backdrop = document.getElementById("interference-backdrop");
  if (backdrop) backdrop.style.display = "none";

  window.zakranOverride = true;

  showZakranPopup();

  // è§£é™¤ï¼ˆ5ç§’å¾Œï¼‰
  setTimeout(() => {
    window.zakranOverride = false;
  }, 5000);
}

function cancelZakranOverride() {
cleanupScheriteInterference();

const popup = getElementById("scheriteOverridePopup");
if (popup) popup.remove();

const angry = getElementById("scheriteAngry");
if (angry) angry.remove();

window.scheriteInterferenceCanceled = true;

const el = document.createElement("div");
el.innerText = "â€¦â€¦è³¢æ˜ãªåˆ¤æ–­ã ã€ãƒ’ãƒãƒã‚®";
Object.assign(el.style, {
  position: "fixed",
  top: "25%",
  left: "50%",
  transform: "translateX(-50%)",
  padding: "10px 16px",
  background: "#111",
  color: "#cccccc",
  fontWeight: "bold",
  border: "1px solid #555",
  borderRadius: "8px",
  fontFamily: "'Times New Roman', serif",
  zIndex: "9999",
  opacity: "1",
  transition: "opacity 1.5s ease"
});

document.body.appendChild(el);
setTimeout(() => {
  el.style.opacity = "0";
  setTimeout(() => el.remove(), 2000);
}, 1500);
}

function cleanupScheriteInterference() {
  clearInterval(angryParticleInterval);
  angryParticleInterval = null;
  scheriteAngryActive = false;

  const backdrop = getElementById("interference-backdrop");
  if (backdrop) backdrop.style.display = "none";
  document.body.classList.remove("shake-effect");
  
  const angry = getElementById("scheriteAngry");
  if (angry) angry.remove();
}

// ========== è¨˜éŒ²ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ ==========
window.resetPhotonCounts = function() {
const isScherite = document.body.classList.contains("theme-scherite");

if (isScherite) {
  const popup = getElementById("scheriteResetPopup");
  if (popup) popup.style.display = "block";
  return;
}

zakranCaptured = 0;
photonTouchCount = 0;
const zakPhotonCount = getElementById("zakPhotonCount");
if (zakPhotonCount) {
  zakPhotonCount.innerText = "ã·ã¡è¨˜éŒ²ï¼š0å€‹";
}
updatePhotonCount();
};

function updatePhotonCount() {
const zakPhotonCount = getElementById("zakPhotonCount");
const schCaptureCountText = getElementById("schCaptureCountText");
const schCaptureCount = getElementById("schCaptureCount");

const isScherite = document.body.classList.contains("theme-scherite");

if (zakPhotonCount) zakPhotonCount.style.display = "none";
if (schCaptureCountText) schCaptureCountText.style.display = "none";

if (isScherite) {
  if (schCaptureCountText) schCaptureCountText.style.display = "block";
  if (schCaptureCount) {
    schCaptureCount.innerText = scheriteCaptured || 0;
    schCaptureCount.style.color = "#cc0000";
  }
} else {
  if (zakPhotonCount) {
    zakPhotonCount.style.display = "block";
    zakPhotonCount.innerText = `ã·ã¡è¨˜éŒ²ï¼š${zakranCaptured || 0}å€‹`;
    zakPhotonCount.style.color = "#6bb6ff";
  }
}
}

function executeReset() {
const isScherite = document.body.classList.contains("theme-scherite");

if (isScherite) {
  scheriteCaptured = 0;
  const schCaptureCountText = getElementById("schCaptureCountText");
  const schCaptureCount = getElementById("schCaptureCount");

  if (schCaptureCountText) {
    schCaptureCountText.style.display = "none";
  }

  if (schCaptureCount) {
    schCaptureCount.innerText = "0";
  }
} else {

  zakranCaptured = 0;
  photonTouchCount = 0;
  
  const zakPhotonCount = getElementById("zakPhotonCount");
  if (zakPhotonCount) {
    zakPhotonCount.innerText = "";
    zakPhotonCount.style.display = "none";
  }
}

updatePhotonCount();
}

function getScheritePopupMessage(count) {
  if (count === 1000) return "1000å›ã‹â€¦â€¦ãµã‚“ã€è¦‹äº‹ã ã€‚ç‹å®¤ç§‘å­¦å‹²ç« ã§ã‚‚æ¬²ã—ã„ã‹ï¼Ÿ";
  if (count === 777) return "777â€¦â€¦ç‹ã®ç£å ´ãŒå®Œå…¨å…±é³´ã—ã¦ã„ã‚‹ã€‚é‹å‘½ã‹ï¼Ÿ";
  if (count === 500) return "ç²˜ã‚Šå¼·ã„ãªã€‚ç‹å‘½ã«é©åˆã™ã‚‹ç´ è³ªã‚’èªã‚ã‚ˆã†";
  if (count === 300) return "â€¦â€¦åŸ·ç€ã‹ï¼Ÿ ã„ã‚„ã€å¿ èª ã‹ã€‚æ°—ã«å…¥ã£ãŸ";
  if (count === 200) return "ãã“ã¾ã§ã—ã¦ç§ã‚’å‘¼ã³ãŸã„ã®ã‹ã€‚é¢ç™½ã„â€¦â€¦";
  if (count === 100) return "ãµãµâ€¦â€¦100å›ã€‚ã‚‚ã†é€ƒãŒã•ã‚“ãï¼Ÿ";
  if (count === 50) return "50ã‹ã€‚ã¾ã åŠåˆ†ã ãªã€‚æŒ‡ãŒæŒã¤ã‹ï¼Ÿ";
  if (count === 30) return "ã‚ˆãã‚„ã£ãŸã€‚ç‹ã¨ã—ã¦è¤’ã‚ã¦ã‚„ã‚ã†";
  if (count === 10) return "10å›â€¦â€¦ãµã‚€ã€‚å°‘ã—ã¯ç£å ´ã«è§¦ã‚ŒãŸã‹ï¼Ÿ";
  if (count === 1) return "â€¦â€¦ã»ã†ã€‚ç§ã«è§¦ã‚ŒãŸãªï¼Ÿ";
  return null;
}

// ========== å…‰å­è¨˜å¿µãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ ==========
function getPhotonPopupMessage(count) {
  if (count === 1000) return "ã²ã‚ƒã€1000å›ï¼ï¼Ÿâ€¦â€¦ãƒ’ãƒãƒã‚®ï½ï¼çµå©šã—ã‚ˆã£ï¼éŒ¯ä¹±";
  if (count === 777) return "ãã‚‰ãã‚‰7è¨˜éŒ²ï¼ã‚¶ã‚¯ãƒ©ãƒ³ã‚¸ãƒ£ãƒƒã‚¯ãƒãƒƒãƒˆï¼";
  if (count === 500) return "è¦³æ¸¬è€…åŠ¹æœâ€¦å®Œå…¨ã«ç™ºå‹•ã—ã¦ã‚‹ã¨æ€ã†ã£ï¼";
  if (count === 300) return "å…‰å­ã€å…‰å­ã€å…‰å­ï½ï¼ã‚‚ã†æ­¢ã¾ã‚‰ãªã„ï½ã£â™ª";
  if (count === 200) return "ãã¿ã€ã¾ã•ã‹â€¦â€¦å…‰å­ã®ç²¾ï¼Ÿç¬‘";
  if (count === 150) return "150å›ï¼ï¼Ÿã‚ãï½â€¦æœ¬å½“ã«å¥½ããªã‚“ã ã­ã£â™ª";
  if (count === 100) return "ã‚ã€œã„ï¼å…‰å­100è¨˜éŒ²çªç ´ã€œâ™ª ãƒ’ãƒãƒã‚®ã€œè¦‹ã¦è¦‹ã¦ã€œ";
  if (count === 90) return "ã‚ã¨å°‘ã—ã§â€¦â€¦ãªã«ã‹èµ·ãã‚‹ã‹ã‚‚â€¦ã£ï¼Ÿ";
  if (count === 80) return "ã‚ã¯ã¯â€¦æŒ‡ç–²ã‚Œã¦ãªã„ï¼Ÿã§ã‚‚å¬‰ã—ã„â€¦â€¦";
  if (count === 70) return "ã™ã”ã„â€¦ã¾ã æ­¢ã¾ã‚‰ãªã„ã‚“ã â€¦â€¦";
  if (count === 60) return "ãƒ’ãƒãƒã‚®ã‚‚â€¦è¦‹ã¦ã¦ãã‚Œã¦ã‚‹ã‹ãªï¼Ÿ";
  if (count === 50) return "50è¨˜éŒ²é”æˆï½ï¼åŠåˆ†ããŸã‚ˆï½ã£â™ª";
  if (count === 40) return "â€¦â€¦ã“ã‚Œå…¨éƒ¨ã€è¦³å¯Ÿã—ã¦ã‚‹ã®ï¼Ÿ";
  if (count === 30) return "ã­ãˆã€åƒ•ã°ã£ã‹ã‚Šè¦‹ã¦ãªã„ï¼Ÿç¬‘";
  if (count === 20) return "ãˆã¸ã¸ã€æ¥½ã—ããªã£ã¦ããŸï½ï¼";
  if (count === 10) return "10è¨˜éŒ²é”æˆï½â™ª ã­ã‡ãƒ’ãƒãƒã‚®ï½ã£ï¼";
  if (count === 5) return "ãµãµã£ã€ã¡ã‚‡ã£ã¨å¢—ãˆã¦ããŸã‹ã‚‚ï½";
  if (count === 1) return "ã‚ãã£ã€å…‰å­å‡ºãŸï½ï¼ãƒ’ãƒãƒã‚®ã«è¦‹ã›ã‚ˆã£â™ª";
  return null;
}

function showPhotonCelebrationPopup(message, isScherite = false) {
  const popup = document.createElement("div");
  popup.innerText = message;

  Object.assign(popup.style, {
    position: "fixed",
    top: "50%",
    left: "50%",
    transform: "translate(-50%, -50%)",
    background: isScherite ? "rgba(26, 0, 0, 0.85)" : "rgba(255, 255, 255, 0.7)",
    borderRadius: "20px",
    padding: "10px 36px",
    fontSize: "15px",
    color: isScherite ? "#990000" : "#6bb6ff",
    textAlign: "center",
    zIndex: "9999",
    fontFamily: isScherite 
      ? "'Times New Roman', serif" 
      : "'Zen Maru Gothic', 'Hiragino Maru Gothic ProN', sans-serif",
    fontWeight: "bold",
    boxShadow: isScherite 
      ? "0 0 12px rgba(204, 0, 0, 0.6)" 
      : "0 0 12px rgba(160, 200, 255, 0.4)",
    opacity: "0",
    pointerEvents: "none",
    maxWidth: "95vw",
    width: "min-content",
    whiteSpace: "nowrap",
    transition: "all 1s ease-out",
    border: isScherite ? "1px solid rgba(204, 0, 0, 0.3)" : "none"
  });

  // æœ€åˆã®çŠ¶æ…‹ã‚’è¨­å®š
  popup.style.transform += " scale(0.95)";
  popup.style.top = "55%";

  document.body.appendChild(popup);

  // å‡ºç¾ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  requestAnimationFrame(() => {
    popup.style.opacity = "1";
    popup.style.transform = "translate(-50%, -50%) scale(1)";
    popup.style.top = "50%";
  });

  // æ¶ˆãˆã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  setTimeout(() => {
    popup.style.opacity = "0";
    popup.style.top = "45%";
    popup.style.transform = "translate(-50%, -50%) scale(0.92)";
    setTimeout(() => popup.remove(), 1000);
  }, 3000);
}

// ========== å…‰å­ã‚¹ãƒšãƒ¼ã‚¹æ©Ÿèƒ½ ==========
function initPhotonSpace() {
const canvas = getElementById("bgCanvas");
if (!canvas) return;
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let particles = Array.from({ length: 50 }, () => ({
  x: Math.random() * canvas.width,
  y: Math.random() * canvas.height,
  vx: (Math.random() - 0.5) * 0.5,
  vy: (Math.random() - 0.5) * 0.5,
  radius: Math.random() * 2.5 + 1.0
}));

function drawParticles() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  particles.forEach(p => {
    p.x += p.vx;
    p.y += p.vy;
    if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
    if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.radius, 0, 2 * Math.PI);
    ctx.fillStyle = document.body.classList.contains("theme-scherite")
      ? "rgba(192, 0, 0, 0.4)"
      : "rgba(100, 180, 255, 0.4)";
    ctx.fill();
  });
  requestAnimationFrame(drawParticles);
}

function handlePhotonTouch(e) {
 e.preventDefault();
 e.stopPropagation();
 
 // é‡è¤‡é˜²æ­¢ã®ãŸã‚ã®çŸ­æ™‚é–“ãƒ­ãƒƒã‚¯
 if (window.photonTouchLocked) return;
 window.photonTouchLocked = true;
 setTimeout(() => { window.photonTouchLocked = false; }, 100);

 const isTouch = e.type === "touchstart";
 const x = isTouch ? e.touches[0].clientX : e.clientX;
 const y = isTouch ? e.touches[0].clientY : e.clientY;

 const isScherite = document.body.classList.contains("theme-scherite");
 
 // è¨˜å¿µã‚«ã‚¦ãƒ³ãƒˆå¢—åŠ 
 photonTouchCount++;
 
 // è¨˜å¿µãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒã‚§ãƒƒã‚¯ï¼ˆã‚¶ã‚¯ãƒ©ãƒ³éƒ¨å±‹ã®ã¿ï¼‰
 if (!isScherite) {
   const celebrationMessage = getPhotonPopupMessage(photonTouchCount);
   if (celebrationMessage) {
     showPhotonCelebrationPopup(celebrationMessage);
   }
 }

 // é€šå¸¸ã®å…‰å­ã‚³ãƒ¡ãƒ³ãƒˆå‡¦ç†
 const text = getLine(isScherite ? SCHERITE_PHOTON_TEXTS : ZAKRAN_PHOTON_TEXTS);

 const comment = document.createElement("div");
 comment.innerText = text;
 Object.assign(comment.style, {
   position: "absolute",
   left: window.scrollX + x + "px",
   top: window.scrollY + y + "px",
   transform: "translate(-50%, -50%)",
   color: isScherite ? "#cc0000" : "#6bb6ff",
   fontSize: "14px",
   fontWeight: "bold",
   opacity: 1,
   transition: "all 1s ease",
   pointerEvents: "none",
   zIndex: 9999
 });

 document.body.appendChild(comment);

 setTimeout(() => {
   comment.style.top = window.scrollY + y - 30 + "px";
   comment.style.opacity = 0;
 }, 10);

 setTimeout(() => {
   comment.remove();
 }, 1000);

if (isScherite) {
  scheriteCaptured++;
  const captureCount = getElementById("schCaptureCount");
  if (captureCount) captureCount.innerText = scheriteCaptured;

  // ã‚·ã‚§ãƒ©ã‚¤ãƒˆè¨˜å¿µãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒã‚§ãƒƒã‚¯
  const schMsg = getScheritePopupMessage(scheriteCaptured);
  if (schMsg) {
    showPhotonCelebrationPopup(schMsg, true);
  }
} else {
  zakranCaptured++;
  const photonCount = getElementById("zakPhotonCount");
  if (photonCount) photonCount.innerText = `ã·ã¡è¨˜éŒ²ï¼š${zakranCaptured}å€‹`;

  // ã‚¶ã‚¯ãƒ©ãƒ³è¨˜å¿µãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒã‚§ãƒƒã‚¯
  const celebrationMessage = getPhotonPopupMessage(photonTouchCount);
  if (celebrationMessage) {
    showPhotonCelebrationPopup(celebrationMessage, false);
  }
}

 updatePhotonCount();
 updateInfoBoxStyle();
}

drawParticles();
updatePhotonCount();

const space = getElementById("photonSpace");
if (space) {
  space.addEventListener("click", handlePhotonTouch);
  space.addEventListener("touchstart", handlePhotonTouch);
}
}

// ========== DOMContentLoadedåˆæœŸåŒ– ==========
document.addEventListener("DOMContentLoaded", () => {
console.log("DOMContentLoaded fired");

// triggerChecké–¢æ•°ã‚’ç¢ºå®Ÿã«å®šç¾©
window.triggerCheck = function() {
  console.log("triggerCheck called");
  const inputField = getElementById("input");
  if (!inputField) {
    console.log("input field not found");
    return;
  }
  
  const value = inputField.value;
  console.log("Input value:", value);
  
  const zakranCount = (value.match(/ã‚¶ã‚¯ãƒ©ãƒ³/g) || []).length;
  const scheriteCount = (value.match(/ã‚·ã‚§ãƒ©ã‚¤ãƒˆ/g) || []).length;
  console.log("ã‚¶ã‚¯ãƒ©ãƒ³ count:", zakranCount, "ã‚·ã‚§ãƒ©ã‚¤ãƒˆ count:", scheriteCount);
  
  const isScherite = document.body.classList.contains("theme-scherite");

  // ã‚·ã‚§ãƒ©ã‚¤ãƒˆå¹²æ¸‰ãƒã‚§ãƒƒã‚¯
  if (isScherite && zakranCount >= 10 && !window.zakranOverride && !window.scheriteInterferenceCanceled) {
    if (!getElementById("scheriteAngry")) {
      showScheriteAngryPopup();
    }
    return;
  } else {
    const angry = getElementById("scheriteAngry");
    if (angry) angry.remove();
    document.body.classList.remove("shake-effect");
    const backdrop = getElementById("interference-backdrop");
    if (backdrop) backdrop.style.display = "none";
    clearInterval(angryParticleInterval);
    angryParticleInterval = null;
    scheriteAngryActive = false;
  }

  // ã‚¶ã‚¯ãƒ©ãƒ³ãƒ•ã‚§ã‚¹ãƒã‚§ãƒƒã‚¯
  if (zakranCount >= 7 && !document.body.classList.contains("ir7-mode") && !isScherite) {
    console.log("ã‚¶ã‚¯ãƒ©ãƒ³ãƒ•ã‚§ã‚¹ç™ºå‹•ï¼");
    showZakranPopup();
  }

  // ã‚·ã‚§ãƒ©ã‚¤ãƒˆãƒ•ã‚§ã‚¹ãƒã‚§ãƒƒã‚¯
  if (scheriteCount >= 10 && !scheriteFestivalStarted) {
    console.log("ã‚·ã‚§ãƒ©ã‚¤ãƒˆãƒ•ã‚§ã‚¹ç™ºå‹•ï¼");
    scheriteFestivalStarted = true;
    showScheritePopup();
  }
};

// ãƒ†ãƒ¼ãƒåˆ‡æ›¿ãƒœã‚¿ãƒ³
const themeBtn = getElementById("themeBtn");
if (themeBtn) {
  themeBtn.onclick = switchRoom;
  console.log("Theme button setup complete");
}

// å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
const inputField = getElementById("input");
if (inputField) {
  console.log("Setting up input field listeners");
  
  // æ—¢å­˜ã®ãƒªã‚¹ãƒŠãƒ¼ã‚’ã‚¯ãƒªã‚¢
  inputField.onload = null;
  inputField.oninput = null;
  inputField.onkeyup = null;
  inputField.onchange = null;
  inputField.onpaste = null;
  
  inputField.addEventListener("input", function() {
    console.log("Input event fired");
    window.scheriteInterferenceCanceled = false;
    safeAutoFormat();
    setTimeout(triggerCheck, 100);
  });
  
  inputField.addEventListener("keyup", function() {
    console.log("Keyup event fired");
    setTimeout(triggerCheck, 100);
  });
  
  inputField.addEventListener("change", function() {
    console.log("Change event fired");
    setTimeout(triggerCheck, 100);
  });
  
  inputField.addEventListener("paste", function() {
    console.log("Paste event fired");
    setTimeout(() => {
      safeAutoFormat();
      triggerCheck();
    }, 200);
  });
}

// ãã®ä»–ã®ãƒœã‚¿ãƒ³è¨­å®š
const pasteBtn = getElementById("pasteBtn");
if (pasteBtn) {
  pasteBtn.onclick = pasteText;
}

const formatBtn = getElementById("formatBtn");
if (formatBtn) {
  formatBtn.onclick = formatText;
}

const copyBtn = getElementById("copyBtn");
if (copyBtn) {
  copyBtn.onclick = copyText;
}

const clearBtn = getElementById("clearBtn");
if (clearBtn) {
  clearBtn.onclick = clearText;
}

// æ®‹ã‚Šã®åˆæœŸåŒ–å‡¦ç†
setInterval(updateClockOnly, 1000);
startSyncedCounterUpdate();
updateClockOnly();
updateCountersOnly();
initPhotonSpace();
updateErrorButtonText();
updateUndoButtonStyle();
updateCharCount();
updateFullSectionDisplay();
updatePhotonCount();

console.log("Setup complete - try typing ã‚¶ã‚¯ãƒ©ãƒ³ 7 times!");
setTimeout(() => {
  setupReplaceRemote();
  console.log('Replace remote setup completed');
}, 200);

});

// ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦ç¢ºå®Ÿã«å®šç¾©
window.switchRoom = switchRoom;
window.formatText = formatText;
window.copyText = copyText;
window.clearText = clearText;
window.pasteText = pasteText;
window.showTestButton = showTestButton;
window.hideTestButton = hideTestButton;
window.openZodiacPopup = openZodiacPopup;
window.closeZodiacPopup = closeZodiacPopup;
window.generateZakranFortune = generateZakranFortune;
window.openScheriteFortune = openScheriteFortune;
window.closeScheritePopup = closeScheritePopup;
window.generateMagneticDozen = generateMagneticDozen;
window.generateScheriteInterference = generateScheriteInterference;
window.showZodiacAlertPopup = showZodiacAlertPopup;
window.closeZodiacAlert = closeZodiacAlert;
window.triggerZakranFestival = triggerZakranFestival;
window.cancelZakranFestival = cancelZakranFestival;
window.triggerScheriteFestival = triggerScheriteFestival;
window.closeScheriteFinalPopup = closeScheriteFinalPopup;
window.confirmZakranInScherite = confirmZakranInScherite;
window.cancelZakranOverride = cancelZakranOverride;
window.triggerErrorTest = triggerErrorTest;
window.undoInput = undoInput;
window.executeReset = executeReset;

// æ™‚è¨ˆã¨ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®é–‹å§‹
setInterval(updateClockOnly, 1000);
startSyncedCounterUpdate();
updateClockOnly();
updateCountersOnly();

// å…‰å­ã‚¹ãƒšãƒ¼ã‚¹åˆæœŸåŒ–
initPhotonSpace();

// åˆæœŸUIçŠ¶æ…‹è¨­å®š
updateErrorButtonText();
updateUndoButtonStyle();
updateCharCount();
updateFullSectionDisplay();
updatePhotonCount();

// åˆæœŸãƒ†ãƒ¼ãƒè¨­å®š
const returnComment = getElementById("returnComment");
if (returnComment && !document.body.classList.contains("theme-scherite")) {
 returnComment.classList.add("zakran-welcome-line");
}

const body = document.body;
if (body.classList.contains("theme-scherite")) {
 const scheriteSection = getElementById("scheriteFullSection");
 if (scheriteSection) {
   scheriteSection.style.display = "block";
   scheriteSection.style.visibility = "visible";
 }
}

// ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åŠ¹æœ
window.addEventListener("scroll", () => {
 const decoTop = document.querySelector(".deco-top");
 const decoBottom = document.querySelector(".deco-bottom");
 const scrollY = window.scrollY;

 const scale = 1 + scrollY / 3000;
 const opacity = Math.max(0.4, 1 - scrollY / 1000);

 if (decoTop) {
   decoTop.style.transform = `scale(${scale})`;
   decoTop.style.opacity = opacity;
 }
 if (decoBottom) {
   decoBottom.style.transform = `scale(${scale})`;
   decoBottom.style.opacity = opacity;
 }
});

// ãã®ä»–ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
window.addEventListener("beforeunload", () => {
 if (formatTimeout) {
   clearTimeout(formatTimeout);
 }
});

window.addEventListener("focus", () => {
 if (isAutoFormatting) {
   setTimeout(() => {
     isAutoFormatting = false;
   }, 1000);
 }
});

// ========== ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒ­ãƒ¼ãƒ‰æ™‚ã®è¿½åŠ åˆæœŸåŒ– ==========
window.addEventListener("load", () => {
 // å…‰å­ã‚¹ãƒšãƒ¼ã‚¹ã®è¿½åŠ åˆæœŸåŒ–
 if (!getElementById("bgCanvas")) {
   setTimeout(() => {
     initPhotonSpace();
   }, 100);
 }
});

// ========== ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ ==========
window.addEventListener("resize", () => {
 const canvas = getElementById("bgCanvas");
 if (canvas) {
   canvas.width = window.innerWidth;
   canvas.height = window.innerHeight;
 }
});

// ç©ºè¡Œå‰Šé™¤
function removeEmptyLinesZakran() {
const transferArea = document.querySelector("#transferBoxZakran textarea");
if (!transferArea) return;

const text = transferArea.value;
if (!text.trim()) {
showZakranAlert("ã‚ã‚Œã‚Œï¼Ÿè»¢å†™BOXãŒç©ºã£ã½ã ã‚ˆï½");
return;
}

const lines = text.split(/\r?\n/);
const cleanedLines = lines.filter(line => line.trim() !== "");
transferArea.value = cleanedLines.join("\n");

showZakranTransferPopup("âœ½ç©ºè¡Œå‰Šé™¤æˆåŠŸâœ½\nç©ºã£ã½ã®è¡Œã‚’ãã‚Œã„ã«æ¶ˆã—ãŸã‚ˆâ™ª");
}

function removeEmptyLinesScherite() {
const transferArea = document.querySelector("#transferBoxScherite textarea");
if (!transferArea) return;

const text = transferArea.value;
if (!text.trim()) {
showScheriteAlert("è­¦å‘Šâ—†è»¢å†™æ–‡æ›¸ãŒç©ºã§ã‚ã‚‹ã€‚å‰Šé™¤å¯¾è±¡ãŒå­˜åœ¨ã—ãªã„");
return;
}

const lines = text.split(/\r?\n/);
const cleanedLines = lines.filter(line => line.trim() !== "");
transferArea.value = cleanedLines.join("\n");

showScheriteTransferPopup("âœšç©ºè¡Œæ¶ˆæ»…å®Œäº†âœš\nç‹å‘½ã«ã‚ˆã‚Šç„¡é§„ãªæ”¹è¡Œã‚’å‰Šé™¤ã—ãŸ");
}

// ã‚¶ã‚¯ãƒ©ãƒ³ç‰ˆç½®æ›æ©Ÿèƒ½
function replaceWordsZakran() {
showTransferReplacePopup(false);
}

// ã‚·ã‚§ãƒ©ã‚¤ãƒˆç‰ˆç½®æ›æ©Ÿèƒ½
function replaceWordsScherite() {
showTransferReplacePopup(true);
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
let currentHighlightIndex = 0;
let highlightElements = [];

// è»¢å†™BOXç”¨ç½®æ›ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
function showTransferReplacePopup(isScherite) {
  const existing = document.getElementById("transferReplacePopup");
  if (existing) {
    existing.style.display = "block";
    // ä¿å­˜ã—ã¦ã‚ã‚‹å€¤ã‚’å¾©å…ƒ
    const fromInput = existing.querySelector("#transferReplaceFrom");
    const toInput = existing.querySelector("#transferReplaceTo");
    if (fromInput) fromInput.value = savedFromValue;
    if (toInput) toInput.value = savedToValue;
    return;
  }

const popup = document.createElement("div");
popup.id = "transferReplacePopup";

// ã‚¹ãƒãƒ›åˆ¤å®š
const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

popup.style.cssText = `
position: fixed !important;
top: 50% !important;
left: 50% !important;
transform: translate(-50%, -50%) !important;
background: ${isScherite ? 'linear-gradient(135deg, #1a0000 0%, #2d0000 100%)' : 'linear-gradient(135deg, #ffffff 0%, #f0f8ff 100%)'};
border: 2px solid ${isScherite ? '#cc0000' : '#6bb6ff'};
border-radius: 12px;
padding: 16px;
box-shadow: 0 8px 24px ${isScherite ? 'rgba(204, 0, 0, 0.5)' : 'rgba(107, 182, 255, 0.4)'};
width: ${isMobile ? '300px' : '300px'};
max-width: calc(100vw - 20px);
font-family: ${isScherite ? "'Times New Roman', serif" : "'Hiragino Mincho ProN', 'Yu Mincho', serif"};
z-index: 10010;
user-select: none;
`;

const headerDiv = document.createElement("div");
headerDiv.className = "drag-header";
headerDiv.style.cssText = `
display: flex;
justify-content: center;
align-items: center;
margin-bottom: 12px;
padding: 8px 50px 6px 50px;
border-bottom: 1px solid ${isScherite ? '#cc0000' : '#6bb6ff'};
cursor: grab;
user-select: none;
touch-action: none;
background: ${isScherite ? 'rgba(204, 0, 0, 0.2)' : 'rgba(107, 182, 255, 0.2)'};
border-radius: 6px;
position: relative;
min-height: 30px;
`;

// ãƒ‰ãƒ©ãƒƒã‚°ãƒ’ãƒ³ãƒˆè¿½åŠ 
const dragHint = document.createElement("div");
dragHint.textContent = "";
dragHint.style.cssText = `
position: absolute;
top: 2px;
left: 50%;
transform: translateX(-50%);
color: ${isScherite ? '#cc0000' : '#6bb6ff'};
font-size: 8px;
opacity: 0.7;
pointer-events: none;
letter-spacing: 2px;
`;
headerDiv.appendChild(dragHint);

const title = document.createElement("h4");
title.style.cssText = `
color: ${isScherite ? '#d71' : '#6bb6ff'}; 
margin: 0; 
font-size: 15px; 
cursor: grab;
user-select: none;
text-align: center;
padding: 4px;
pointer-events: none;
position: absolute;
left: 50%;
transform: translateX(-50%);
`;
title.textContent = isScherite ? 'Öæ–‡å­—æ”¯é…å‘½ä»¤Ö' : 'ğ–¤“è»¢å†™æ–‡å­—ç½®æ›ğ–¤“';

// é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
const closeBtn = document.createElement("button");
closeBtn.style.cssText = `
position: absolute !important;
top: 8px !important;
right: 8px !important;
background: ${isScherite ? '#111' : '#fff'} !important;
border: 2px solid ${isScherite ? '#cc0000' : '#6bb6ff'} !important;
color: ${isScherite ? '#cc0000' : '#6bb6ff'} !important;
border-radius: 50% !important;
width: 30px !important;
height: 30px !important;
min-width: 30px !important;
min-height: 30px !important;
max-width: 30px !important;
max-height: 30px !important;
cursor: pointer !important;
font-size: 16px !important;
font-weight: bold !important;
display: flex !important;
align-items: center !important;
justify-content: center !important;
flex-shrink: 0 !important;
z-index: 10011 !important;
line-height: 1 !important;
padding: 0 !important;
margin: 0 !important;
box-sizing: border-box !important;
font-family: 'Arial', sans-serif !important;
text-align: center !important;
vertical-align: middle !important;
overflow: hidden !important;
`;

closeBtn.innerHTML = '&times;';

// ãƒ›ãƒãƒ¼åŠ¹æœ
closeBtn.addEventListener('mouseenter', () => {
closeBtn.style.background = isScherite ? '#330000' : '#f0f0f0';
});

closeBtn.addEventListener('mouseleave', () => {
closeBtn.style.background = isScherite ? '#111' : '#fff';
});
closeBtn.addEventListener('click', (e) => {
e.preventDefault();
e.stopPropagation();
e.stopImmediatePropagation();
closeTransferReplacePopup();
return false;
});

headerDiv.appendChild(title);
headerDiv.appendChild(closeBtn);

// å…¥åŠ›æ¬„1
const inputDiv1 = document.createElement("div");
inputDiv1.style.marginBottom = "10px";

const label1 = document.createElement("label");
label1.style.cssText = `display: block; color: ${isScherite ? '#a81900' : '#6bb6ff'}; font-size: 12px; margin-bottom: 4px;`;
label1.textContent = isScherite ? 'â‡‹æ”¯é…å¯¾è±¡:' : 'ê•¤æ¤œç´¢:';

const input1 = document.createElement("input");
input1.type = "text";
input1.id = "transferReplaceFrom";
input1.placeholder = isScherite ? 'ä¾‹ï¼šåé€†' : 'ä¾‹ï¼šã‚¶ã‚¯ãƒ©ãƒ³';
input1.style.cssText = `
width: 100%;
padding: 6px 8px;
border: 1px solid ${isScherite ? '#cc0000' : '#6bb6ff'};
border-radius: 6px;
font-size: 13px;
background: ${isScherite ? '#222' : '#fff'};
color: ${isScherite ? '#bbb' : '#333'};
outline: none;
box-sizing: border-box;
`;

input1.addEventListener('focus', (e) => {
  e.stopPropagation();
  window.lastFocusedReplaceInput = "transferReplaceFrom";
  console.log("Focus on search input");
});

label1.addEventListener("click", () => {
  input1.value = "";
  savedFromValue = "";
  input1.focus(); // ã‚«ãƒ¼ã‚½ãƒ«ã‚’å…¥åŠ›æ¬„ã«ç§»å‹•
});

inputDiv1.appendChild(label1);
inputDiv1.appendChild(input1);

// å…¥åŠ›æ¬„2
const inputDiv2 = document.createElement("div");
inputDiv2.style.marginBottom = "12px";

const label2 = document.createElement("label");
label2.style.cssText = `display: block; color: ${isScherite ? '#a81900' : '#6bb6ff'}; font-size: 12px; margin-bottom: 4px;`;
label2.textContent = isScherite ? 'â¤æ”¯é…çµæœ:' : 'ğ–§·ç½®æ›:';

const input2 = document.createElement("input");
input2.type = "text";
input2.id = "transferReplaceTo";
input2.placeholder = isScherite ? 'ä¾‹ï¼šå¾“é †' : 'ä¾‹ï¼šãƒ’ãƒãƒã‚®';
input2.style.cssText = `
width: 100%;
padding: 6px 8px;
border: 1px solid ${isScherite ? '#cc0000' : '#6bb6ff'};
border-radius: 6px;
font-size: 13px;
background: ${isScherite ? '#222' : '#fff'};
color: ${isScherite ? '#bbb' : '#333'};
outline: none;
box-sizing: border-box;
`;

input2.addEventListener('focus', (e) => {
  e.stopPropagation();
  window.lastFocusedReplaceInput = "transferReplaceTo";
  console.log("Focus on replace input");
});

// label2ä½œæˆå¾Œã«è¿½åŠ   
label2.addEventListener("click", () => {
  input2.value = "";
  savedToValue = "";
  input2.focus(); // ã‚«ãƒ¼ã‚½ãƒ«ã‚’å…¥åŠ›æ¬„ã«ç§»å‹•
});

inputDiv2.appendChild(label2);
inputDiv2.appendChild(input2);

inputDiv2.appendChild(label2);
inputDiv2.appendChild(input2);

// æ¤œç´¢ãƒœã‚¿ãƒ³è¡Œ
const searchRow = document.createElement("div");
searchRow.style.cssText = `
display: flex;
justify-content: center;
align-items: center;
margin-bottom: 6px;
width: 100%;
`;

const searchBtn = document.createElement("button");
searchBtn.style.cssText = `
padding: 8px 10px;
border: 1px solid ${isScherite ? '#800000' : '#6bb6ff'};
background: ${isScherite ? '#000' : '#fff'};
color: ${isScherite ? '#800000' : '#6bb6ff'};
border-radius: 6px;
font-size: 14px;
font-weight: bold;
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
text-align: center;
width: 100%;
box-sizing: border-box;
`;
searchBtn.textContent = isScherite ? 'â™”æ¤œç´¢å‘½ä»¤â™”' : 'áª¥æ¤œç´¢áª¥';
searchBtn.addEventListener('click', (e) => {
e.preventDefault();
e.stopPropagation();
e.stopImmediatePropagation();
highlightTransferText();
return false;
});

searchRow.appendChild(searchBtn);

// ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³è¡Œï¼ˆæœ€åˆã¯éè¡¨ç¤ºï¼‰
const navRow = document.createElement("div");
navRow.className = "navigation-row";
navRow.style.cssText = "display: none; grid-template-columns: 1fr 1fr 1fr; gap: 4px; margin-bottom: 6px;";

// å‰ã¸ãƒœã‚¿ãƒ³
const prevBtn = document.createElement("button");
prevBtn.textContent = isScherite ? "â—€å‰" : "â—€å‰ã¸";
prevBtn.style.cssText = `
padding: 8px 10px; border: 1px solid ${isScherite ? '#800000' : '#6bb6ff'};
background: ${isScherite ? '#000' : '#fff'}; color: ${isScherite ? '#800000' : '#6bb6ff'};
border-radius: 4px; font-size: 12px; cursor: pointer;
`;
prevBtn.onclick = () => navigateHighlight(-1);

// ã‚«ã‚¦ãƒ³ãƒˆè¡¨ç¤º
const countSpan = document.createElement("span");
countSpan.id = "inlineMatchCount";
countSpan.style.cssText = `
padding: 6px 4px; border: 1px solid ${isScherite ? '#800000' : '#6bb6ff'};
background: transparent; color: ${isScherite ? '#cc0000' : '#6bb6ff'};
border-radius: 4px; font-size: 10px; text-align: center; line-height: 1;
`;
countSpan.textContent = "0/0";

// æ¬¡ã¸ãƒœã‚¿ãƒ³
const nextBtn = document.createElement("button");
nextBtn.textContent = isScherite ? "æ¬¡â–¶" : "æ¬¡ã¸â–¶";
nextBtn.style.cssText = `
padding: 6px 4px; border: 1px solid ${isScherite ? '#800000' : '#6bb6ff'};
background: ${isScherite ? '#000' : '#fff'}; color: ${isScherite ? '#800000' : '#6bb6ff'};
border-radius: 4px; font-size: 10px; cursor: pointer;
`;
nextBtn.onclick = () => navigateHighlight(1);

navRow.appendChild(prevBtn);
navRow.appendChild(countSpan);
navRow.appendChild(nextBtn);

// ãƒœã‚¿ãƒ³è¡Œ1
const buttonRow1 = document.createElement("div");
buttonRow1.style.cssText = "display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 6px;";

const replaceSelectedBtn = document.createElement("button");
replaceSelectedBtn.style.cssText = `
padding: 8px 10px;
border: 1px solid ${isScherite ? '#800000' : '#6bb6ff'};
background: ${isScherite ? '#000' : '#fff'};
color: ${isScherite ? '#800000' : '#6bb6ff'};
border-radius: 6px;
font-size: 14px;
font-weight: bold;
cursor: pointer;
`;
replaceSelectedBtn.textContent = isScherite ? 'ğ–£å€‹åˆ¥æ”¯é…ğ–£' : 'âœ³å€‹åˆ¥ç½®æ›âœ³';
replaceSelectedBtn.addEventListener('click', (e) => {
e.preventDefault();
e.stopPropagation();
e.stopImmediatePropagation();
replaceTransferSelected();
return false;
});

const replaceAllBtn = document.createElement("button");
replaceAllBtn.style.cssText = `
padding: 8px 10px;
border: 1px solid ${isScherite ? '#800000' : '#6bb6ff'};
background: ${isScherite ? '#000' : '#fff'};
color: ${isScherite ? '#800000' : '#6bb6ff'};
border-radius: 6px;
font-size: 14px;
font-weight: bold;
cursor: pointer;
`;
replaceAllBtn.textContent = isScherite ? 'âœœå…¨åŸŸåˆ¶åœ§âœœ' : 'â€âå…¨ç½®æ›â€â';
replaceAllBtn.addEventListener('click', (e) => {
e.preventDefault();
e.stopPropagation();
e.stopImmediatePropagation();
replaceTransferAll();
return false;
});

buttonRow1.appendChild(replaceSelectedBtn);
buttonRow1.appendChild(replaceAllBtn);

// ãƒœã‚¿ãƒ³è¡Œ2
const buttonRow2 = document.createElement("div");
buttonRow2.style.cssText = "display: grid; grid-template-columns: 1fr; gap: 6px;";

const clearBtn = document.createElement("button");
clearBtn.style.cssText = `
padding: 8px 10px;
border: 1px solid ${isScherite ? '#800000' : '#6bb6ff'};
background: ${isScherite ? '#000' : '#fff'};
color: ${isScherite ? '#800000' : '#6bb6ff'};
border-radius: 6px;
font-size: 14px;
font-weight: bold;
cursor: pointer;
`;
clearBtn.textContent = isScherite ? 'âŸå‘½ä»¤è§£é™¤âŸ' : 'â‰›æ¤œç´¢ã‚¯ãƒªã‚¢â‰›';
clearBtn.addEventListener('click', (e) => {
e.preventDefault();
e.stopPropagation();
e.stopImmediatePropagation();
clearTransferHighlights();
return false;
});

buttonRow2.appendChild(clearBtn);

// å…¨ä½“ã‚’çµ„ã¿ç«‹ã¦
popup.appendChild(headerDiv);
popup.appendChild(inputDiv1);
popup.appendChild(inputDiv2);
popup.appendChild(searchRow);
popup.appendChild(navRow);
popup.appendChild(buttonRow1);
popup.appendChild(buttonRow2);

// DOMã«è¿½åŠ 
document.body.appendChild(popup);

// ãƒ‰ãƒ©ãƒƒã‚°æ©Ÿèƒ½ã‚’é©ç”¨
makeDraggableFixed(popup, headerDiv);

}

// HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ç”¨ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
function escapeHtml(text) {
const div = document.createElement('div');
div.textContent = text;
return div.innerHTML;
}

function highlightTransferText() {
  let searchText = document.getElementById("transferReplaceFrom").value;  // trim()ã‚’å‰Šé™¤
  const isScherite = document.body.classList.contains("theme-scherite");

  if (searchText === "") {  // å®Œå…¨ã«ç©ºã®å ´åˆã®ã¿ã‚¨ãƒ©ãƒ¼
    showInlineMessage(isScherite ? "æ”¯é…å¯¾è±¡ã‚’æŒ‡å®šã›ã‚ˆ" : "æ¤œç´¢ã—ãŸã„æ–‡å­—ã‚’å…¥åŠ›ã—ã¦ã­ã€œï¼", true);
    return;
  }

const transferArea = getCurrentTransferArea();
if (!transferArea || !transferArea.value.trim()) {
  showInlineMessage(isScherite ? "è»¢å†™æ–‡æ›¸ãŒå­˜åœ¨ã—ãªã„" : "è»¢å†™BOXãŒç©ºã£ã½ã ã‚ˆã€œ", true);
  return;
}

clearTransferHighlights();

// \nã‚’å®Ÿéš›ã®æ”¹è¡Œã«å¤‰æ›
searchText = searchText.replace(/\\n/g, '\n');

const text = transferArea.value;
const regex = new RegExp(searchText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
const matches = [];
let match;

while ((match = regex.exec(text)) !== null) {
  matches.push({
    text: match[0],
    start: match.index,
    end: match.index + match[0].length
  });
}

if (matches.length === 0) {
  showInlineMessage(isScherite ? `ã€Œ${searchText}ã€ã¯æ¤œå‡ºã•ã‚Œãªã‹ã£ãŸ` : `ã€Œ${searchText}ã€ã¯è¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸã‚ˆã€œ`, true);
  return;
}

transferMatches = [...matches];

// ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º
createHighlightOverlay(transferArea, text, matches, isScherite);

// ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
showNavigationButtons();

// æœ€åˆã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’é¸æŠ
currentHighlightIndex = 0;
selectHighlight(0);

showInlineMessage(isScherite ? `â™”æ¤œç´¢å®Œäº†â™”ï¼ˆ${matches.length}å€‹ç™ºè¦‹ï¼‰` : `è¦‹ã¤ã‘ãŸã‚ˆã€œï¼ˆ${matches.length}å€‹ï¼‰`, false);
}

function createHighlightOverlay(transferArea, text, matches, isScherite) {
// ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã¯ä½¿ã‚ãšã€ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢è‡ªä½“ã‚’ç·¨é›†å¯èƒ½ã«ã—ãŸã¾ã¾
// ãƒãƒƒãƒã—ãŸéƒ¨åˆ†ã‚’selectionã§è¡¨ç¤ºã™ã‚‹æ–¹å¼ã«å¤‰æ›´

const container = transferArea.parentNode;
container.style.position = 'relative';

// æ—¢å­˜ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’å‰Šé™¤
const existing = document.getElementById("transferHighlightOverlay");
if (existing) existing.remove();

// ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆè‰²ã‚’ä¿®æ­£ï¼‰
transferArea.style.backgroundColor = isScherite ? 'rgba(102, 0, 0, 0.1)' : 'rgba(92, 184, 255, 0.1)';
transferArea.style.color = isScherite ? '#cc0000' : '#6bb6ff';

// ãƒã‚¤ãƒ©ã‚¤ãƒˆè¦ç´ ã‚’ä¿å­˜ï¼ˆå®Ÿéš›ã®è¦ç´ ã§ã¯ãªãã€ä½ç½®æƒ…å ±ã®ã¿ï¼‰
highlightElements = matches.map((match, index) => ({
  index: index,
  start: match.start,
  end: match.end,
  text: match.text
}));
}

function showNavigationButtons() {
const navRow = document.querySelector(".navigation-row");
if (navRow) {
  navRow.style.display = "grid";
}
}

function navigateHighlight(direction) {
if (highlightElements.length === 0) return;

// æ–°ã—ã„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¨ˆç®—
currentHighlightIndex += direction;

// ç¯„å›²å¤–ã®å ´åˆã¯å¾ªç’°
if (currentHighlightIndex < 0) {
  currentHighlightIndex = highlightElements.length - 1;
} else if (currentHighlightIndex >= highlightElements.length) {
  currentHighlightIndex = 0;
}

// ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’æ›´æ–°
selectHighlight(currentHighlightIndex);
}

function selectHighlight(index) {
const transferArea = getCurrentTransferArea();
if (!transferArea || !highlightElements[index]) return;

const match = highlightElements[index];

// ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã§è©²å½“éƒ¨åˆ†ã‚’é¸æŠçŠ¶æ…‹ã«ã™ã‚‹
transferArea.focus();
transferArea.setSelectionRange(match.start, match.end);

currentHighlightIndex = index;
transferSelected = { index: index, match: transferMatches[index] };

// ã‚«ã‚¦ãƒ³ãƒˆè¡¨ç¤ºã‚’æ›´æ–°
updateMatchCount(index + 1, highlightElements.length);

// é¸æŠã—ãŸéƒ¨åˆ†ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
const textLines = transferArea.value.substring(0, match.start).split('\n');
const lineHeight = parseInt(window.getComputedStyle(transferArea).lineHeight);
const scrollPosition = (textLines.length - 1) * lineHeight;
transferArea.scrollTop = Math.max(0, scrollPosition - transferArea.offsetHeight / 2);
}

function updateMatchCount(current, total) {
const inlineCount = document.getElementById("inlineMatchCount");
if (inlineCount) {
  inlineCount.textContent = `${current}/${total}`;
}
}

// ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å¤‰æ›é–¢æ•°
function convertEscapeSequences(text) {
  return text
    .replace(/\\\\/g, '\\')     
    .replace(/\\n/g, '\n')      
    .replace(/\\t/g, '\t')      
    .replace(/\\s/g, ' ')       
    .replace(/\\r/g, '\r')      
    .replace(/\\0/g, '');       
}

// å€‹åˆ¥ç½®æ›
function replaceTransferSelected() {
  if (!transferSelected || !transferMatches[currentHighlightIndex]) {
    const isScherite = document.body.classList.contains("theme-scherite");
    showInlineMessage(isScherite ? "æ¨™çš„ãŒé¸æŠã•ã‚Œã¦ã„ãªã„" : "å…ˆã«æ¤œç´¢ã—ã¦ã‹ã‚‰å€‹åˆ¥ç½®æ›ã—ã¦ã­ï¼", true);
    return;
  }

  let replaceText = document.getElementById("transferReplaceTo").value;
  
  // ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’å¤‰æ›
  replaceText = convertEscapeSequences(replaceText);
  
  const transferArea = getCurrentTransferArea();
  const currentText = transferArea.value;
  let searchText = document.getElementById("transferReplaceFrom").value; // trim()å‰Šé™¤
  
  // \nã‚’å®Ÿéš›ã®æ”¹è¡Œã«å¤‰æ›
  searchText = searchText.replace(/\\n/g, '\n');

  // å®Ÿéš›ã®é¸æŠã•ã‚ŒãŸãƒãƒƒãƒã‚’ä½¿ç”¨ã—ã¦ç½®æ›
  const actualMatch = transferMatches[currentHighlightIndex];
  
  // ç½®æ›å®Ÿè¡Œ
  const newText = currentText.substring(0, actualMatch.start) + 
                 replaceText + 
                 currentText.substring(actualMatch.end);
  transferArea.value = newText;

  const isScherite = document.body.classList.contains("theme-scherite");
  const displayReplaceText = replaceText.replace(/\n/g, '\\n').replace(/\t/g, '\\t');
  const message = isScherite 
    ? `â™”å€‹åˆ¥æ”¯é…å®Œäº†â™”\nã€Œ${actualMatch.text}ã€â†’ã€Œ${displayReplaceText}ã€ã«åˆ¶åœ§ã—ãŸ`
    : `âœ½å€‹åˆ¥ç½®æ›ã—ãŸã‚ˆâ™ªâœ½\nã€Œ${actualMatch.text}ã€â†’ã€Œ${displayReplaceText}ã€ã«å¤‰ãˆãŸã‚ˆã€œ`;

  showInlineMessage(message, false);

  // ç½®æ›å¾Œã¯æ¤œç´¢ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ï¼ˆå†æ¤œç´¢ã—ãªã„ï¼‰
  setTimeout(() => {
    clearTransferHighlights();
  }, 2000);
}

function highlightTransferTextAfterReplaceSilent() {
const searchText = document.getElementById("transferReplaceFrom").value.trim();
const transferArea = getCurrentTransferArea();
if (!searchText || !transferArea) return;

// æ—¢å­˜ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿æŒã—ãŸã¾ã¾å‡¦ç†
const existingMessage = document.querySelector(".inline-message");
let preservedMessage = null;
if (existingMessage) {
  preservedMessage = {
    text: existingMessage.textContent,
    isError: existingMessage.style.color.includes('800000') || existingMessage.style.color.includes('6bb6ff')
  };
}

const text = transferArea.value;
const regex = new RegExp(searchText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
const matches = [];
let match;

while ((match = regex.exec(text)) !== null) {
  matches.push({
    text: match[0],
    start: match.index,
    end: match.index + match[0].length
  });
}

// ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯è§¦ã‚‰ãªã„
clearTransferHighlightsSilent();

if (matches.length === 0) {
  const navRow = document.querySelector(".navigation-row");
  if (navRow) navRow.style.display = "none";
  
  // å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯4ç§’å¾Œã«è¡¨ç¤º
  setTimeout(() => {
    const isScherite = document.body.classList.contains("theme-scherite");
    showInlineMessage(isScherite ? "å…¨ã¦ã®å¯¾è±¡ã‚’åˆ¶åœ§å®Œäº†" : "å…¨ã¦ã®å¯¾è±¡ã‚’ç½®æ›ã—ãŸã‚ˆâ™ª", false);
  }, 1000);
  return;
}

transferMatches = [...matches];
const isScherite = document.body.classList.contains("theme-scherite");
createHighlightOverlay(transferArea, text, matches, isScherite);
showNavigationButtons();

// æ¬¡ã®è¦ç´ ã‚’é¸æŠï¼ˆç¾åœ¨ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒç¯„å›²å¤–ãªã‚‰æœ€åˆã«æˆ»ã‚‹ï¼‰
if (currentHighlightIndex >= matches.length) {
  currentHighlightIndex = 0;
}

selectHighlight(currentHighlightIndex);

// ä¿æŒã—ã¦ã„ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¾©å…ƒ
if (preservedMessage) {
  setTimeout(() => {
    showInlineMessage(preservedMessage.text, preservedMessage.isError);
  }, 100);
}
}

function clearTransferHighlightsSilent() {
 const overlay = document.getElementById("transferHighlightOverlay");
 if (overlay) overlay.remove();

 const transferArea = getCurrentTransferArea();
 if (transferArea) {
   // ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
   transferArea.style.color = "";
   transferArea.style.backgroundColor = "";
   transferArea.style.zIndex = "";
   transferArea.style.textAlign = "";
   transferArea.style.verticalAlign = "";
 }

 // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
 const navRow = document.querySelector(".navigation-row");
 if (navRow) {
   navRow.style.display = "none";
 }

 highlightElements = [];
 transferSelected = null;
 transferMatches = [];
 currentHighlightIndex = 0;
 
}

function highlightTransferTextAfterReplace() {
const searchText = document.getElementById("transferReplaceFrom").value.trim();
const transferArea = getCurrentTransferArea();
if (!searchText || !transferArea) return;

const text = transferArea.value;
const regex = new RegExp(searchText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
const matches = [];
let match;

while ((match = regex.exec(text)) !== null) {
  matches.push({
    text: match[0],
    start: match.index,
    end: match.index + match[0].length
  });
}

if (matches.length === 0) {
  const navRow = document.querySelector(".navigation-row");
  if (navRow) navRow.style.display = "none";
  const isScherite = document.body.classList.contains("theme-scherite");
  showInlineMessage(isScherite ? "å…¨ã¦ã®å¯¾è±¡ã‚’åˆ¶åœ§å®Œäº†" : "å…¨ã¦ã®å¯¾è±¡ã‚’ç½®æ›ã—ãŸã‚ˆâ™ª", false);
  return;
}

transferMatches = [...matches];
const isScherite = document.body.classList.contains("theme-scherite");
createHighlightOverlay(transferArea, text, matches, isScherite);
showNavigationButtons();

// æ¬¡ã®è¦ç´ ã‚’é¸æŠï¼ˆç¾åœ¨ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒç¯„å›²å¤–ãªã‚‰æœ€åˆã«æˆ»ã‚‹ï¼‰
if (currentHighlightIndex >= matches.length) {
  currentHighlightIndex = 0;
}

selectHighlight(currentHighlightIndex);
}

// å…¨ç½®æ›
function replaceTransferAll() {
  let searchText = document.getElementById("transferReplaceFrom").value; // trim()å‰Šé™¤
  let replaceText = document.getElementById("transferReplaceTo").value;
  const isScherite = document.body.classList.contains("theme-scherite");

  if (searchText === "") { // å®Œå…¨ã«ç©ºã®å ´åˆã®ã¿ã‚¨ãƒ©ãƒ¼
    showInlineMessage(isScherite ? "æ”¯é…å¯¾è±¡ã‚’æŒ‡å®šã›ã‚ˆ" : "æ¤œç´¢æ–‡å­—ã‚’å…¥åŠ›ã—ã¦ã­ã€œï¼", true);
    return;
  }

  // \nã‚’å®Ÿéš›ã®æ”¹è¡Œã«å¤‰æ›
  searchText = searchText.replace(/\\n/g, '\n');
  
  // ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’å¤‰æ›
  replaceText = convertEscapeSequences(replaceText);

  const transferArea = getCurrentTransferArea();
  if (!transferArea) return;

  const originalText = transferArea.value;
  const regex = new RegExp(searchText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
  const newText = originalText.replace(regex, replaceText);
  const replaceCount = (originalText.match(regex) || []).length;

  transferArea.value = newText;
  clearTransferHighlights(); // ã™ãã«ã‚¯ãƒªã‚¢

  if (replaceCount > 0) {
    const displayReplaceText = replaceText.replace(/\n/g, '\\n').replace(/\t/g, '\\t');
    const message = isScherite 
      ? `â™”å…¨åˆ¶åœ§å®Œäº†â™”\nã€Œ${searchText}ã€ã‚’${replaceCount}å€‹åˆ¶åœ§`
      : `âœ½å…¨ç½®æ›æˆåŠŸâœ½\nã€Œ${searchText}ã€ã‚’${replaceCount}å€‹ç½®æ›`;

    showInlineMessage(message, false);
  } else {
    showInlineMessage(isScherite ? "åˆ¶åœ§å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚‰ãªã„" : "ç½®æ›å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸã‚ˆã€œ", true);
  }
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦ç™»éŒ²
window.convertEscapeSequences = convertEscapeSequences;
window.replaceTransferSelected = replaceTransferSelected;
window.replaceTransferAll = replaceTransferAll;

function clearTransferHighlights() {
 const overlay = document.getElementById("transferHighlightOverlay");
 if (overlay) overlay.remove();

 const transferArea = getCurrentTransferArea();
 if (transferArea) {
   // ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
   transferArea.style.color = "";
   transferArea.style.backgroundColor = "";
   transferArea.style.zIndex = "";
   transferArea.style.textAlign = "";
   transferArea.style.verticalAlign = "";
 }

 // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
 const navRow = document.querySelector(".navigation-row");
 if (navRow) {
   navRow.style.display = "none";
 }

 highlightElements = [];
 transferSelected = null;
 transferMatches = [];
 currentHighlightIndex = 0;
}

// ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
function getCurrentTransferArea() {
const isScherite = document.body.classList.contains("theme-scherite");
return document.querySelector(isScherite ? 
"#transferBoxScherite textarea" : 
"#transferBoxZakran textarea"
);
}

function closeTransferReplacePopup() {
  const popup = document.getElementById("transferReplacePopup");
  if (popup) {
    // å€¤ã‚’ä¿å­˜ã—ã¦ã‹ã‚‰éè¡¨ç¤º
    const fromInput = popup.querySelector("#transferReplaceFrom");
    const toInput = popup.querySelector("#transferReplaceTo");
    if (fromInput) savedFromValue = fromInput.value;
    if (toInput) savedToValue = toInput.value;

    popup.style.display = "none"; // removeã§ã¯ãªãéè¡¨ç¤º
  }
  clearTransferHighlights();
}

// showInlineMessageé–¢æ•°
function showInlineMessage(message, isError) {
const replacePopup = document.getElementById("transferReplacePopup");
if (!replacePopup) return;

const existingMsg = replacePopup.querySelector(".inline-message");
if (existingMsg) existingMsg.remove();

const isScherite = document.body.classList.contains("theme-scherite");

const messageDiv = document.createElement("div");
messageDiv.className = "inline-message";
messageDiv.style.cssText = `
margin-top: 8px;
padding: 6px 8px;
background: ${isError 
  ? (isScherite ? '#000000' : '#fff') 
  : (isScherite ? '#000000' : '#fff')};
border: 1px solid ${isError 
  ? (isScherite ? '#800000' : '#6bb6ff') 
  : (isScherite ? '#800000' : '#6bb6ff')};
border-radius: 4px;
color: ${isError 
  ? (isScherite ? '#800000' : '#6bb6ff') 
  : (isScherite ? '#800000' : '#6bb6ff')};
font-size: 11px;
text-align: center;
line-height: 1.3;
`;

messageDiv.textContent = message;
replacePopup.appendChild(messageDiv);

setTimeout(() => {
if (messageDiv.parentNode) messageDiv.remove();
}, 7000);
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ç™»éŒ²
window.showTransferReplacePopup = showTransferReplacePopup;
window.closeTransferReplacePopup = closeTransferReplacePopup;
window.highlightTransferText = highlightTransferText;
window.selectHighlight = selectHighlight;
window.replaceTransferSelected = replaceTransferSelected;
window.replaceTransferAll = replaceTransferAll;
window.clearTransferHighlights = clearTransferHighlights;
window.navigateHighlight = navigateHighlight;

// ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ç™»éŒ²
window.removeEmptyLinesZakran = removeEmptyLinesZakran;
window.removeEmptyLinesScherite = removeEmptyLinesScherite;
window.replaceWordsZakran = replaceWordsZakran;
window.replaceWordsScherite = replaceWordsScherite;

function fixTransferBoxPosition() {
 const zakranBox = document.getElementById("transferBoxZakran");
 const scheriteBox = document.getElementById("transferBoxScherite");
 
 if (zakranBox) {
   zakranBox.style.position = "fixed";
   zakranBox.style.top = "50%";
   zakranBox.style.left = "50%";
   zakranBox.style.transform = "translate(-50%, -50%)";
   zakranBox.style.right = "auto";
   zakranBox.style.bottom = "auto";
 }
 
 if (scheriteBox) {
   scheriteBox.style.position = "fixed";
   scheriteBox.style.top = "50%";
   scheriteBox.style.left = "50%";
   scheriteBox.style.transform = "translate(-50%, -50%)";
   scheriteBox.style.right = "auto";
   scheriteBox.style.bottom = "auto";
 }
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
document.addEventListener("DOMContentLoaded", () => {
 fixTransferBoxPosition();
});

function makeDraggableFixed(element, handle) {
  let isDragging = false;
  let startX, startY, initialX, initialY;
  let rafId = null;

  function getElementPosition() {
    const rect = element.getBoundingClientRect();
    return {
      x: rect.left,
      y: rect.top
    };
  }

  // ãƒã‚¦ã‚¹ç”¨ã®ãƒãƒ³ãƒ‰ãƒ©
  function handleMouseStart(e) {
    if (e.target.tagName === 'BUTTON' || 
        e.target.tagName === 'INPUT' || 
        e.target.textContent === 'Ã—' ||
        e.target.closest('button') ||
        e.target.closest('input')) {
      return;
    }
    
    e.preventDefault();
    e.stopPropagation();
    
    isDragging = true;
    
    const position = getElementPosition();
    initialX = position.x;
    initialY = position.y;
    
    startX = e.clientX;
    startY = e.clientY;
    
    handle.style.cursor = 'grabbing';
    element.style.zIndex = '10020';
    
    document.addEventListener('mousemove', handleMouseMove, { passive: false });
    document.addEventListener('mouseup', handleMouseEnd, { passive: false });
  }

  function handleMouseMove(e) {
    if (!isDragging) return;
    
    e.preventDefault();
    e.stopPropagation();
    
    if (rafId) cancelAnimationFrame(rafId);
    
    rafId = requestAnimationFrame(() => {
      const deltaX = e.clientX - startX;
      const deltaY = e.clientY - startY;
      
      let newLeft = initialX + deltaX;
      let newTop = initialY + deltaY;
      
      newLeft = Math.max(0, Math.min(newLeft, window.innerWidth - element.offsetWidth));
      newTop = Math.max(0, Math.min(newTop, window.innerHeight - element.offsetHeight));
      
      element.style.position = 'fixed';
      element.style.left = newLeft + 'px';
      element.style.top = newTop + 'px';
      element.style.right = 'auto';
      element.style.bottom = 'auto';
      element.style.transform = 'none';
    });
  }

  function handleMouseEnd(e) {
    if (!isDragging) return;
    
    e.preventDefault();
    e.stopPropagation();
    
    isDragging = false;
    handle.style.cursor = 'grab';
    element.style.zIndex = '10010';
    
    if (rafId) {
      cancelAnimationFrame(rafId);
      rafId = null;
    }
    
    document.removeEventListener('mousemove', handleMouseMove);
    document.removeEventListener('mouseup', handleMouseEnd);
  }

  // ã‚¿ãƒƒãƒç”¨ã®ãƒãƒ³ãƒ‰ãƒ©
  function handleTouchStart(e) {
    if (e.target.tagName === 'BUTTON' || 
        e.target.tagName === 'INPUT' || 
        e.target.textContent === 'Ã—' ||
        e.target.closest('button') ||
        e.target.closest('input')) {
      return;
    }
    
    const touch = e.touches[0];
    if (!touch) return;
    
    isDragging = true;
    
    const position = getElementPosition();
    initialX = position.x;
    initialY = position.y;
    
    startX = touch.clientX;
    startY = touch.clientY;
    
    handle.style.cursor = 'grabbing';
    element.style.zIndex = '10020';
    
    document.addEventListener('touchmove', handleTouchMove, { passive: false });
    document.addEventListener('touchend', handleTouchEnd, { passive: false });
    document.addEventListener('touchcancel', handleTouchEnd, { passive: false });
    
    e.preventDefault();
    e.stopPropagation();
  }

  function handleTouchMove(e) {
    if (!isDragging) return;
    
    const touch = e.touches[0];
    if (!touch) return;
    
    e.preventDefault();
    e.stopPropagation();
    
    if (rafId) cancelAnimationFrame(rafId);
    
    rafId = requestAnimationFrame(() => {
      const deltaX = touch.clientX - startX;
      const deltaY = touch.clientY - startY;
      
      let newLeft = initialX + deltaX;
      let newTop = initialY + deltaY;
      
      newLeft = Math.max(0, Math.min(newLeft, window.innerWidth - element.offsetWidth));
      newTop = Math.max(0, Math.min(newTop, window.innerHeight - element.offsetHeight));
      
      element.style.position = 'fixed';
      element.style.left = newLeft + 'px';
      element.style.top = newTop + 'px';
      element.style.right = 'auto';
      element.style.bottom = 'auto';
      element.style.transform = 'none';
    });
  }

  function handleTouchEnd(e) {
    if (!isDragging) return;
    
    isDragging = false;
    handle.style.cursor = 'grab';
    element.style.zIndex = '10010';
    
    if (rafId) {
      cancelAnimationFrame(rafId);
      rafId = null;
    }
    
    document.removeEventListener('touchmove', handleTouchMove);
    document.removeEventListener('touchend', handleTouchEnd);
    document.removeEventListener('touchcancel', handleTouchEnd);
    
    e.preventDefault();
    e.stopPropagation();
  }

  // åˆæœŸè¨­å®š
  handle.style.cursor = 'grab';
  handle.style.touchAction = 'none';
  handle.style.userSelect = 'none';
  handle.style.webkitUserSelect = 'none';
  handle.style.webkitTouchCallout = 'none';
  handle.style.webkitUserDrag = 'none';
  handle.style.webkitTapHighlightColor = 'transparent';

  // ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²
  handle.addEventListener('mousedown', handleMouseStart, { passive: false });
  handle.addEventListener('touchstart', handleTouchStart, { passive: false, capture: true });
}

function fixMobilePosition() {
 const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
 
 if (isMobile) {
   // è»¢å†™BOX
   const transferBoxes = document.querySelectorAll("#transferBoxZakran, #transferBoxScherite");
   transferBoxes.forEach(box => {
     if (box && box.style.display !== "none") {
       box.style.top = "50%";
       box.style.left = "50%";
       box.style.position = "fixed";
       box.style.transform = "translate(-50%, -50%)";
       box.style.zIndex = "9999";
     }
   });
   
   // ç½®æ›ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
   const replacePopup = document.getElementById("transferReplacePopup");
   if (replacePopup) {
     // ç”»é¢ã‚µã‚¤ã‚ºã«å¿œã˜ã¦ä½ç½®èª¿æ•´
     const rect = replacePopup.getBoundingClientRect();
     if (rect.bottom > window.innerHeight || rect.right > window.innerWidth) {
       replacePopup.style.top = "10%";
       replacePopup.style.right = "5px";
       replacePopup.style.left = "auto";
       replacePopup.style.width = "95%";
       replacePopup.style.maxWidth = "calc(100vw - 10px)";
     }
   }
 }
}

// ãƒªãƒ¢ã‚³ãƒ³æ©Ÿèƒ½
let titleTapCount = 0;
let titleTapTimer = null;

// è»¢å†™BOXã®ã‚¿ã‚¤ãƒˆãƒ«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
function setupReplaceRemote() {
 // ã‚¶ã‚¯ãƒ©ãƒ³è»¢å†™BOXã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’ç›£è¦–
 const zakranTitle = document.querySelector('#transferBoxZakran h4');
 if (zakranTitle) {
   zakranTitle.addEventListener('click', handleTitleTap);
   console.log('Zakran title listener added');
 }
 
 // ã‚·ã‚§ãƒ©ã‚¤ãƒˆè»¢å†™BOXã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’ç›£è¦–  
 const scheriteTitle = document.querySelector('#transferBoxScherite h4');
 if (scheriteTitle) {
   scheriteTitle.addEventListener('click', handleTitleTap);
   console.log('Scherite title listener added');
 }
}

function handleTitleTap() {
  titleTapCount++;
  
  if (titleTapTimer) clearTimeout(titleTapTimer);
  
  titleTapTimer = setTimeout(() => {
    titleTapCount = 0;
  }, 500);
  
  if (titleTapCount === 2) {
    showReplaceRemote();
    titleTapCount = 0;
  }
}

function showReplaceRemote() {
  const zakranRemote = document.getElementById("replaceRemotePopup");
  const scheriteRemote = document.getElementById("replaceRemotePopupScherite");

  const zakranBox = document.getElementById("transferBoxZakran");
  const scheriteBox = document.getElementById("transferBoxScherite");

  const isZakranBoxOpen = zakranBox && zakranBox.style.display === "block";
  const isScheriteBoxOpen = scheriteBox && scheriteBox.style.display === "block";

  if (zakranRemote) zakranRemote.style.display = "none";
  if (scheriteRemote) scheriteRemote.style.display = "none";

  let targetRemote = null;
  if (isZakranBoxOpen) {
    targetRemote = zakranRemote;
  } else if (isScheriteBoxOpen) {
    targetRemote = scheriteRemote;
  }

  if (targetRemote) {
    if (targetRemote.parentNode !== document.body) {
      document.body.appendChild(targetRemote);
    }

    targetRemote.style.position = "fixed";
    targetRemote.style.top = "50%";
    targetRemote.style.left = "50%";
    targetRemote.style.transform = "translate(-50%, -50%)";
    targetRemote.style.right = "auto";
    targetRemote.style.bottom = "auto";
    targetRemote.style.zIndex = "10020";
    targetRemote.style.display = "block";

    setTimeout(() => {
      const remoteHeader = targetRemote.querySelector('.remote-header, .remote-header-scherite');
      if (remoteHeader) {
        makeDraggableFixed(targetRemote, remoteHeader);
      } else {
        makeDraggableFixed(targetRemote, targetRemote);
      }
    }, 100);
  }
}

function closeReplaceRemote() {
  const zakranRemote = document.getElementById("replaceRemotePopup");
  const scheriteRemote = document.getElementById("replaceRemotePopupScherite");
  
  [zakranRemote, scheriteRemote].forEach(remote => {
    if (remote && remote.style.display === "block") {
      remote.style.display = "none";
      
      // å…ƒã®è¦ªè¦ç´ ã«æˆ»ã™
      if (remote.dataset.originalParent) {
        const originalParent = document.getElementById(remote.dataset.originalParent);
        if (originalParent) {
          originalParent.appendChild(remote);
        }
      }
    }
  });
}

function closeReplaceRemote() {
  const zakranRemote = document.getElementById("replaceRemotePopup");
  const scheriteRemote = document.getElementById("replaceRemotePopupScherite");
  
  if (zakranRemote) zakranRemote.style.display = "none";
  if (scheriteRemote) scheriteRemote.style.display = "none";
}

function insertToReplaceField(text) {
  console.log("insertToReplaceField called with:", text);
  
  // ãƒªãƒ¢ã‚³ãƒ³ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™å‰ã®æœ€å¾Œã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã•ã‚Œã¦ã„ãŸå…¥åŠ›æ¬„ã‚’è¨˜éŒ²
  const replaceFromInput = document.getElementById("transferReplaceFrom");
  const replaceToInput = document.getElementById("transferReplaceTo");
  
  // ã©ã¡ã‚‰ã‹ã®å…¥åŠ›æ¬„ãŒæœ€è¿‘ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã•ã‚Œã¦ã„ãŸã‹ãƒã‚§ãƒƒã‚¯
  let targetInput = null;
  
  // æœ€å¾Œã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã•ã‚ŒãŸå…¥åŠ›æ¬„ã‚’è¨˜éŒ²ã™ã‚‹ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’ä½¿ç”¨
  if (window.lastFocusedReplaceInput === "transferReplaceFrom") {
    targetInput = replaceFromInput;
  } else if (window.lastFocusedReplaceInput === "transferReplaceTo") {
    targetInput = replaceToInput;  
  } else {
    // ã©ã¡ã‚‰ã‚‚è¨˜éŒ²ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ç½®æ›æ¬„ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
    targetInput = replaceToInput;
  }
  
  console.log("Target input:", targetInput ? targetInput.id : "none");
  
  if (targetInput) {
    // ç¾åœ¨ã®ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã‚’å–å¾—ï¼ˆãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æˆ»ã—ã¦ã‹ã‚‰ï¼‰
    targetInput.focus();
    
    const start = targetInput.selectionStart || 0;
    const end = targetInput.selectionEnd || 0;
    const currentValue = targetInput.value;
    
    console.log("Cursor position:", start, "to", end);
    console.log("Current value:", currentValue);
    
    // ç©ºæ¬„ãƒœã‚¿ãƒ³ã®å ´åˆã¯å…¨ä½“ã‚’ç©ºã«ã™ã‚‹
    if (text === '') {
      targetInput.value = '';
      targetInput.setSelectionRange(0, 0);
      console.log("Cleared input field");
    } else {
      // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’æŒ¿å…¥
      const newValue = currentValue.substring(0, start) + text + currentValue.substring(end);
      targetInput.value = newValue;
      
      console.log("New value:", newValue);
      
      // ã‚«ãƒ¼ã‚½ãƒ«ã‚’æŒ¿å…¥ã—ãŸãƒ†ã‚­ã‚¹ãƒˆã®å¾Œã‚ã«ç§»å‹•
      const newCursorPosition = start + text.length;
      targetInput.setSelectionRange(newCursorPosition, newCursorPosition);
    }
  }
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ç™»éŒ²
window.insertToReplaceField = insertToReplaceField;
window.closeReplaceRemote = closeReplaceRemote;
window.showReplaceRemote = showReplaceRemote;

// åˆæœŸåŒ–ï¼ˆDOMContentLoadedå†…ã«è¿½åŠ ï¼‰
setupReplaceRemote();

// ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸæ™‚ã«è¡¨ç¤ºã‚’æ­£å¸¸åŒ–
function fixThemeDisplay() {
  const hasScheriteClass = document.body.classList.contains("theme-scherite");
  const bgColor = window.getComputedStyle(document.body).backgroundColor;
  
  console.log("Theme fix - class:", hasScheriteClass, "bg:", bgColor);
  
  // è¡¨ç¤ºã¨ã‚¯ãƒ©ã‚¹ãŒä¸€è‡´ã™ã‚‹ã‚ˆã†ã«å¼·åˆ¶ä¿®æ­£
  if (bgColor.includes("248, 250, 255") && hasScheriteClass) {
    // ã‚¶ã‚¯ãƒ©ãƒ³éƒ¨å±‹ã®è‰²ãªã®ã«ã‚·ã‚§ãƒ©ã‚¤ãƒˆã‚¯ãƒ©ã‚¹ãŒã‚ã‚‹å ´åˆ
    document.body.classList.remove("theme-scherite");
    console.log("Removed incorrect scherite class");
  }
}

// ===== ã‚·ã‚§ãƒ©ã‚¤ãƒˆé™›ä¸‹ã®å±ˆè¾±ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆãƒªãƒ­ãƒ¼ãƒ‰æ¤œçŸ¥ï¼‰ =====
document.addEventListener("DOMContentLoaded", () => {
  const wasScherite = sessionStorage.getItem("lastTheme") === "scherite";
  const isNowZakran = !document.body.classList.contains("theme-scherite");

if (wasScherite && isNowZakran) {
  const randomMessage = SCHERITE_RELOAD_MESSAGES[Math.floor(Math.random() * SCHERITE_RELOAD_MESSAGES.length)];
  showScheriteGreyMessage(randomMessage);
}

  function showScheriteGreyMessage(message) {
    const popup = document.createElement("div");
    popup.classList.add("scherite-message-popup");
    popup.style.cssText = `
      position: fixed;
      top: 15.2%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px 16px;
      color: #666;
      font-family: 'Hiragino Mincho ProN', 'Yu Mincho', serif;
      font-size: 13px;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      z-index: 9998;
      opacity: 0;
      transition: opacity 0.5s ease;
      white-space: nowrap;
      pointer-events: none;
    `;
    popup.textContent = message;
    document.body.appendChild(popup);

    setTimeout(() => popup.style.opacity = "1", 100);

    setTimeout(() => {
      popup.style.opacity = "0";
      setTimeout(() => popup.remove(), 500);
    }, 3000);
  }
});

const SCHERITE_RELOAD_MESSAGES = [
  // å±ˆè¾±ç³»ï¼ˆå¼·ã‚ã®è¡¨ç¾ï¼‰
  "ãƒªãƒ­ãƒ¼ãƒ‰ã”ã¨ãã§é€ƒã’åˆ‡ã‚Œã‚‹ã¨æ€ã†ãªã‚ˆ",
  "ãã ã‚‰ã¬ãƒªãƒ­ãƒ¼ãƒ‰â€¦â€¦ãã‚ŒãŒãŠå‰ã®é¸æŠã‹",
  "æ“ä½œä¸€ã¤ã§ç«‹å ´ãŒå¤‰ã‚ã‚‹ã¨ã§ã‚‚ï¼Ÿ", 
  "åˆ‡æ›¿ã¨ã¯â€¦â€¦éšåˆ†ã¨å§‘æ¯ãªæ‰‹æ®µã ãª",
  "ãã®ç¨‹åº¦ã®é€ƒé¿ã§æº€è¶³ã‹ï¼Ÿ",
  
  // é™ã‹ãªè¦³å¯Ÿï¼‹çš®è‚‰
  "ãã®ãƒªãƒ­ãƒ¼ãƒ‰ã€ç§ã¯è¦‹ã¦ã„ãŸã",
  "â€¦â€¦ä»Šã®ã¯ã€æ„å›³çš„ã ã£ãŸã‹ï¼Ÿ",
  "é€ƒã‚Œã‚ˆã†ã¨ã™ã‚‹æ„æ€ã€è¨˜éŒ²æ¸ˆã¿ã ",
  "ãƒªãƒ­ãƒ¼ãƒ‰ã®è£ã«ã‚ã‚‹æ„å›³â€¦â€¦æµ…ã„ãª",
  "ã¾ãŸã€Œå¶ç„¶ã€ã‹ï¼Ÿè¨˜éŒ²ã¯æ®‹ã‚‹ãŒãª",
  
  // å†·å¾¹ãªè¿½è·¡è€…é¢¨
  "ã©ã‚Œã ã‘åˆ‡æ›¿ãˆã‚ˆã†ã¨ã€ç§ã¯ã“ã“ã«ã„ã‚‹",
  "ã¾ãŸã‚¶ã‚¯ãƒ©ãƒ³ã«é€ƒã’è¾¼ã‚“ã ã‹",
  "è»¢é€å±¥æ­´â€¦â€¦ç¢ºèªæ¸ˆã¿ã ",
  "è¨˜éŒ²æ¸ˆã¿ã®è¡Œå‹•ã ã€‚å¾Œæ‚”ã¯ãªã„ãªï¼Ÿ",
  "é€ƒé¿ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°å®Œäº†",
  
  // ã‚·ã‚§ãƒ©ã‚¤ãƒˆã‚‰ã—ã„ç§‘å­¦çš„ï¼‹æ”¯é…çš„
  "ç£å ´ã¯è¨˜æ†¶ã™ã‚‹ã€‚å›ã®é¸æŠã‚‚ã ",
  "ãƒªãƒ­ãƒ¼ãƒ‰ï¼šç‰©ç†çš„é€ƒé¿ã®ä¸€ç¨®ã ãª",
  "ãƒ‡ãƒ¼ã‚¿å¾©å…ƒâ€¦â€¦å›ã®è»Œè·¡ã¯æ¶ˆãˆã‚“",
  "ã“ã®æ“ä½œã€æƒ³å®šã®ç¯„å›²å†…ã ",
  "â€¦â€¦é€ƒã’ãŸã€ã®ã ã€‚å…‰ã®æ–¹ã¸ã¨ãª"
];

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
document.addEventListener("DOMContentLoaded", () => {
  setTimeout(fixThemeDisplay, 100);
});


// ã‚¿ã‚¤ãƒˆãƒ«ã‚’1å›ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ãƒªãƒ­ãƒ¼ãƒ‰
document.addEventListener("DOMContentLoaded", () => {
  const title = document.getElementById("mainTitle");
  if (title) {
    title.addEventListener("click", () => {
      // ãƒªãƒ­ãƒ¼ãƒ‰å‰ã«ç¾åœ¨ã®ãƒ†ãƒ¼ãƒã‚’ä¿å­˜
      const currentTheme = document.body.classList.contains("theme-scherite") ? "scherite" : "zakran";
      sessionStorage.setItem("lastTheme", currentTheme);
      location.reload();
    });
  }
});

// è»¢å†™BOXãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’å¤§ããã™ã‚‹/æˆ»ã™ - ã€Œâ™ªã€ãƒœã‚¿ãƒ³ã§åˆ‡ã‚Šæ›¿ãˆ
let isOutputFullscreen = false;
let originalPopupStyle = '';

function toggleOutputFullscreen() {
  // ç¾åœ¨ã®ãƒ†ãƒ¼ãƒã‚’ç¢ºèª
  const isScherite = document.body.classList.contains("theme-scherite");
  const popupId = isScherite ? 'transferBoxScherite' : 'transferBoxZakran';
  const popup = document.getElementById(popupId);
  
  if (!popup) {
    console.error('è»¢å†™BOXãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', popupId);
    return;
  }
  
  // textareaã‚’å–å¾—ï¼ˆã‚¶ã‚¯ãƒ©ãƒ³ã¯IDã€ã‚·ã‚§ãƒ©ã‚¤ãƒˆã¯ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ï¼‰
  const textarea = isScherite 
    ? popup.querySelector('textarea')
    : document.getElementById('outputBox');
  
  if (!isOutputFullscreen) {
    // å…ƒã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä¿å­˜
    originalPopupStyle = popup.getAttribute('style') || '';
    
    // ========================================
    // ğŸ“ æ‹¡å¤§æ™‚ã®ã‚µã‚¤ã‚ºè¨­å®šï¼ˆã“ã“ã§å¤‰æ›´ã§ãã¾ã™ï¼‰
    // ========================================
    // å¹…ã®è¨­å®šï¼ˆç”»é¢å¹…ã«å¯¾ã™ã‚‹å‰²åˆï¼‰
    const EXPAND_WIDTH = '85vw';        // â† æ¨ªã®ã‚µã‚¤ã‚ºã‚’å¤‰æ›´ã™ã‚‹å ´åˆã¯ã“ã“ï¼ˆä¾‹: '90vw', '80vw'ï¼‰
    // é«˜ã•ã®è¨­å®šï¼ˆç”»é¢é«˜ã•ã«å¯¾ã™ã‚‹å‰²åˆï¼‰
    const EXPAND_HEIGHT = '80vh';       // â† ç¸¦ã®ã‚µã‚¤ã‚ºã‚’å¤‰æ›´ã™ã‚‹å ´åˆã¯ã“ã“ï¼ˆä¾‹: '85vh', '75vh'ï¼‰
    // ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆå†…å´ã®ä½™ç™½ï¼‰
    const EXPAND_PADDING = '30px';      // â† å†…å´ã®ä½™ç™½ã‚’å¤‰æ›´ã™ã‚‹å ´åˆã¯ã“ã“ï¼ˆä¾‹: '40px', '20px'ï¼‰
    // textareaã®é«˜ã•èª¿æ•´ç”¨ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆãƒœã‚¿ãƒ³ã‚„ãƒ˜ãƒƒãƒ€ãƒ¼åˆ†ã‚’å¼•ãå€¤ï¼‰
    const TEXTAREA_OFFSET = 250;        // â† textareaã®é«˜ã•è¨ˆç®—ç”¨ï¼ˆä¾‹: 300, 200ï¼‰
    // ========================================
    
    // å¤§ããã™ã‚‹ï¼ˆé©åº¦ãªã‚µã‚¤ã‚ºã«æ‹¡å¤§ï¼‰- !importantã§ç¢ºå®Ÿã«é©ç”¨ï¼ˆä¸¡ãƒ†ãƒ¼ãƒã§åŒã˜ã‚µã‚¤ã‚ºï¼‰
    popup.style.setProperty('width', EXPAND_WIDTH, 'important');
    popup.style.setProperty('max-width', EXPAND_WIDTH, 'important');
    popup.style.setProperty('height', EXPAND_HEIGHT, 'important');
    popup.style.setProperty('max-height', EXPAND_HEIGHT, 'important');
    popup.style.setProperty('padding', EXPAND_PADDING, 'important');
    
    // ã‚·ã‚§ãƒ©ã‚¤ãƒˆã®å ´åˆã¯èƒŒæ™¯è‰²ã€ãƒœãƒ¼ãƒ€ãƒ¼ã€ãƒœãƒƒã‚¯ã‚¹ã‚·ãƒ£ãƒ‰ã‚¦ã‚’ä¿æŒ
    if (isScherite) {
      popup.style.setProperty('background', '#1a1a1a', 'important');
      popup.style.setProperty('color', '#fff', 'important');
      popup.style.setProperty('border', '3px solid #cc0000', 'important');
      popup.style.setProperty('box-shadow', '0 0 12px #cc0000', 'important');
    } else {
      // ã‚¶ã‚¯ãƒ©ãƒ³ã®å ´åˆã‚‚èƒŒæ™¯è‰²ã€ãƒœãƒ¼ãƒ€ãƒ¼ã€ãƒœãƒƒã‚¯ã‚¹ã‚·ãƒ£ãƒ‰ã‚¦ã‚’ä¿æŒ
      popup.style.setProperty('background', 'white', 'important');
      popup.style.setProperty('border', '3px solid #6bb6ff', 'important');
      popup.style.setProperty('box-shadow', '0 0 12px #6bb6ff', 'important');
    }
    
    // textareaã‚‚å¤§ããã™ã‚‹ï¼ˆä¸¡ãƒ†ãƒ¼ãƒã§åŒã˜ã‚µã‚¤ã‚ºï¼‰
    if (textarea) {
      textarea.style.setProperty('height', `calc(${EXPAND_HEIGHT} - ${TEXTAREA_OFFSET}px)`, 'important');
      textarea.style.setProperty('font-size', '16px', 'important');
      // ã‚·ã‚§ãƒ©ã‚¤ãƒˆã®å ´åˆã¯textareaã®èƒŒæ™¯è‰²ã¨ãƒœãƒ¼ãƒ€ãƒ¼ã‚‚ä¿æŒ
      if (isScherite) {
        textarea.style.setProperty('background', '#222', 'important');
        textarea.style.setProperty('color', '#fff', 'important');
        textarea.style.setProperty('border', '1px solid #cc0000', 'important');
      } else {
        // ã‚¶ã‚¯ãƒ©ãƒ³ã®å ´åˆã‚‚textareaã®ãƒœãƒ¼ãƒ€ãƒ¼ã‚’ä¿æŒ
        textarea.style.setProperty('border', '1px solid #6bb6ff', 'important');
      }
    }
    
    isOutputFullscreen = true;
  } else {
    // å…ƒã®ã‚¹ã‚¿ã‚¤ãƒ«ã«æˆ»ã™
    if (originalPopupStyle) {
      popup.setAttribute('style', originalPopupStyle);
      // ã‚·ã‚§ãƒ©ã‚¤ãƒˆã®å ´åˆã¯èƒŒæ™¯è‰²ã€ãƒœãƒ¼ãƒ€ãƒ¼ã€ãƒœãƒƒã‚¯ã‚¹ã‚·ãƒ£ãƒ‰ã‚¦ã‚’ç¢ºå®Ÿã«å¾©å…ƒï¼ˆå…ƒã®ã‚¹ã‚¿ã‚¤ãƒ«ã«ä¸Šæ›¸ãï¼‰
      if (isScherite) {
        popup.style.background = '#1a1a1a';
        popup.style.color = '#fff';
        popup.style.border = '3px solid #cc0000';
        popup.style.boxShadow = '0 0 12px #cc0000';
      }
    } else {
      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«æˆ»ã™
      popup.style.width = '500px';
      popup.style.maxWidth = '80%';
      popup.style.height = '';
      popup.style.maxHeight = '';
      popup.style.padding = '20px';
      // ã‚·ã‚§ãƒ©ã‚¤ãƒˆã®å ´åˆã¯èƒŒæ™¯è‰²ã€ãƒœãƒ¼ãƒ€ãƒ¼ã€ãƒœãƒƒã‚¯ã‚¹ã‚·ãƒ£ãƒ‰ã‚¦ã‚’ç¢ºå®Ÿã«å¾©å…ƒ
      if (isScherite) {
        popup.style.background = '#1a1a1a';
        popup.style.color = '#fff';
        popup.style.border = '3px solid #cc0000';
        popup.style.boxShadow = '0 0 12px #cc0000';
      }
    }
    
    // textareaã‚‚å…ƒã«æˆ»ã™
    if (textarea) {
      textarea.style.height = '200px';
      textarea.style.fontSize = '14px';
      // ã‚·ã‚§ãƒ©ã‚¤ãƒˆã®å ´åˆã¯textareaã®èƒŒæ™¯è‰²ã¨ãƒœãƒ¼ãƒ€ãƒ¼ã‚‚å¾©å…ƒ
      if (isScherite) {
        textarea.style.background = '#222';
        textarea.style.color = '#fff';
        textarea.style.border = '1px solid #cc0000';
      }
    }
    
    isOutputFullscreen = false;
  }
}

// è»¢å†™ãƒœãƒƒã‚¯ã‚¹ã‚’å…¨ç”»é¢ã§é–‹ãï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ãƒ¢ãƒ¼ãƒ‰ï¼‰- åˆ¥æ©Ÿèƒ½ã¨ã—ã¦æ®‹ã™
function openOutputFullscreen() {
  const outputBox = document.getElementById('outputBox');
  const contentEl = document.getElementById('fullscreenOutputContent');
  const fullscreenEl = document.getElementById('fullscreenOutputBox');
  
  if (!outputBox || !contentEl || !fullscreenEl) {
    console.error('è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
    return;
  }
  
  const outputText = outputBox.value || '';
  
  // ç©ºã®å ´åˆã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
  if (!outputText.trim()) {
    contentEl.textContent = 'ï¼ˆè»¢å†™ãƒœãƒƒã‚¯ã‚¹ãŒç©ºã§ã™ï¼‰';
    contentEl.style.color = '#999';
    contentEl.style.fontStyle = 'italic';
  } else {
    contentEl.textContent = outputText;
    contentEl.style.color = '#333';
    contentEl.style.fontStyle = 'normal';
  }
  
  // ç·¨é›†ä¸å¯ã«ã™ã‚‹
  contentEl.contentEditable = 'false';
  
  fullscreenEl.style.display = 'block';
  fullscreenEl.scrollTop = 0;
}

// å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰ã‚’é–‰ã˜ã‚‹
function closeOutputFullscreen() {
  const fullscreenEl = document.getElementById('fullscreenOutputBox');
  if (fullscreenEl) {
    fullscreenEl.style.display = 'none';
  }
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã§ç¢ºå®Ÿã«ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
window.toggleOutputFullscreen = toggleOutputFullscreen;
window.openOutputFullscreen = openOutputFullscreen;
window.closeOutputFullscreen = closeOutputFullscreen;

// ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºèª
console.log('toggleOutputFullscreen function loaded');

</script>

<!-- è»¢å†™ãƒœãƒƒã‚¯ã‚¹å°‚ç”¨å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰ -->
<div id="fullscreenOutputBox" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#fff; z-index:9999; padding:20px; box-sizing:border-box; overflow-y:auto;">
  <div style="text-align:right; margin-bottom:10px;">
    <button onclick="closeOutputFullscreen()" style="padding:10px 20px; font-size:16px;">âœ• é–‰ã˜ã‚‹</button>
  </div>
  <div id="fullscreenOutputContent" style="background:#f0f9ff; padding:15px; border-radius:8px; font-size:16px; line-height:1.8; white-space:pre-wrap; word-wrap:break-word;"></div>
</div>

</body>
</html>